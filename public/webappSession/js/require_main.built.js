/**
 * @license RequireJS text 2.0.10 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

define("apps/config/marionette/region/dialog",["jquery","underscore","marionette","bootstrap"],function(e,t,n){return n.Region.Dialog=n.Region.extend({el:"#dialog-region",constructor:function(){this.on("show",this.showModal,this)},showModal:function(e){console.log("showModal");var t=this,n=function(){t.$el.children().first().modal("show"),t.$el.children().first().on("hidden.bs.modal",function(e){t.closeDialog()})};n()},hideModal:function(){console.log("hidemodal"),this.$el.children().first().modal("hide"),e("body").removeClass("modal-open"),e(".modal-backdrop").remove()},closeDialog:function(){this.stopListening(),this.hideModal(),this.empty()}}),n.Region.Dialog}),define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.10",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}d.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("ï»¿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!apps/elements/list/templates/elements_dialog.html",[],function(){return'<div class="modal-dialog">\r\n  <div class="modal-content">    \r\n    <div class="modal-header elements-list">\r\n      <button type="button" class="close js-close" data-dismiss="modal" aria-hidden="true">&times;</button>\r\n      <span id="activity-title" class="js-rename">\r\n      <div id="inner-activity-title"><%=index %> <%= activityTitle %><div>\r\n      </span>      \r\n    </div>    \r\n    <div class="modal-body elements-list" >\r\n      <div class="elements-wrapper">\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}),define("text!apps/elements/list/templates/elements_item.html",[],function(){return'<div class="btn-element js-show" data-toggle="tooltip" data-placement="left" title="Open Element">\r\n    <% if( thumbnail === "about:blank" &&  questionText !== "") {%>\r\n    <div  class="btn-image "><%= questionText %> </div>\r\n    <% } else { %>\r\n    <div class="btn-image " style=\'background-image: url("<%= thumbnail %>");\'><div>\r\n    <% } %>\r\n</div>\r\n<div class="btn-overlay grey"></div>\r\n<div class="number">\r\n  <span class="btn-circle btn-number"><%= index %></span>\r\n</div>\r\n<!--<div class="btn-overlay-description">\r\n  <p>Test Description</p> \r\n</div>-->\r\n <!-- <div class="edit-element-lower-container dullBlueShade">\r\n   <textarea class="input-element" rows="2" cols="50" placeholder="Description"></textarea>\r\n   <div class="edit-element-delete-container">\r\n     <button class="btnDelete btnNav js-delete"></button>\r\n   </div>                    \r\n</div>-->\r\n'}),define("apps/elements/list/elementsList_view",["app","text!apps/elements/list/templates/elements_dialog.html","text!apps/elements/list/templates/elements_item.html"],function(e,t,n){return e.module("ElementsApp.List.View",function(e,r,i,s,o,u){e.Element=s.ItemView.extend({template:u.template(n),className:function(){return"element "+this.model.get("color")},triggers:{},events:{"click .js-show":"elementShowClicked"},elementShowClicked:function(e){e.preventDefault(),this.trigger("element:show",this.model)}}),e.Elements=s.CompositeView.extend({template:u.template(t),childView:e.Element,childViewContainer:".elements-wrapper",className:"modal custom fade js-modal",id:"myModal",attributes:{tabindex:"-1",role:"dialog","aria-labelledby":"myModalLabel","aria-hidden":"true"},events:{"keypress .js-modal":"escapeKeyPressed"},triggers:{"click .js-close":"element:list:close","keypress .js-modal":"element:list:escape"},initialize:function(){},escapeKeyPressed:function(e){console.log("escape key pressed"),console.log(e.target)}})}),e.ElementsApp.List.View}),define("entities/element/element_model",["jquery","underscore","backbone","app"],function(e,t,n,r){var i=n.Model.extend({idAttribute:"_id",defaults:{_id:"",answer:"a",textAnswer:"",gotAnswer:!1,questionText:"",resourceUrl:"about:blank",thumbnail:"about:blank",isImage:!1,answerTextA:"Test Answer A",answerTextB:"Test Answer B",answerTextC:"Test Answer C",answerTextD:"Test Answer D",responseType:"mul",responses:""}}),s={getElementEntity:function(t){var n=new Activity({id:t}),r=e.Deferred();return n.fetch({success:function(e){r.resolve(e)},error:function(e){r.resolve(undefined)}}),r.promise()}};return r.reqres.setHandler("element:entity",function(e){return s.getElementEntity(e)}),r.reqres.setHandler("element:entity:new",function(e){return new i}),i}),define("entities/element/element_collection",["jquery","underscore","backbone","app","entities/element/element_model"],function(e,t,n,r,i){var s=n.Collection.extend({model:i}),o=function(){var t=JSON.parse(e("#data-session").html()),n=t._id,r=new ActivityCollection(t.activities,n);return r},u=function(){var e=[{resourceUrl:"../../plugins/randomizer/randomizer.html",gotAnswer:"true",questionText:"Test Question 1",answer:"a",answerTextA:"Question 1 Text for Answer A",answerTextB:"Question 1 Text for Answer B",answerTextC:"Question 1 Text for Answer C",answerTextD:"Question 1 Text for Answer D"},{resourceUrl:"../../plugins/airweb/index_b.html",gotAnswer:"true",questionText:"Test Question 2",answer:"b",answerTextA:"Question 2 Text for Answer A",answerTextB:"Question 2 Text for Answer B",answerTextC:"Question 2 Text for Answer C",answerTextD:"Question 2 Text for Answer D"},{resourceUrl:"https://docs.google.com/document/d/1HeNsERfR37ulbmshKaxvhWzkZFvoMIv5vB02YikswuQ/preview",gotAnswer:"true",questionText:"Test Question 3",answer:"c",answerTextA:"Question 3 Text for Answer A",answerTextB:"Question 3 Text for Answer B",answerTextC:"Question 3 Text for Answer C",answerTextD:"Question 3 Text for Answer D"},{resourceUrl:"https://docs.google.com/document/d/1HeNsERfR37ulbmshKaxvhWzkZFvoMIv5vB02YikswuQ/preview",gotAnswer:"true",questionText:"Test Question 4",answer:"d",answerTextA:"Question 4 Text for Answer A",answerTextB:"Question 4 Text for Answer B",answerTextC:"Question 4 Text for Answer C",answerTextD:"Question 4 Text for Answer D"},{resourceUrl:"https://docs.google.com/document/d/1HeNsERfR37ulbmshKaxvhWzkZFvoMIv5vB02YikswuQ/preview",gotAnswer:"false",questionText:"Test Question 5",answer:""}],t=JSON.parse(JSON.stringify(e));return new s(t)},a=function(){var e=new i({gotAnswer:"false",questionText:"Test Question 1"}),t=new i({gotAnswer:"false",questionText:"Test Question 2"}),n=new i({gotAnswer:"false",questionText:"Test Question 3"});return new s([e,t,n])};return API={getElementEntities:function(){},getElementEntititesFromHTML:function(){return u()}},r.reqres.setHandler("element:entities",function(){return API.getElementEntities()}),r.reqres.setHandler("element:entities:initialize",function(){return API.getElementEntititesFromHTML()}),s}),define("entities/activity/activity_model",["jquery","underscore","backbone","app","entities/element/element_collection"],function(e,t,n,r,i){var s=n.Model.extend({idAttribute:"_id",url:function(){return t.result(this.collection,"url")+(this.isNew()?"":this.id+"/")},model:{elements:i},parse:function(e){this.set("_id",e._id);for(var t in this.model){var n=this.model[t],r=e[t];e[t]=new n(r)}return e},defaults:{thumbnail:"activityModel.jpg",desc:"Activity Description",activityType:"game",colorTag:"dullPink",selected:!1,elements:"",index:"",studentResponses:""},initialize:function(e){if(e&&!(e.elements instanceof n.Collection)){var t=this.model.elements,r=e.elements;e.elements=new t(r),this.set("elements",e.elements),this.set("activityName","test")}},toggleSelected:function(){this.set({selected:!this.get("selected")})},clear:function(){console.log("destroy"),this.destroy()}}),o={getActivityEntity:function(t){var n=new s({id:t}),r=e.Deferred();return n.fetch({success:function(e){r.resolve(e)},error:function(e){r.resolve(undefined)}}),r.promise()}};return r.reqres.setHandler("activity:entity",function(e){return o.getActivityEntity(e)}),r.reqres.setHandler("activity:entity:new",function(e){return new s}),s}),define("entities/activity/activity_collection",["jquery","underscore","backbone","app","entities/activity/activity_model"],function(e,t,n,r,i){function v(e){t.each(e.models,function(e){var n=e.collection.indexOf(e)+1;e.set("index",n);var r=e.get("elements");if(r.length!==0){e.set("elements",r,{parse:!0});var i=e.get("elements");t.each(i.models,function(e){var t=e.collection.indexOf(e)+1;e.set("index",n+"."+t),e.get("_id")===""&&e.set("_id",t)})}},this)}ActivityCollection=n.Collection.extend({model:i,url:function(){return"/"+this.pathSession},parse:function(e){return e.activities},initialize:function(e,t,n){this.lessonName=n.name,this.pathSession=t,this.lessonEditorId=n.id,this.isLocked=n.isLocked},selected:function(){return this.filter(function(e){return e.get("selected")})},remaining:function(){return this.without.apply(this,this.selected())}});var s=JSON.parse(e("#data-session").html()),o=s.idSession,u=s.path,a=s.lessonName,f=JSON.parse(e("#data-results").html()),l=f.lesson,c=s.isLocked;(typeof a===null||typeof a=="undefined")&&console.log("lessonName not defined"+a);var h={name:a,id:l,isLocked:c},p=function(){var e=new ActivityCollection(s.activities,u,h);return v(e),e},d={getActivityEntities:function(t){var n={},r=new ActivityCollection(n,u,h),i=e.Deferred();return r.fetch({success:function(e){i.resolve(e),v(r)}}),i.promise()},getActivityEntitiesFromHTML:function(){var e=p();return v(e),e}};return r.reqres.setHandler("activity:entities",function(){return d.getActivityEntities()}),r.reqres.setHandler("activity:entities:initialized",function(){return d.getActivityEntitiesFromHTML()}),ActivityCollection}),define("apps/elements/list/elementsList_controller",["app","apps/elements/list/elementsList_view","bootstrap"],function(e,t){return e.module("ElementsApp.List",function(e,n,r,i,s,o){function u(e){console.log(e);var r=e.get("elements"),i=new t.Elements({model:e,collection:r});n.dialogRegion.show(i),s("#myModal").modal({backdrop:"static",keyboard:!1}),i.on("childview:element:show",function(t){n.dialogRegion.closeDialog(),n.trigger("element:show",e,t.model),n.trigger("header:list:questionHeader")}),i.on("element:list:close",function(t){var r=n.request("activity:list:view"),i=n.request("activities").get(e),s=r.children.findByModel(i);s&&(s.$el.addClass("animated fadeInDown"),console.log("animate"),s.$el.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){s.$el.removeClass("animated fadeInDown")})),n.navigate("",{trigger:!1}),n.dialogRegion.closeDialog()}),i.on("element:list:escape",function(e){console.log(e)})}e.Controller={listElements:function(e){require(["entities/activity/activity_collection"],function(){var t=n.request("activity:entities");s.when(t).done(function(t){var n={activities:t},r=t.get(e);u(r)})})},listElementsLocal:function(e){u(e)}}}),e.ElementsApp.List.Controller}),define("text!apps/elements/show/templates/elementShow_template.html",[],function(){return'<div class="activty-question-title camp-adventure-font text-center"><%= activityTitle %></div>  \r\n<div class="btn-previous-area ">\r\n  <a class="btn btn-previous js-question-previous " href="#"><i class="fa fa-chevron-left fa-3x "></i></a>\r\n  <!-- <a class="btnNav btnPrevious js-question-previous " title="Previous question"></a>-->\r\n</div>\r\n<div class="btn-next-area ">\r\n  <!--  <a class="btnNav btnCloseElement js-question-close" id="clear-selected" title="Close"></a>-->        \r\n  <a class="btn btn-next js-question-next" href="#"><i class="fa fa-chevron-right fa-3x "></i></a>\r\n  <!-- <a class="btnNav btnNext  js-question-next" title="Next question"></a>-->\r\n</div>\r\n<div class="row question-display margin-0px">\r\n  <!--  <div class="col-xs-1 col-md-1 col-lg-1">\r\n      <a class="btnNav btnPrevious js-question-previous " title="Previous question"></a>\r\n    </div>-->\r\n\r\n  <div class="col-xs-12 col-md-12 col-lg-12 padding-0px margin-0px frameContent" id="divInsertFrame">\r\n    <% if(!isImage) { %>      \r\n    <div class="image" id="imageHolder">\r\n      <div class="trick"></div>\r\n      <img id="imageDoc" src="<%= thumbnail %>">\r\n    </div>\r\n    <iframe scrolling="yes" id="frameDoc" src="<%= resourceUrl %>" frameborder="0" onload="$(\'#imageHolder\').css(\'display\', \'none\');"></iframe>\r\n    <% } else { %>\r\n\r\n    <div class="image">\r\n      <div class="trick"></div>\r\n      <img id="imageDoc" src="<%= resourceUrl %>"  onload="document.initCanvas()">\r\n      <canvas id="c" height="0px" width="0px" style="border:1px solid #aaa;position:absolute;"></canvas>\r\n      <!--<a href="#" id="buttonWalkthrough" class="btn btn-xs btn-default">Sync Slides</a>-->\r\n    </div>\r\n    <% } %>\r\n  </div>\r\n  <a class="btn btn-close js-question-close" href="#"><i class="fa fa-times fa-3x"></i></a>\r\n\r\n  <!--    <div class="col-xs-1 col-md-1 col-lg-1">\r\n        <a class="btnNav btnCloseElement js-question-close" id="clear-selected" title="Close"></a>\r\n      </div> \r\n      <div class="col-xs-1 col-md-1 col-lg-1">\r\n        <a class="btnNav btnNext  js-question-next" title="Next question"></a>\r\n      </div>    -->\r\n</div>\r\n\r\n\r\n<div class="row margin-0px question-text-area">\r\n  <div class="question-text-input col-lg-12 col-md-12 col-sm-12 col-xs-12 padding-0px">\r\n    <div class="number-question  col-lg-1 col-md-1 col-sm-1 col-xs-2 padding-0px">\r\n      <!--      <span class="question-label" >Question : </span>-->\r\n      <span class="btn-circle-question btn-number"><%= index %></span>\r\n    </div>\r\n    <div class=" col-lg-10 col-md-10 col-sm-10 col-xs-9 question-text js-question-text padding-0px " id="question-text">\r\n      <div class="vcenter"><%= questionText %></div>\r\n    </div>\r\n  </div>\r\n</div>  \r\n<div class="answer-area row">\r\n  <div class="row margin-0px answer-bar">\r\n    <div class="student-answer-stat">\r\n      <span class="student-answered-desc">Students answered: </span>\r\n      <div class="btn-students-answered text-center">\r\n        <span class="student-answered js-students-answered">1</span>\r\n        <span>/</span>\r\n        <span class="total-students js-students-total">10</span>\r\n      </div> \r\n    </div>\r\n    <a class="btn btn-show-answers js-answers-show">Reveal Answers and Results</a>\r\n    <a class="btn btn-default btn-reset js-answers-reset"><i class="fa fa-refresh"></i> Reset</a>\r\n  </div>\r\n  <% if ( responseType === \'mul\' ) { %>\r\n  <div class="col-md-6 col-sm-6 col-xs-12 col-answer-a padding-0px">       \r\n    <div class="btn-answer-a answer-text js-answerA" id="answer-text-a">\r\n      <div class="result-overlay dullPink"></div>\r\n      <div class="result-text">\r\n        <div class="col-md-1 col-sm-1 col-xs-1 label-a answer-text-label-area padding-0px">\r\n          <span class="answer-text-label">A</span>\r\n        </div>  \r\n        <div class="col-md-11 col-sm-11 col-xs-11"><%= answerTextA %></div>\r\n      </div>\r\n      <div class="col-md-1 col-sm-1 col-xs-1 label-a answer-text-label-area padding-0px"></div>                                       \r\n    </div>\r\n  </div>\r\n  <div class="col-md-6 col-sm-6 col-xs-12 col-answer-b padding-0px">        \r\n    <div class="btn-answer-b answer-text js-answerB" id="answer-text-b">\r\n      <div class="result-overlay dullGreen"></div>\r\n      <div class="result-text">\r\n        <div class="col-md-1 col-sm-1 col-xs-1  label-b answer-text-label-area padding-0px">\r\n          <span class="answer-text-label">B</span>\r\n        </div>\r\n        <div class="col-md-11 col-sm-11 col-xs-11"><%= answerTextB %></div>        \r\n      </div>       \r\n    </div>\r\n  </div>\r\n  <div class="col-md-6 col-sm-6 col-xs-12 col-answer-c padding-0px">        \r\n    <div class="btn-answer-c answer-text js-answerC" id="answer-text-c">\r\n      <div class="result-overlay dullBlue"></div>\r\n      <div class="result-text">\r\n        <div class="col-md-1 col-sm-1 col-xs-1 answer-text-label-area label-c padding-0px">\r\n          <span class="answer-text-label">C</span>\r\n        </div>\r\n        <div class="col-md-11 col-sm-11 col-xs-11"><%= answerTextC %></div>          \r\n      </div> \r\n    </div>\r\n  </div>\r\n  <div class="col-md-6 col-sm-6 col-xs-12  col-answer-d padding-0px">       \r\n    <div class="btn-answer-d answer-text js-answerD" id="answer-text-d">\r\n      <div class="result-overlay dullYellow"></div>\r\n      <div class="result-text">\r\n        <div class="col-md-1 col-sm-1 col-xs-1 answer-text-label-area label-d padding-0px">\r\n          <span class="answer-text-label">D</span>\r\n        </div>               \r\n        <div class="col-md-11 col-sm-11 col-xs-11"><%= answerTextD %></div> \r\n      </div>\r\n    </div>\r\n  </div>\r\n  <% } %> \r\n</div>\r\n\r\n<% if ( responseType === \'text\' ) { %>\r\n<div id=\'response-panel\'></div>\r\n<% } %>'}),define("apps/elements/show/elementsShow_view",["app","text!apps/elements/show/templates/elementShow_template.html","backbone.syphon"],function(e,t){return e.module("ElementsApp.Show.View",function(e,n,r,i,s,o){e.Element=i.LayoutView.extend({template:o.template(t),regions:{responsesPanel:"#response-panel"},className:"container-fluid padding-0px grey",events:{"click .js-question-next":"questionNextClicked","click .js-question-previous":"questionPreviousClicked","click .js-answers-show":"answersShow","click .js-answers-reset":"answersReset"},answerAClicked:function(){this.trigger("element:answer:a",this.model)},answerBClicked:function(){this.trigger("element:answer:b",this.model)},answerCClicked:function(){this.trigger("element:answer:c",this.model)},answerDClicked:function(){this.trigger("element:answer:d",this.model)},questionNextClicked:function(e){e.preventDefault(),this.trigger("element:question:next",this.model)},questionPreviousClicked:function(e){e.preventDefault(),this.trigger("element:question:previous",this.model)},answersShow:function(e){e.preventDefault(),console.log("Show"),this.trigger("element:answers:show",this.model)},answersReset:function(e){e.preventDefault(),console.log("reset"),this.trigger("element:answers:reset",this.model)},triggers:{"click .js-save":"element:link:save","click .js-question-close":"element:show:close"},initialize:function(){var e=this;document.addEventListener("LocalMessage",function(t){var n=JSON.parse(t.detail);switch(n.type){case"ResourceUpdate":var r={resourceURL:n.resourceURL,thumbnail:n.thumbnailLink,title:n.title};console.log(e),e.trigger("element:link:update",e.model,r)}},this)}})}),e.ElementsApp.Show.View}),define("server/sync",["app"],function(e){return e.module("Server",function(e,t,n,r,i,s){var o="ACTIVITY";e.Sync={MessageToServerStudentAnswersReset:function(e){var t={idElement:e.idElement,idActivity:e.idActivity};window.pluginToServer(o,"StudentAnswersReset",t)}}}),e.Server.Sync}),function(e,t){typeof define=="function"&&define.amd?define("grids",["jquery"],t):typeof exports=="object"&&(module.exports=t(require("jquery")))}(this,function(t,n){t.fn.equalHeight=function(){var e=[];return t.each(this,function(n,r){$element=t(r);var i,s=$element.css("box-sizing")=="border-box"||$element.css("-moz-box-sizing")=="border-box";s?i=$element.innerHeight():i=$element.height(),e.push(i)}),this.height(Math.max.apply(window,e)),this},t.fn.equalHeightGrid=function(e){var n=this;n.css("height","auto");for(var r=0;r<n.length;r++)if(r%e===0){var i=t(n[r]);for(var s=1;s<e;s++)i=i.add(n[r+s]);i.equalHeight()}return this},t.fn.detectGridColumns=function(){var e=0,n=0;return this.each(function(r,i){var s=t(i).offset().top;if(e!==0&&s!=e)return!1;n++,e=s}),n},t.fn.responsiveEqualHeightGrid=function(){function n(){var t=e.detectGridColumns();e.equalHeightGrid(t)}var e=this;return t(window).bind("resize load",n),n(),this}}),define("apps/elements/show/elementsShow_controller",["app","apps/elements/show/elementsShow_view","server/sync","mathjax","backbone.syphon","grids"],function(e,t,n,r){return e.module("ElementsApp.Show",function(e,i,s,o,u,a){function c(e,o){typeof o=="undefined"&&(i.navigate(""),i.backToRoot()),i.reqres.setHandler("activity",function(){return e}),i.reqres.setHandler("element",function(){return o}),o.set("activityTitle",e.get("activityTitle"));var a=new t.Element({model:o}),f=o.collection.indexOf(o);l.listenTo(a,"show",function(){r.Hub.Queue(["Typeset",r.Hub]),window.pluginToServer("ACTIVITY","GetAllStudentAnswers",{}),i.reqres.setHandler("responses:panel",function(){return a.responsesPanel}),o.get("responseType")==="text"&&i.trigger("responses:list"),f===0&&u(".js-question-previous").hide();var t=f+1;o.collection.at(t)||u(".js-question-next").hide(),o.get("resourceUrl")==="about:blank"&&(u(".question-text").addClass("noMedia"),u("#divInsertFrame").hide()),o.get("questionText")===""&&u(".question-text-area").hide();if(o.get("responseType")==="mul"){var l=_helper.checkEmpty(o.get("answerTextA")),c=_helper.checkEmpty(o.get("answerTextB")),p=_helper.checkEmpty(o.get("answerTextC")),d=_helper.checkEmpty(o.get("answerTextD"));l&&u("#answer-text-a").hide(),c&&u("#answer-text-b").hide(),p&&u("#answer-text-c").hide(),d&&u("#answer-text-d").hide(),l&&c&&p&&d&&u(".answer-area").hide()}else o.get("responseType")===""&&u(".answer-area").hide();u(".answer-text").responsiveEqualHeightGrid(),a.on("elements:list:local",function(e){i.trigger("elements:list:local",e.model.collection)}),a.on("element:link:save",function(e){require(["entities/activity/activity_model"],function(t){var n=e.model,r=i.request("activity:entity",e.model.collection.activityID),o=s.Syphon.serialize(e.view);n.set(o);var a=JSON.parse(JSON.stringify(e.model.collection));u.when(r).done(function(e){h(e,a);var t=u("#frameDoc");t.attr("src",o.resourceUrl)})})}),a.on("element:question:previous",function(t){var n=t.collection.indexOf(t),r=n-1;_helper.showElement(r,t,e);var s="/adventures/"+e.id+"/elements/"+(r+1);i.navigate(s)}),a.on("element:question:next",function(t){var n=t.collection.indexOf(t),r=n+1;_helper.showElement(r,t,e);var s="/adventures/"+e.id+"/elements/"+(r+1);i.navigate(s)}),a.on("element:show:close",function(){var t={activities:e.collection};i.navigate("",{trigger:!1}),i.trigger("activities:listActivities:initialized"),i.trigger("elements:list:local",e)}),a.on("element:answer:a",function(){n.MessageToServerStudentAnswer("a")}),a.on("element:answer:b",function(){n.MessageToServerStudentAnswer("b")}),a.on("element:answer:c",function(){n.MessageToServerStudentAnswer("c")}),a.on("element:answer:d",function(){n.MessageToServerStudentAnswer("d")}),a.on("element:answers:show",function(){}),a.on("element:answers:reset",function(t){var r={idActivity:e.id,idElement:t.cid};n.MessageToServerStudentAnswersReset(r)}),a.on("element:link:update",function(t,n){var r=t;r.set({resourceUrl:n.resourceURL,thumbnail:n.thumbnail,resourceTitle:n.title}),e.set({thumbnail:n.thumbnail});var i=JSON.parse(JSON.stringify(t.collection));h(e,i);var s=u("#frameDoc");s.attr("src",n.resourceURL)})}),i.mainRegion.show(a)}function h(e,t){e.set("elements",t),e.save()}var f=o.Controller.extend({showFirstElement:function(e,t){require(["entities/element/element_collection","entities/activity/activity_collection"],function(n){var r=e;if(e===null&&typeof t=="undefined"){var o=i.request("activity:entities");u.when(o).done(function(e){var t=e.at(0);r=t.get("elements");var i=0,s=new n(r),o=s.at(i);c(o)})}else if(r instanceof s.Collection){var f=r.at(t);c(f)}else{var a=new n(r),f=a.at(t);c(f)}})},showElementLocal:function(e,t){c(e,t)},showElement:function(e,t){require(["entities/activity/activity_collection"],function(){var n=i.request("activity:entities");u.when(n).done(function(n){var r=n.get(e);if(typeof r=="undefined")i.navigate(""),i.backToRoot();else{var s=r.get("elements").at(t-1);c(r,s)}})})},updateElementResponses:function(){var e=[],t=[],n=[],r=[],s=i.request("element"),o=s.get("responses"),f=0;a.each(o,function(i){f+=1;switch(i.studentAnswer.answerSubmitted){case"a":e.push(i);break;case"b":t.push(i);break;case"c":n.push(i);break;case"d":r.push(i)}});var l=Math.round(e.length/f*100),c=Math.round(t.length/f*100),h=Math.round(n.length/f*100),p=Math.round(r.length/f*100);u("#answer-text-a").find(".result-overlay").css("width",l+"%"),u("#answer-text-b").find(".result-overlay").css("width",c+"%"),u("#answer-text-c").find(".result-overlay").css("width",h+"%"),u("#answer-text-d").find(".result-overlay").css("width",p+"%")}});e.Controller=new f;var l=e.Controller;_helper={showElement:function(e,t,n){var r=t.collection.at(e);r&&c(n,r)},checkEmpty:function(e){return e.trim()===""?!0:!1}},API={MessageToServerStudentAnswer:function(e){var t={type:"StudentAnswer",value:e};jq(document).trigger("studentToServer",{detail:t})}}}),e.ElementsApp.Show.Controller}),define("apps/elements/elements_app",["app"],function(e){e.module("Router.ElementsApp",function(e,t,n,r,i,s){e.Router=r.AppRouter.extend({appRoutes:{"element/:id":"showElement","adventures/:id":"listElements","adventures/:id/elements/:id":"showElement"}}),ElementsAPI={listElements:function(e){require(["apps/elements/list/elementsList_controller"],function(t){t.listElements(e)})},listElementsLocal:function(e){require(["apps/elements/list/elementsList_controller"],function(t){t.listElementsLocal(e)})},showElement:function(e,t){require(["apps/elements/show/elementsShow_controller"],function(n){n.showElement(e,t)})},showElementLocal:function(e,n){var r="#adventures/"+e.id+"/elements/"+(n.collection.indexOf(n)+1);t.navigate(r),require(["apps/elements/show/elementsShow_controller"],function(t){t.showElementLocal(e,n)})},updateElementResponses:function(e,t){require(["apps/elements/show/elementsShow_controller"],function(e){e.updateElementResponses()})}},t.on("elements:list",function(e){ElementsAPI.listElements(e)}),t.on("elements:list:local",function(e){ElementsAPI.listElementsLocal(e)}),t.on("element:show:close",function(e){ElementsAPI.listElementsLocal(e)}),t.on("element:show",function(e,t){ElementsAPI.showElementLocal(e,t)}),t.on("element:update:responses",function(e,t){ElementsAPI.updateElementResponses()}),t.addInitializer(function(){new e.Router({controller:ElementsAPI}),jq(window.document).off("ServerToPluginACTIVITY"),jq(window.document).on("ServerToPluginACTIVITY",function(e,n){var r=n.detail;switch(r.pluginMessageType){case"GetAllStudentAnswersResponse":var i=r.data.activities,o=r.data.activities,u={};s.each(o,function(e){var t=s.groupBy(e.elementsData,"idActivity");console.log("activities");var n={};s.each(t,function(t){s.each(t,function(t){var n=t.elementData;if(n){u[t.idActivity]||(u[t.idActivity]={});var r=u[t.idActivity];r.elementsForActivity||(r.elementsForActivity={}),r.idActivity=t.idActivity,r.elementsForActivity[t.idElement]||(r.elementsForActivity[t.idElement]={});var n=r.elementsForActivity[t.idElement];n.studentsDataForElement||(n.studentsDataForElement={}),n.idElement=t.idElement,n.studentsDataForElement[e.idStudent]||(n.studentsDataForElement[e.idStudent]={});var i=n.studentsDataForElement[e.idStudent];i.idStudent=e.idStudent,i.studentAnswer=t.elementData.studentAnswer,i.correctAnswer=t.elementData.correctAnswer}})})}),console.log(u);var a=t.request("activity").collection;s.each(u,function(e){var t=a.get(e.idActivity);t&&s.each(e.elementsForActivity,function(e){var n=t.get("elements").get(e.idElement);n&&n.set("responses",e.studentsDataForElement)})}),t.trigger("element:update:responses")}})})})}),define("text!apps/activities/listActivities/templates/activity_item.html",[],function(){return'<% if (tileType === "checkpoint") { %>\n<div class="activity-checkpoint ">\n  <% if (activityType ==="media" && elements.length ===0  ) { %>\n  <% console.log("this actitvity", elements.length) %>\n  <div class="checkpoint-wrapper js-move">\n    <div class="checkpoint markerBlue ">\n      <!--      <img class="checkpoint-img checkpoint-shadow">-->\n    </div>\n    <div class="checkpoint-desc">?</div>\n  </div>  \n  <% } else if (activityType ==="media" && elements.length !== 0 && checkPointIcon === "" ) { %>\n  <div class="checkpoint-wrapper js-move ">\n    <div class="checkpoint markerBlue">\n      <!--      <img class="checkpoint-img " src="/webapp/images/checkpoint_blue.svg">-->\n    </div>\n    <div class="checkpoint-desc">Q</div>\n  </div>\n  <% } else if (activityType ==="media" && elements.length !== 0 && checkPointIcon !== "" ) { %>\n  <div class="checkpoint-wrapper js-move ">\n    <div class="checkpoint  <%= checkPointIcon %>">\n      <!--      <img class="checkpoint-img " src="/webapp/images/checkpoint_blue.svg">-->\n    </div>\n    <div class="checkpoint-desc">Q</div>\n  </div>  \n  <% } else if (activityType ==="wordList" && pluginApp === "" ){  %>\n  <div class="checkpoint-wrapper js-move">    \n    <div class="checkpoint markerBrown"></div>\n    <div class="checkpoint-desc">W</div>\n  </div>  \n  <% } else if (activityType ==="wordList" && checkPointIcon === ""){  %>\n  <div class="checkpoint-wrapper js-move">   \n    <div class="checkpoint markerBrown"></div>         \n    <div class="checkpoint-desc "> <i class="fa <%= pluginAppIcon %>"></i> </div>  \n  </div>\n  <% } else if (activityType ==="wordList" && checkPointIcon !== ""){  %>\n  <div class="checkpoint-wrapper js-move">   \n    <div class="checkpoint <%= checkPointIcon %>"></div>         \n    <div class="checkpoint-desc "> <i class="fa <%= pluginAppIcon %>"></i> </div>  \n  </div>  \n  <% } else { %>\n  <div class="checkpoint-wrapper js-move">    \n    <div class="checkpoint markerBlue "></div>\n    <div class="checkpoint-desc"></div>\n  </div>  \n  <% }  %>\n  <div class="activity-coordinate" data-x="<%= x  %>" data-y="<%= y %>" ></div>\n\n  <% if( activityTitle !== "Edit Title") {%>\n  <div class="activity-description ">\n    <span class="activity-activity-desc js-move"><%= activityTitle %></span>\n  </div>\n  <% }%>\n</div>\n<% }  %>\n'}),define("text!apps/activities/listActivities/templates/activity_map.html",[],function(){return'<div class="activity-header-bar text-center">\n  \n  <div class="activity-header-wrapper">\n    <span class="activity-title-picker camp-adventure-title"><%= lessonName %></span>\n    <a href="#" class="btn btn-activity js-select"><i class="fa fa-map-marker"></i> Select</a>\n    \n<!--    <% if ( typeof lessonName === null || typeof lessonName === \'undefined\' || lessonName === \'\'){ %>\n    <a href="#" class="btn btn-default btn-sm btn-activity js-new-activity"><i class="fa fa-file"></i>New Activity </a>\n    <% }else { %>  \n    <% if ( isLocked ){ %>\n    &nbsp;<i class="fa fa-lock"></i>\n    <% }else { %>\n    <a href="#" class="btn-activity-edit js-edit"><i class="fa fa-edit"></i></a>\n    <% } %>\n    <% } %> -->\n  </div>\n</div>\n\n<!--<div class="row activity-title">\n  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">\n    <span> <%= lessonName %> </span>  \n  </div>\n</div>-->\n<p></p>\n\n<div id="adventure-view" class="row" style="background-image:url(\'<%= backgroundImageURL %>\')"></div>\n<% if (window.top !== window.self) { %>\n<div class="test-view-text text-center">Teacher</div>\n<% } %>\n'}),define("text!apps/activities/listActivities/templates/activity_tile.html",[],function(){return'<% if ( a === true ) { %>\n  <% if (tileType === "linkhor") { %>\n  <div class="activity-direction">\n    <div class="activity-coordinate" data-x="<%= x  %>" data-y="<%= y %>" ></div>\n    <!--<span><i class="fa fa-minus fa-3x"></i></span>-->\n    <% if ( a !== true ) { %>\n    <div class="horizontal-line js-toggle-hor tile-non-active" />\n    <% } else { %>\n    <div class="horizontal-line js-toggle-hor" />\n    <% } %>\n  </div>\n  <% } else if (tileType === "linkver") {  %>\n\n  <div class="activity-direction ">\n\n    <div class="activity-coordinate" data-x="<%= x  %>" data-y="<%= y %>" >\n      <!--    <span class="vertical-link"> | </span>-->\n    </div>\n    <% if ( a !== true ) { %>\n    <div class="vertical-line js-toggle-ver tile-non-active" />\n    <% } else { %>\n    <div class="vertical-line js-toggle-ver" />\n    <% } %>\n  </div>\n  <% } else if (tileType === "dropzone") { %>\n  <div class="activity-dropzone dropzone js-new">\n    <div class="activity-coordinate" data-x="<%= x  %>" data-y="<%= y %>" >\n      <!--    <span class="vertical-link"> | </span>-->\n    </div>\n\n  </div>\n  <% } %>\n<% } %>'}),!function(e){function t(){}function n(e){return!!e&&("object"==typeof Element?e instanceof Element:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName)}function r(e,t){o(t,gt),e.pageX=gt.x,e.pageY=gt.y,u(t,gt),e.clientX=gt.x,e.clientY=gt.y,e.timeStamp=(new Date).getTime()}function i(e,t,n){e.pageX=n.pageX-t.pageX,e.pageY=n.pageY-t.pageY,e.clientX=n.clientX-t.clientX,e.clientY=n.clientY-t.clientY,e.timeStamp=(new Date).getTime()-t.timeStamp;var r=Math.max(e.timeStamp/1e3,.001);e.pageSpeed=st(e.pageX,e.pageY)/r,e.pageVX=e.pageX/r,e.pageVY=e.pageY/r,e.clientSpeed=st(e.clientX,e.pageY)/r,e.clientVX=e.clientX/r,e.clientVY=e.clientY/r}function s(e,t,n){var r,i,s;return n=n||{},e=e||"page",/touch/.test(t.type)&&t.touches?(r=t.touches.length?t.touches[0]:t.changedTouches[0],i=r[e+"X"],s=r[e+"Y"]):(i=t[e+"X"],s=t[e+"Y"]),n.x=i,n.y=s,n}function o(t,n){return n=n||{},t instanceof S?/inertiastart/.test(t.type)?(o(yt.pointerUp,n),n.x+=yt.sx,n.y+=yt.sy):(n.x=t.pageX,n.y=t.pageY):Zt?(s("screen",t,n),n.x+=e.scrollX,n.y+=e.scrollY):/gesture|inertia/i.test(t.type)?(s("client",t,n),n.x+=Q.documentElement.scrollLeft,n.y+=Q.documentElement.scrollTop):s("page",t,n),n}function u(e,t){return t=t||{},e instanceof S?/inertiastart/.test(e.type)?(u(yt.pointerUp,t),t.x+=yt.sx,t.y+=yt.sy):(t.x=e.clientX,t.y=e.clientY):s(Zt?"screen":"client",e,t),t}function a(){return{x:e.scrollX||Q.documentElement.scrollLeft,y:e.scrollY||Q.documentElement.scrollTop}}function f(e){var t=/ipad|iphone|ipod/i.test(navigator.userAgent)?{x:0,y:0}:a(),n=e instanceof Y?e.getBoundingClientRect():e.getClientRects()[0];return n&&{left:n.left+t.x,right:n.right+t.x,top:n.top+t.y,bottom:n.bottom+t.y,width:n.width||n.right-n.left,height:n.heigh||n.bottom-n.top}}function l(e){var t=[];return e instanceof Array?(t[0]=e[0],t[1]=e[1]):rt?(t[0]=ct[0],t[1]=ct[1]):(t[0]=e.touches[0],t[1]="touchend"===e.type&&1===e.touches.length?e.changedTouches[0]:e.touches[1]),t}function c(e){var t=l(e);return{pageX:(t[0].pageX+t[1].pageX)/2,pageY:(t[0].pageY+t[1].pageY)/2,clientX:(t[0].clientX+t[1].clientX)/2,clientY:(t[0].clientY+t[1].clientY)/2}}function h(e){if(e.touches&&e.touches.length||rt&&ct.length){var t=l(e),n=Math.min(t[0].pageX,t[1].pageX),r=Math.min(t[0].pageY,t[1].pageY),i=Math.max(t[0].pageX,t[1].pageX),s=Math.max(t[0].pageY,t[1].pageY);return{x:n,y:r,left:n,top:r,width:i-n,height:s-r}}}function p(e){var t=(Lt&&Lt.options||Dt).deltaSource,n=t+"X",r=t+"Y",i=l(e),s=i[0][n]-i[1][n],o=i[0][r]-i[1][r];return st(s,o)}function d(e,t){var n=(Lt&&Lt.options||Dt).deltaSource,r=n+"X",i=n+"Y",s=l(e),o=s[0][r]-s[1][r],u=s[0][i]-s[1][i],a=180*Math.atan(u/o)/Math.PI;if("number"==typeof t){var f=a-t,c=f%360;c>315?a-=360+a/360|0:c>135?a-=180+a/360|0:-315>c?a+=360+a/360|0:-135>c&&(a+=180+a/360|0)}return a}function v(e,t){e=e||Lt;var r=e?e.options.origin:Dt.origin;return t=t||e._element,"parent"===r?r=t.parentNode:"self"===r&&(r=t),n(r)?(r=f(r),r.x=r.left,r.y=r.top):"function"==typeof r&&(r=r(e&&t)),r}function m(e){for(var t=0,n=e.length;n>t;t++)e[t].rect=e[t].getRect()}function g(){var e=yt.target.options.inertia,t=e.resistance,n=(new Date).getTime()/1e3-yt.t0;if(n<yt.te){var r=1-(Math.exp(-t*n)-yt.lambda_v0)/yt.one_ve_v0;if(yt.modifiedXe===yt.xe&&yt.modifiedYe===yt.ye)yt.sx=yt.xe*r,yt.sy=yt.ye*r;else{var i=b(0,0,yt.xe,yt.ye,yt.modifiedXe,yt.modifiedYe,r);yt.sx=i.x,yt.sy=i.y}M(yt.startEvent),yt.i=tn(g)}else yt.sx=yt.modifiedXe,yt.sy=yt.modifiedYe,yt.active=!1,M(yt.startEvent),U(yt.startEvent)}function y(e,t,n,r){var i=1-e;return i*i*t+2*i*e*n+e*e*r}function b(e,t,n,r,i,s,o){return{x:y(o,e,n,i),y:y(o,t,r,s)}}function w(e){if(e.length){var t,n,r,i,s,o=e[0],u=[],a=[];for(i=1;i<e.length;i++){if(t=e[i],!u.length)for(n=o;n.parentNode!==Q;)u.unshift(n),n=n.parentNode;if(o instanceof tt&&t instanceof Y&&!(t instanceof Z)){if(t===o.parentNode)continue;n=t.ownerSVGElement}else n=t;for(a=[];n.parentNode!==Q;)a.unshift(n),n=n.parentNode;for(s=0;a[s]&&a[s]===u[s];)s++;var f=[a[s-1],a[s],u[s]];for(r=f[0].lastChild;r;){if(r===f[1]){o=t,u=[];break}if(r===f[2])break;r=r.previousSibling}}return{element:o,index:e.indexOf(o)}}}function E(e,t){if(Et.length||Tt.length){var r,i,s,o=[],u=[],a=[],f=[];for(t=t||Lt._element,r=0;r<Et.length;r++){var l=Et[r];if(n(l.options.accept)){if(l.options.accept!==t)continue}else if("string"==typeof l.options.accept&&!t[en](l.options.accept))continue;t!==l._element&&l.dropCheck(e,Lt,t)&&(o.push(l),u.push(l._element))}if(i=w(u),s=i?o[i.index]:null,Tt.length){for(r=0;r<Tt.length;r++)for(var c=Tt[r],h=Q.querySelectorAll(c.selector),p=0,d=h.length;d>p;p++){if(c._element=h[p],c.rect=c.getRect(),n(c.options.accept)){if(c.options.accept!==t)continue}else if("string"==typeof c.options.accept&&!t[en](c.options.accept))continue;c._element!==t&&-1===u.indexOf(c._element)&&f.indexOf(-1===c._element)&&c.dropCheck(e,Lt)&&(a.push(c),f.push(c._element))}f.length&&(s&&(a.push(s),f.push(s._element)),i=w(f),i&&(s=a[i.index],s.selector&&(s._element=f[i.index])))}return s?{dropzone:s,element:s._element}:null}}function S(e,t,n,i,s){var a,f,l=(Lt&&Lt.options||Dt).deltaSource,m=l+"X",g=l+"Y",y=Lt?Lt.options:Dt,b=v(Lt,i);if(i=i||Lt._element,"gesture"===t){var w=c(e);f={x:w.pageX-b.x,y:w.pageY-b.y},a={x:w.clientX-b.x,y:w.clientY-b.y}}else f=o(e),a=u(e),f.x-=b.x,f.y-=b.y,a.x-=b.x,a.y-=b.y,y.snapEnabled&&-1!==y.snap.actions.indexOf(t)&&(this.snap={range:Pt.range,locked:Pt.locked,x:Pt.x,y:Pt.y,realX:Pt.realX,realY:Pt.realY,dx:Pt.dx,dy:Pt.dy},Pt.locked&&(f.x+=Pt.dx,f.y+=Pt.dy,a.x+=Pt.dx,a.y+=Pt.dy));if(Lt.options.restrict[t]&&Ht.restricted&&(f.x+=Ht.dx,f.y+=Ht.dy,a.x+=Ht.dx,a.y+=Ht.dy,this.restrict={dx:Ht.dx,dy:Ht.dy}),this.pageX=f.x,this.pageY=f.y,this.clientX=a.x,this.clientY=a.y,"start"!==n||e instanceof S||r(at,this),this.x0=at.pageX,this.y0=at.pageY,this.clientX0=at.clientX,this.clientY0=at.clientY,this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.button=e.button,this.target=i,this.t0=ht,this.type=t+(n||""),yt.active&&(this.detail="inertia"),s&&(this.relatedTarget=s),dt&&"inertia"===dt.detail&&!yt.active&&y.inertia.zeroResumeDelta?this.dx=this.dy=0:"end"===n||"drop"===t?"client"===l?(this.dx=a.x-at.clientX,this.dy=a.y-at.clientY):(this.dx=f.x-at.pageX,this.dy=f.y-at.pageY):"inertiastart"===n?(this.dx=dt.dx,this.dy=dt.dy):"client"===l?(this.dx=a.x-dt.clientX,this.dy=a.y-dt.clientY):(this.dx=f.x-dt.pageX,this.dy=f.y-dt.pageY),"resize"===t?y.squareResize||e.shiftKey?("y"===Xt?this.dx=this.dy:this.dy=this.dx,this.axes="xy"):(this.axes=Xt,"x"===Xt?this.dy=0:"y"===Xt&&(this.dx=0)):"gesture"===t&&(this.touches=rt?[ct[0],ct[1]]:e.touches,"start"===n?(this.distance=p(e),this.box=h(e),this.scale=1,this.ds=0,this.angle=d(e),this.da=0):"end"===n||e instanceof S?(this.distance=dt.distance,this.box=dt.box,this.scale=dt.scale,this.ds=this.scale-1,this.angle=dt.angle,this.da=this.angle-bt.startAngle):(this.distance=p(e),this.box=h(e),this.scale=this.distance/bt.startDistance,this.angle=d(e,bt.prevAngle),this.ds=this.scale-bt.prevScale,this.da=this.angle-bt.prevAngle)),"start"===n)this.timeStamp=ht,this.dt=0,this.duration=0,this.speed=0,this.velocityX=0,this.velocityY=0;else if("inertiastart"===n)this.timeStamp=(new Date).getTime(),this.dt=dt.dt,this.duration=dt.duration,this.speed=dt.speed,this.velocityX=dt.velocityX,this.velocityY=dt.velocityY;else{this.timeStamp=(new Date).getTime(),this.dt=this.timeStamp-dt.timeStamp,this.duration=this.timeStamp-ht;var E,x,T;"end"===n||e instanceof S?(T=Math.max(("end"===n?this.duration:this.dt)/1e3,.001),E=this[m]-dt[m],x=this[g]-dt[g],this.snap&&this.snap.locked&&(E-=this.snap.dx,x-=this.snap.dy),this.restrict&&(E-=this.restrict.dx,x-=this.restrict.dy),dt.snap&&dt.snap.locked&&(E-=dt[m]-dt.snap.dx,x-=dt[g]-dt.snap.dy),dt.restrict&&(E+=dt.restrict.dx,x+=dt.restrict.dy),this.speed=st(E,x)/T,this.velocityX=E/T,this.velocityY=x/T):(this.speed=ft[l+"Speed"],this.velocityX=ft[l+"VX"],this.velocityY=ft[l+"VY"])}}function x(){this.originalEvent.preventDefault()}function T(e,t,n){var r,i,s={};for(r in e)e.hasOwnProperty(r)&&(s[r]=e[r]);s.preventDefault=x,s.stopPropagation=S.prototype.stopPropagation,s.stopImmediatePropagation=S.prototype.stopImmediatePropagation,s.timeStamp=(new Date).getTime(),s.originalEvent=e,s.dt=s.timeStamp-ht,s.type="tap";var o=s.timeStamp-vt,u=mt&&"dubletap"!==mt.type&&mt.target===s.target&&500>o;for(vt=s.timeStamp,i=0;i<t.length;i++){var a=v(t[i],n[i]);if(s.pageX-=a.x,s.pageY-=a.y,s.clientX-=a.x,s.clientY-=a.y,s.currentTarget=n[i],t[i].fire(s),s.immediatePropagationStopped||s.propagationStopped&&t[i+1]!==s.currentTarget)break}if(u){var f={};for(r in s)f[r]=s[r];for(f.dt=o,f.type="doubletap",i=0;i<t.length&&(f.currentTarget=n[i],t[i].fire(f),!(f.immediatePropagationStopped||f.propagationStopped&&t[i+1]!==f.currentTarget));i++);mt=f}else mt=s}function N(e){if(!pt||!qt&&e instanceof pt.constructor&&pt.target===e.target){for(var t=[],n=[],r=e.target;r;){V.isSet(r)&&(t.push(V(r)),n.push(r));for(var i in xt){var s=Element.prototype[en]===K?Q.querySelectorAll(i):void 0;r!==Q&&r[en](i,s)&&(t.push(xt[i]),n.push(r))}r=r.parentNode}t.length&&T(e,t,n)}}function C(e,t){if("string"!=typeof e)return null;t=t||Lt;var n=-1!==e.indexOf("resize")?"resize":e,r=(t||Lt).options;return("resize"===n&&r.resizable||"drag"===e&&r.draggable||"gesture"===e&&r.gesturable)&&$t[n]?(("resize"===e||"resizeyx"===e)&&(e="resizexy"),e):null}function k(e){if(Jt&&pt&&e.type!==pt.type)return void (/^input$|^textarea$/i.test(Lt._element.nodeName)||e.preventDefault());if(!(pt&&"mousedown"===e.type&&"touchstart"===pt.type&&e.timeStamp-pt.timeStamp<300)){var t,n=e.target instanceof et?e.target.correspondingUseElement:e.target;if(rt&&_(e),yt.active&&Lt.selector)for(;n&&n!==Q;){if(n===yt.targetElement&&C(Lt.getAction(e))===Jt)return nn(yt.i),yt.active=!1,void (rt&&_(e,kt));n=n.parentNode}if(!(Ut||Wt||Rt)){if(Nt.length&&/mousedown|pointerdown/i.test(e.type))t=F(e,Nt);else for(var i,s;n&&n!==Q&&!t;){Nt=[];for(i in xt)s=Element.prototype[en]===K?Q.querySelectorAll(i):void 0,n[en](i,s)&&(xt[i]._element=n,Nt.push(xt[i]));t=F(e,Nt),n=n.parentNode}return t?(It=!0,Jt=t,L(e,t)):(ht=(new Date).getTime(),pt=e,r(ot,e),qt=!1,void 0)}}}function L(e,t){if(!t&&It&&pt&&e.type!==pt.type)return void (/^input$|^textarea$/i.test(Lt._element.nodeName)||e.preventDefault());It=!0,rt&&_(e),((e.touches&&e.touches.length<2||lt&&lt.length<2)&&!Lt||!Jt)&&(Lt=wt.get(e.currentTarget));var n=Lt&&Lt.options;if(Lt&&!(Ut||Wt||Rt)){var i=C(t||Lt.getAction(e));if(r(at,e),rt&&e instanceof rt&&(Lt._gesture.target||(Lt._gesture.target=Lt._element),_(e,Lt._gesture)),!i)return e;qt=!1,n.styleCursor&&(Q.documentElement.style.cursor=Vt[i].cursor),Xt="resizexy"===i?"xy":"resizex"===i?"x":"resizey"===i?"y":"","gesture"===i&&(e.touches&&e.touches.length<2||rt&&lt.length<2)&&(i=null),Jt=i,Pt.x=null,Pt.y=null,ht=(new Date).getTime(),pt=e,r(ot,e),qt=!1,/^input$|^textarea$/i.test(Lt._element.nodeName)||e.preventDefault()}else yt.active&&e.currentTarget===yt.targetElement&&Lt===yt.target&&C(Lt.getAction(e))===Jt&&(nn(yt.i),yt.active=!1,rt&&(Lt._gesture.target||(Lt._gesture.target=Lt._element),_(e,Lt._gesture)))}function A(e,t){var n,r,i,s,u,a,f,l,c,h,p=Lt.options.snap,d=p.anchors;if(t=t||Pt,t.useStatusXY)n={x:t.x,y:t.y};else{var m=v(Lt);n=o(e),n.x-=m.x,n.y-=m.y}if(t.realX=n.x,t.realY=n.y,p.range<0&&(p.range=1/0),"path"===p.mode)for(d=[],c=0,h=p.paths.length;h>c;c++){var g=p.paths[c];"function"==typeof g&&(g=g(n.x,n.y)),d.push({x:"number"==typeof g.x?g.x:n.x,y:"number"==typeof g.y?g.y:n.y,range:"number"==typeof g.range?g.range:p.range})}if("anchor"!==p.mode&&"path"!==p.mode||!d.length){if("grid"===p.mode){var y=Math.round((n.x-p.gridOffset.x)/p.grid.x),b=Math.round((n.y-p.gridOffset.y)/p.grid.y),w=y*p.grid.x+p.gridOffset.x,E=b*p.grid.y+p.gridOffset.y;a=w-n.x,f=E-n.y,l=st(a,f),s=l<p.range,u=w!==t.x||E!==t.y,t.x=w,t.y=E,t.dx=a,t.dy=f,t.range=p.range}}else{for(r={anchor:null,distance:0,range:0,dx:0,dy:0},c=0,h=d.length;h>c;c++){var S=d[c];i="number"==typeof S.range?S.range:p.range,a=S.x-n.x,f=S.y-n.y,l=st(a,f),s=i>l,1/0===i&&r.inRange&&1/0!==r.range&&(s=!1),(!r.anchor||(s?r.inRange&&1/0!==i?l/i<r.distance/r.range:l<r.distance:!r.inRange&&l<r.distance))&&(1/0===i&&(s=!0),r.anchor=S,r.distance=l,r.range=i,r.inRange=s,r.dx=a,r.dy=f,t.range=i)}s=r.inRange,u=r.anchor.x!==t.x||r.anchor.y!==t.y,t.x=r.anchor.x,t.y=r.anchor.y,t.dx=r.dx,t.dy=r.dy}return t.changed=u||s&&!t.locked,t.locked=s,t}function O(e,t){var r,i=V.currentAction()||Jt,s=Lt&&Lt.options.restrict[i];if(t=t||Ht,r=r=t.useStatusXY?{x:t.x,y:t.y}:o(e),t.snap&&t.snap.locked&&(r.x+=t.snap.dx||0,r.y+=t.snap.dy||0),t.dx=0,t.dy=0,t.restricted=!1,!i||!s)return t;var u;return"parent"===s?s=Lt._element.parentNode:"self"===s&&(s=Lt._element),n(s)?u=f(s):("function"==typeof s&&(s=s(r.x,r.y,Lt._element)),u=s,"x"in s&&"y"in s&&(u={left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height})),t.dx=Math.max(Math.min(u.right,r.x),u.left)-r.x,t.dy=Math.max(Math.min(u.bottom,r.y),u.top)-r.y,t.restricted=!0,t}function M(e,t){if(It){if(e instanceof S||r(ut,e),!qt){var n=ut.clientX-ot.clientX,s=ut.clientY-ot.clientY;qt=st(n,s)>1}if(Jt&&("mousemove"!==e.type||"touchstart"!==pt.type)){if(qt&&(!yt.active||e instanceof S&&/inertiastart/.test(e.type))&&(Ut||Wt||Rt||i(ft,ot,ut),Jt&&Lt)){var o=Lt.options.restrictEnabled&&(!Lt.options.restrict.endOnly||t),u=!(Ut||Wt||Rt),a=u?pt:e;u&&(dt=pt),o||(Ht.restricted=!1),!Lt.options.snapEnabled||-1===Lt.options.snap.actions.indexOf(Jt)||Lt.options.snap.endOnly&&!t?(o&&O(e),Vt[Jt].moveListener(e)):(A(a),(Pt.changed||!Pt.locked||o)&&(o&&O(e),Vt[Jt].moveListener(e)))}e instanceof S||(i(ft,ot,ut),r(ot,e)),(Ut||Wt)&&Bt.edgeMove(e)}}}function _(e,t){if(!lt.length||ct[0].pointerType===e.pointerType){t&&t.addPointer(e.pointerId);var n=lt.indexOf(e.pointerId);-1===n?(lt.push(e.pointerId),ct[lt.length-1]=e):ct[n]=e}}function D(e){var t=lt.indexOf(e.pointerId);-1!==t&&lt.splice(t,1)}function P(e){var t=lt.indexOf(e.pointerId);-1!==t&&(/move/i.test(e.type)?ct[t]=e:/up|cancel/i.test(e.type)&&(D(e),Rt&&lt.length<2&&Lt._gesture.stop()))}function H(e){e.preventDefault();var t,n,r,i,s;if(!Ut){if(t=new S(pt,"drag","start"),Ut=!0,Lt.fire(t),!zt){m(Et);for(var o=0;o<Tt.length;o++)Tt[o]._elements=Q.querySelectorAll(Tt[o].selector)}dt=t,Lt.options.snapEnabled&&!Lt.options.snap.endOnly&&A(e)}t=new S(e,"drag","move");var u=Lt._element,a=E(t,u);a?(i=a.dropzone,Ot=a.element):i=Ot=null,Lt._element=u,Ot!==_t&&(Mt&&(r=new S(e,"drag","leave",_t,u),t.dragLeave=_t,s=Mt,Mt=_t=null),i&&(n=new S(e,"drag","enter",Ot,u),t.dragEnter=i._element,Mt=i,_t=Mt._element)),Lt.fire(t),r&&s.fire(r),n&&i.fire(n),dt=t}function B(e){e.preventDefault();var t;Wt||(t=new S(pt,"resize","start"),Lt.fire(t),Lt.fire(t),Wt=!0,dt=t,Lt.options.snapEnabled&&!Lt.options.snap.endOnly&&A(e)),t=new S(e,"resize","move"),Lt.fire(t),dt=t}function j(e){if(e.touches&&!(e.touches.length<2)||rt){e.preventDefault();var t;Rt||(t=new S(pt,"gesture","start"),t.ds=0,bt.startDistance=bt.prevDistance=t.distance,bt.startAngle=bt.prevAngle=t.angle,bt.scale=1,Rt=!0,Lt.fire(t),dt=t,Lt.options.snapEnabled&&!Lt.options.snap.endOnly&&A(e)),t=new S(e,"gesture","move"),t.ds=t.scale-bt.scale,Lt.fire(t),dt=t,bt.prevAngle=t.angle,bt.prevDistance=t.distance,1/0===t.scale||null===t.scale||void 0===t.scale||isNaN(t.scale)||(bt.scale=t.scale)}}function F(e,t){for(var n=0,r=t.length;r>n;n++){var i=t[n],s=C(i.getAction(e,i),i);if(s)return Lt=i,s}}function I(e){if(!(It||Ut||Wt||Rt)){var t=[],n=Lt&&Lt._element,r=e.target instanceof et?e.target.correspondingUseElement:e.target;for(var i in xt)xt.hasOwnProperty(i)&&xt[i]&&r[en](i)&&(xt[i]._element=r,t.push(xt[i]));var s=wt.get(r),o=s&&C(s.getAction(e),s);if(o)Lt=s,Nt=[];else if(F(e,t))Nt=t,R(e,Nt),an.addToElement(r,"mousemove",R);else if(Lt){var u=n.querySelectorAll("*");if(-1!==Array.prototype.indexOf.call(u,r)){for(var a=0;a<Nt.length;a++)Nt[a]._element=n;R(e,Nt),an.addToElement(Lt._element,"mousemove",R)}else Lt=null,Nt=[]}}}function q(e){if(!(It||Ut||Wt||Rt)){var t=e.target instanceof et?e.target.correspondingUseElement:e.target;wt.get(t)||an.removeFromElement(t,R),Lt&&Lt.options.styleCursor&&!(Ut||Wt||Rt)&&(Q.documentElement.style.cursor="")}}function R(e,t){if(It||Ut||Wt||Rt)Jt&&e.preventDefault();else{var n;t?n=F(e,t):Lt&&(n=C(Lt.getAction(e))),Lt&&Lt.options.styleCursor&&(Q.documentElement.style.cursor=n?Vt[n].cursor:"")}}function U(e){if((e instanceof S||rt||!It||!pt||e instanceof pt.constructor)&&!(e.touches&&e.touches.length>=2)){if(it&&e instanceof it&&/inertiastart/i.test(e.type))return void e.gestureObject.stop();var t,n,r=Lt&&Lt.options.inertia;if(Ut||Wt||Rt){if(yt.active)return;var i=Lt.options.deltaSource,s=ft[i+"Speed"];if(Lt.options.inertiaEnabled&&"gesture"!==Jt&&-1!==r.actions.indexOf(Jt)&&e!==yt.startEvent&&(new Date).getTime()-ut.timeStamp<50&&s>r.minSpeed&&s>r.endSpeed){var o,u=r.resistance,a=-Math.log(r.endSpeed/s)/u;if(yt.active=!0,yt.target=Lt,yt.targetElement=Lt._element,an.useAttachEvent)for(n in e)e.hasOwnProperty(n)&&(yt.pointerUp[n]=e[n]);else yt.pointerUp=e;yt.startEvent=o=new S(e,"drag","inertiastart"),yt.vx0=ft[i+"VX"],yt.vy0=ft[i+"VY"],yt.v0=s,yt.x0=dt.pageX,yt.y0=dt.pageY,yt.t0=yt.startEvent.timeStamp/1e3,yt.sx=yt.sy=0,yt.modifiedXe=yt.xe=(yt.vx0-a)/u,yt.modifiedYe=yt.ye=(yt.vy0-a)/u,yt.te=a,yt.lambda_v0=u/yt.v0,yt.one_ve_v0=1-r.endSpeed/yt.v0;var f,l=o.pageX,c=o.pageY;if(o.snap&&o.snap.locked&&(l-=o.snap.dx,c-=o.snap.dy),o.restrict&&(l-=o.restrict.dx,c-=o.restrict.dy),f={useStatusXY:!0,x:l+yt.xe,y:c+yt.ye,dx:0,dy:0,snap:null},f.snap=f,Lt.options.snapEnabled&&Lt.options.snap.endOnly){var h=A(e,f);h.locked&&(yt.modifiedXe+=h.dx,yt.modifiedYe+=h.dy)}if(Lt.options.restrictEnabled&&Lt.options.restrict.endOnly){var p=O(e,f);yt.modifiedXe+=p.dx,yt.modifiedYe+=p.dy}return nn(yt.i),yt.i=tn(g),void Lt.fire(yt.startEvent)}(Lt.options.snapEnabled&&Lt.options.snap.endOnly||Lt.options.restrictEnabled&&Lt.options.restrict.endOnly)&&M(e,!0)}if(Ut){t=new S(e,"drag","end");var d,v=Lt._element,m=E(t,v);if(m?(At=m.dropzone,Ot=m.element):(At=null,Ot=null),Lt._element=v,At)d=new S(e,"drop",null,Ot,v),t.dropzone=Ot;else if(Mt){var y=new S(e,"drag","leave",Ot,v);Mt.fire(y,v),t.dragLeave=_t}Lt.fire(t),d&&At.fire(d)}else Wt?(t=new S(e,"resize","end"),Lt.fire(t)):Rt&&(t=new S(e,"gesture","end"),Lt.fire(t));V.stop()}}function z(e,t){var n,r,i={},s=Ct[e.type],o=e.target;t=t?!0:!1;for(var u in e)i[u]=e[u];for(i.preventDefault=function(){e.preventDefault()};o&&o!==Q;){for(n in s)if(o[en](n)){var a=s[n];for(i.currentTarget=o,r=0;r<a.length;r++)if(a[r][1]===t)try{a[r][0](i)}catch(f){G.error('Error thrown from delegated listener: "'+n+'" '+e.type+" "+(a[r][0].name?a[r][0].name:"")),G.log(f)}}o=o.parentNode}}function W(e){return z.call(this,e,!0)}function X(){Lt&&!Lt.selector&&(Lt=null),At=Ot=Mt=_t=null}function V(e){return wt.get(e)||new J(e)}function $(e){for(var t in Dt)e.hasOwnProperty(t)&&typeof e[t]==typeof Dt[t]&&(this[t]=e[t])}function J(e,t){this._element=e,this._iEvents=this._iEvents||{},"string"==typeof e?(Q.querySelector(e),xt[e]=this,this.selector=e,this._gesture=kt):(n(e)&&(rt?(an.add(this,"pointerdown",L),an.add(this,"pointermove",R),this._gesture=new nt,this._gesture.target=e):(an.add(this,"mousedown",L),an.add(this,"mousemove",R),an.add(this,"touchstart",L),an.add(this,"touchmove",R))),St.push(this)),wt.push(this),this.set(t)}var K,Q=e.document,G=e.console,Y=e.SVGElement||t,Z=e.SVGSVGElement||t,et=e.SVGElementInstance||t,tt=e.HTMLElement||e.Element,nt=e.Gesture||e.MSGesture,rt=nt&&(e.PointerEvent||e.MSPointerEvent),it=nt&&(e.GestureEvent||e.MSGestureEvent),st=Math.hypot||function(e,t){return Math.sqrt(e*e+t*t)},ot={pageX:0,pageY:0,clientX:0,clientY:0,timeStamp:0},ut={pageX:0,pageY:0,clientX:0,clientY:0,timeStamp:0},at={pageX:0,pageY:0,clientX:0,clientY:0,timeStamp:0},ft={pageX:0,pageY:0,clientX:0,clientY:0,timeStamp:0,pageSpeed:0,clientSpeed:0},lt=rt?[]:null,ct=rt?[]:null,ht=0,pt=null,dt=null,vt=0,mt=null,gt={},yt={active:!1,target:null,targetElement:null,startEvent:null,pointerUp:{},xe:0,ye:0,duration:0,t0:0,vx0:0,vys:0,lambda_v0:0,one_ve_v0:0,i:null},bt={start:{x:0,y:0},startDistance:0,prevDistance:0,distance:0,scale:1,startAngle:0,prevAngle:0},wt=[],Et=[],St=[],xt={},Tt=[],Nt=[],Ct={},kt=null,Lt=null,At=null,Ot=null,Mt=null,_t=null,Dt={draggable:!1,dropzone:!1,accept:null,resizable:!1,squareResize:!1,resizeAxis:"xy",gesturable:!1,styleCursor:!0,snap:{mode:"grid",endOnly:!1,actions:["drag"],range:1/0,grid:{x:100,y:100},gridOffset:{x:0,y:0},anchors:[],paths:[],arrayTypes:/^anchors$|^paths$|^actions$/,objectTypes:/^grid$|^gridOffset$/,stringTypes:/^mode$/,numberTypes:/^range$/,boolTypes:/^endOnly$/},snapEnabled:!1,restrict:{drag:null,resize:null,gesture:null,endOnly:!1},restrictEnabled:!0,autoScroll:{container:e,margin:60,speed:300,numberTypes:/^margin$|^speed$/},autoScrollEnabled:!1,inertia:{resistance:10,minSpeed:100,endSpeed:10,actions:["drag","resize"],zeroResumeDelta:!1,numberTypes:/^resistance$|^minSpeed$|^endSpeed$/,arrayTypes:/^actions$/,boolTypes:/^zeroResumeDelta$/},inertiaEnabled:!1,origin:{x:0,y:0},deltaSource:"page"},Pt={locked:!1,x:0,y:0,dx:0,dy:0,realX:0,realY:0,anchors:[],paths:[]},Ht={dx:0,dy:0,snap:Pt,restricted:!1},Bt={target:null,i:null,x:0,y:0,scroll:function(){var t=Bt.target.options.autoScroll,n=t.container,r=(new Date).getTime(),i=(r-Bt.prevTime)/1e3,s=t.speed*i;s>=1&&(n instanceof e.Window?n.scrollBy(Bt.x*s,Bt.y*s):n&&(n.scrollLeft+=Bt.x*s,n.scrollTop+=Bt.y*s),Bt.prevTime=r),Bt.isScrolling&&(nn(Bt.i),Bt.i=tn(Bt.scroll))},edgeMove:function(t){if(Lt&&Lt.options.autoScrollEnabled&&(Ut||Wt)){var n,r,i,s,o=Lt.options.autoScroll;if(o.container instanceof e.Window)s=t.clientX<Bt.margin,n=t.clientY<Bt.margin,r=t.clientX>o.container.innerWidth-Bt.margin,i=t.clientY>o.container.innerHeight-Bt.margin;else{var u=f(o.container);s=t.clientX<u.left+Bt.margin,n=t.clientY<u.top+Bt.margin,r=t.clientX>u.right-Bt.margin,i=t.clientY>u.bottom-Bt.margin}Bt.x=r?1:s?-1:0,Bt.y=i?1:n?-1:0,Bt.isScrolling||(Bt.margin=o.margin,Bt.speed=o.speed,Bt.start(Lt))}},isScrolling:!1,prevTime:0,start:function(e){Bt.isScrolling=!0,nn(Bt.i),Bt.target=e,Bt.prevTime=(new Date).getTime(),Bt.i=tn(Bt.scroll)},stop:function(){Bt.isScrolling=!1,nn(Bt.i)}},jt="createTouch"in Q,Ft=jt?20:10,It=!1,qt=!1,Rt=!1,Ut=!1,zt=!1,Wt=!1,Xt="xy",Vt={drag:{cursor:"move",moveListener:H},resizex:{cursor:"e-resize",moveListener:B},resizey:{cursor:"s-resize",moveListener:B},resizexy:{cursor:"se-resize",moveListener:B},gesture:{cursor:"",moveListener:j}},$t={drag:!0,resize:!0,gesture:!0},Jt=null,Kt="onmousewheel"in Q?"mousewheel":"wheel",Qt=["dragstart","dragmove","draginertiastart","dragend","dragenter","dragleave","drop","resizestart","resizemove","resizeinertiastart","resizeend","gesturestart","gesturemove","gestureinertiastart","gestureend","tap","doubletap"],Gt={},Yt={directBind:0,onevent:1,globalBind:2},Zt="Opera"==navigator.appName&&jt&&navigator.userAgent.match("Presto"),en="matchesSelector"in Element.prototype?"matchesSelector":"webkitMatchesSelector"in Element.prototype?"webkitMatchesSelector":"mozMatchesSelector"in Element.prototype?"mozMatchesSelector":"oMatchesSelector"in Element.prototype?"oMatchesSelector":"msMatchesSelector",tn=e.requestAnimationFrame,nn=e.cancelAnimationFrame,rn={_element:e,events:{}},sn={_element:Q,events:{}},on={_element:e.parent,events:{}},un={_element:null,events:{}},an=function(){function t(e,t,n,r){var o=a.indexOf(e),c=f[o];if(c||(c={events:{},typeCount:0},o=a.push(e)-1,f.push(c),l.push(i?{supplied:[],wrapped:[],useCount:[]}:null)),c.events[t]||(c.events[t]=[],c.typeCount++),-1===c.events[t].indexOf(n)){var h;if(i){var p=l[o],d=p.supplied.indexOf(n),v=p.wrapped[d]||function(t){t.immediatePropagationStopped||(t.target=t.srcElement,t.currentTarget=e,/mouse|click/.test(t.type)&&(t.pageX=t.clientX+Q.documentElement.scrollLeft,t.pageY=t.clientY+Q.documentElement.scrollTop),n(t))};h=e[s](u+t,v,Boolean(r)),-1===d?(p.supplied.push(n),p.wrapped.push(v),p.useCount.push(1)):p.useCount[d]++}else h=e[s](t,n,r||!1);return c.events[t].push(n),h}}function n(e,t,r,s){var c,h,p,d=a.indexOf(e),v=f[d],m=r;if(v&&v.events)if(i&&(h=l[d],p=h.supplied.indexOf(r),m=h.wrapped[p]),"all"!==t){if(v.events[t]){var g=v.events[t].length;if("all"===r)for(c=0;g>c;c++)n(e,t,v.events[t][c],Boolean(s));else for(c=0;g>c;c++)if(v.events[t][c]===r){e[o](u+t,m,s||!1),v.events[t].splice(c,1),i&&h&&(h.useCount[p]--,0===h.useCount[p]&&(h.supplied.splice(p,1),h.wrapped.splice(p,1),h.useCount.splice(p,1)));break}v.events[t]&&0===v.events[t].length&&(v.events[t]=null,v.typeCount--)}v.typeCount||(f.splice(d),a.splice(d),l.splice(d))}else for(t in v.events)v.events.hasOwnProperty(t)&&n(e,t,"all")}var r=e.Event,i="attachEvent"in e&&!("addEventListener"in e),s=i?"attachEvent":"addEventListener",o=i?"detachEvent":"removeEventListener",u=i?"on":"",a=[],f=[],l=[];return"indexOf"in Array.prototype||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=t);t>n;n++)if(n in this&&this[n]===e)return n;return-1}),"stopPropagation"in r.prototype||(r.prototype.stopPropagation=function(){this.cancelBubble=!0},r.prototype.stopImmediatePropagation=function(){this.cancelBubble=!0,this.immediatePropagationStopped=!0}),"preventDefault"in r.prototype||(r.prototype.preventDefault=function(){this.returnValue=!1}),"hasOwnProperty"in r.prototype||(r.prototype.hasOwnProperty=Object.prototype.hasOwnProperty),{add:function(e,n,r,i){t(e._element,n,r,i)},remove:function(e,t,r,i){n(e._element,t,r,i)},addToElement:t,removeFromElement:n,useAttachEvent:i}}();S.prototype={preventDefault:t,stopImmediatePropagation:function(){this.immediatePropagationStopped=this.propagationStopped=!0},stopPropagation:function(){this.propagationStopped=!0}},wt.indexOfElement=Et.indexOfElement=function(e){for(var t=0;t<this.length;t++){var n=this[t];if(n.selector===e||!n.selector&&n._element===e)return t}return-1},wt.get=function(e){return"string"==typeof e?xt[e]:this[this.indexOfElement(e)]},Et.get=function(e){return this[this.indexOfElement(e)]},$.prototype=Dt,J.prototype={setOnEvents:function(e,t){if("drop"===e){var n=t.ondrop||t.onDrop||t.drop,r=t.ondragenter||t.onDropEnter||t.dragenter,i=t.ondragleave||t.onDropLeave||t.dragleave;"function"==typeof n&&(this.ondrop=n),"function"==typeof r&&(this.ondragenter=r),"function"==typeof i&&(this.ondragleave=i)}else{var s=t.onstart||t.onStart||t.start,o=t.onmove||t.onMove||t.move,u=t.onend||t.onEnd||t.end,a=t.oninertiastart||t.onInertiaStart||t.inertiastart;e="on"+e,"function"==typeof s&&(this[e+"start"]=s),"function"==typeof o&&(this[e+"move"]=o),"function"==typeof u&&(this[e+"end"]=u),"function"==typeof a&&(this[e+"inertiastart"]=a)}return this},draggable:function(e){return e instanceof Object?(this.options.draggable=!0,this.setOnEvents("drag",e),this):"boolean"==typeof e?(this.options.draggable=e,this):null===e?(delete this.options.draggable,this):this.options.draggable},dropzone:function(e){if(e instanceof Object)return this.options.dropzone=!0,this.setOnEvents("drop",e),this.accept(e.accept),(this.selector?Tt:Et).push(this),zt||this.selector||(this.rect=this.getRect()),this;if("boolean"==typeof e){if(e)(this.selector?Tt:Et).push(this),zt||this.selector||(this.rect=this.getRect());else{var t=this.selector?Tt:Et,n=t.indexOf(this);-1!==n&&t.splice(n,1)}return this.options.dropzone=e,this}return null===e?(delete this.options.dropzone,this):this.options.dropzone},dropCheck:function(e,t,n){var r,i,s=o(e),u=v(t,n);return s.x+=u.x,s.y+=u.y,zt&&(this.rect=this.getRect()),this.rect?(r=s.x>this.rect.left&&s.x<this.rect.right,i=s.y>this.rect.top&&s.y<this.rect.bottom,r&&i):!1},dropChecker:function(e){return"function"==typeof e?(this.dropCheck=e,this):this.dropCheck},accept:function(e){return n(e)?(this.options.accept=e,this):"string"==typeof e?(Q.querySelector(e),this.options.accept=e,this):null===e?(delete this.options.accept,this):this.options.accept},resizable:function(e){return e instanceof Object?(this.options.resizable=!0,this.setOnEvents("resize",e),/^x$|^y$|^xy$/.test(e.axis)?this.options.resizeAxis=e.axis:null===e.axis&&(this.options.resizeAxis=Dt.resizeAxis),this):"boolean"==typeof e?(this.options.resizable=e,this):this.options.resizable},resizeable:t,squareResize:function(e){return"boolean"==typeof e?(this.options.squareResize=e,this):null===e?(delete this.options.squareResize,this):this.options.squareResize},gesturable:function(e){return e instanceof Object?(this.options.gesturable=!0,this.setOnEvents("gesture",e),this):"boolean"==typeof e?(this.options.gesturable=e,this):null===e?(delete this.options.gesturable,this):this.options.gesturable},gestureable:t,autoScroll:function(t){var r=Dt.autoScroll;if(t instanceof Object){var i=this.options.autoScroll;return i===r&&(i=this.options.autoScroll={margin:r.margin,distance:r.distance,interval:r.interval,container:r.container}),i.margin=this.validateSetting("autoScroll","margin",t.margin),i.speed=this.validateSetting("autoScroll","speed",t.speed),i.container=n(t.container)||t.container instanceof e.Window?t.container:r.container,this.options.autoScrollEnabled=!0,this.options.autoScroll=i,this}return"boolean"==typeof t?(this.options.autoScrollEnabled=t,this):null===t?(delete this.options.autoScrollEnabled,delete this.options.autoScroll,this):this.options.autoScrollEnabled?this.options.autoScroll:!1},snap:function(e){var t=Dt.snap;if(e instanceof Object){var n=this.options.snap;return n===t&&(n={}),n.mode=this.validateSetting("snap","mode",e.mode),n.endOnly=this.validateSetting("snap","endOnly",e.endOnly),n.actions=this.validateSetting("snap","actions",e.actions),n.range=this.validateSetting("snap","range",e.range),n.paths=this.validateSetting("snap","paths",e.paths),n.grid=this.validateSetting("snap","grid",e.grid),n.gridOffset=this.validateSetting("snap","gridOffset",e.gridOffset),n.anchors=this.validateSetting("snap","anchors",e.anchors),this.options.snapEnabled=!0,this.options.snap=n,this}return"boolean"==typeof e?(this.options.snapEnabled=e,this):null===e?(delete this.options.snapEnabled,delete this.options.snap,this):this.options.snapEnabled?this.options.snap:!1},inertia:function(e){var t=Dt.inertia;if(e instanceof Object){var n=this.options.inertia;return n===t&&(n=this.options.inertia={resistance:t.resistance,minSpeed:t.minSpeed,endSpeed:t.endSpeed,actions:t.actions,zeroResumeDelta:t.zeroResumeDelta}),n.resistance=this.validateSetting("inertia","resistance",e.resistance),n.minSpeed=this.validateSetting("inertia","minSpeed",e.minSpeed),n.endSpeed=this.validateSetting("inertia","endSpeed",e.endSpeed),n.actions=this.validateSetting("inertia","actions",e.actions),n.zeroResumeDelta=this.validateSetting("inertia","zeroResumeDelta",e.zeroResumeDelta),this.options.inertiaEnabled=!0,this.options.inertia=n,this}return"boolean"==typeof e?(this.options.inertiaEnabled=e,this):null===e?(delete this.options.inertiaEnabled,delete this.options.inertia,this):this.options.inertiaEnabled?this.options.inertia:!1},getAction:function(e){var t,n,r,i=this.getRect(),s=o(e),u=this.options;return $t.resize&&u.resizable&&(t="y"!==u.resizeAxis&&s.x>i.right-Ft,n="x"!==u.resizeAxis&&s.y>i.bottom-Ft),Xt=(t?"x":"")+(n?"y":""),r=Xt?"resize"+Xt:$t.drag&&u.draggable?"drag":null,$t.gesture&&(e.touches&&e.touches.length>=2||rt&&lt.length>=2)&&!Ut&&!Wt&&(r="gesture"),r},actionChecker:function(e){return"function"==typeof e?(this.getAction=e,this):null===e?(delete this.options.getAction,this):this.getAction},getRect:function(){return this.selector&&!n(this._element)&&(this._element=Q.querySelector(this.selector)),f(this._element)},rectChecker:function(e){return"function"==typeof e?(this.getRect=e,this):null===e?(delete this.options.getRect,this):this.getRect},styleCursor:function(e){return"boolean"==typeof e?(this.options.styleCursor=e,this):null===e?(delete this.options.styleCursor,this):this.options.styleCursor},origin:function(e){return e instanceof Object||/^parent$|^self$/.test(e)?(this.options.origin=e,this):null===e?(delete this.options.origin,this):this.options.origin},deltaSource:function(e){return"page"===e||"client"===e?(this.options.deltaSource=e,this):null===e?(delete this.options.deltaSource,this):this.options.deltaSource},restrict:function(e){if(void 0===e)return this.options.restrict;if(e instanceof Object){var t={};(e.drag instanceof Object||/^parent$|^self$/.test(e.drag))&&(t.drag=e.drag),(e.resize instanceof Object||/^parent$|^self$/.test(e.resize))&&(t.resize=e.resize),(e.gesture instanceof Object||/^parent$|^self$/.test(e.gesture))&&(t.gesture=e.gesture),"boolean"==typeof e.endOnly&&(t.endOnly=e.endOnly),this.options.restrictEnabled=!0,this.options.restrict=t}else null===e&&(delete this.options.restrict,delete this.options.restrictEnabled);return this},validateSetting:function(e,t,r){var i=Dt[e],s=this.options[e];if(void 0!==i&&void 0!==i[t]){if("objectTypes"in i&&i.objectTypes.test(t))return r instanceof Object?r:t in s&&s[t]instanceof Object?s[t]:i[t];if("arrayTypes"in i&&i.arrayTypes.test(t))return r instanceof Array?r:t in s&&s[t]instanceof Array?s[t]:i[t];if("stringTypes"in i&&i.stringTypes.test(t))return"string"==typeof r?r:t in s&&"string"==typeof s[t]?s[t]:i[t];if("numberTypes"in i&&i.numberTypes.test(t))return"number"==typeof r?r:t in s&&"number"==typeof s[t]?s[t]:i[t];if("boolTypes"in i&&i.boolTypes.test(t))return"boolean"==typeof r?r:t in s&&"boolean"==typeof s[t]?s[t]:i[t];if("elementTypes"in i&&i.elementTypes.test(t))return n(r)?r:t in s&&n(s[t])?s[t]:i[t]}return null},element:function(){return this._element},fire:function(e){if(!e||!e.type||-1===Qt.indexOf(e.type))return this;for(var t,n,r=0,i=0,s="on"+e.type;3>r;)try{switch(r){case Yt.directBind:if(e.type in this._iEvents){for(t=this._iEvents[e.type],n=t.length;n>i&&!e.immediatePropagationStopped;i++)t[i](e);break}break;case Yt.onevent:"function"==typeof this[s]&&this[s](e);break;case Yt.globalBind:if(e.type in Gt&&(t=Gt[e.type]))for(n=t.length;n>i&&!e.immediatePropagationStopped;i++)t[i](e)}if(e.propagationStopped)break;i=0,r++}catch(o){G.error("Error thrown from "+e.type+" listener"),G.error(o),i++,r===Yt.onevent&&r++}return this},on:function(e,t,n){if("wheel"===e&&(e=Kt),-1!==Qt.indexOf(e))e in this._iEvents?-1===this._iEvents[e].indexOf(t)&&this._iEvents[e].push(t):this._iEvents[e]=[t];else if(this.selector){Ct[e]||(Ct[e]={});var r=Ct[e];r[this.selector]||(r[this.selector]=[]),r[this.selector].push([t,n?!0:!1]),an.add(sn,e,n?W:z,n)}else an.add(this,e,t,n);return this},off:function(e,t,n){var r,i=-1;if(n=n?!0:!1,"wheel"===e&&(e=Kt),-1!==Qt.indexOf(e))r=this._iEvents[e],r&&-1!==(i=r.indexOf(t))&&this._iEvents[e].splice(i,1);else if(this.selector){var s=Ct[e];if(s&&(r=s[this.selector])){for(i=0;i<r.length&&r[i][1]!==n;i++);i<r.length&&r.splice(i,1)}}else an.remove(this._element,t,n);return this},set:function(e){return e&&"object"==typeof e||(e={}),this.options=new $(e),this.draggable("draggable"in e?e.draggable:this.options.draggable),this.dropzone("dropzone"in e?e.dropzone:this.options.dropzone),this.resizable("resizable"in e?e.resizable:this.options.resizable),this.gesturable("gesturable"in e?e.gesturable:this.options.gesturable),"autoScroll"in e&&this.autoScroll(e.autoScroll),this},unset:function(){return an.remove(this,"all"),"string"==typeof this.selector?delete xt[this.selector]:(an.remove(this,"all"),this.options.styleCursor&&(this._element.style.cursor=""),this._gesture&&(this._gesture.target=null),St.splice(St.indexOf(this.element()))),this.dropzone(!1),wt.splice(wt.indexOf(this),1),V}},J.prototype.gestureable=J.prototype.gesturable,J.prototype.resizeable=J.prototype.resizable,V.isSet=function(e){return-1!==wt.indexOfElement(e)},V.on=function(e,t,n){return-1!==Qt.indexOf(e)?Gt[e]?-1===Gt[e].indexOf(t)&&Gt[e].push(t):Gt[e]=[t]:an.add(sn,e,t,n),V},V.off=function(e,t,n){if(-1===Qt.indexOf(e))an.remove(sn,e,t,n);else{var r;e in Gt&&-1!==(r=Gt[e].indexOf(t))&&Gt[e].splice(r,1)}return V},V.simulate=function(e,n,r){var i,s,o={};if("resize"===e&&(e="resizexy"),e in Vt){if(r)for(i in r)r.hasOwnProperty(i)&&(o[i]=r[i]);else s=Lt._element instanceof Y?n.getBoundingClientRect():s=n.getClientRects()[0],"drag"===e?(o.pageX=s.left+s.width/2,o.pageY=s.top+s.height/2):(o.pageX=s.right,o.pageY=s.bottom);return o.target=o.currentTarget=n,o.preventDefault=o.stopPropagation=t,L(o,e),V}return V},V.enableDragging=function(e){return null!==e&&void 0!==e?($t.drag=e,V):$t.drag},V.enableResizing=function(e){return null!==e&&void 0!==e?($t.resize=e,V):$t.resize},V.enableGesturing=function(e){return null!==e&&void 0!==e?($t.gesture=e,V):$t.gesture},V.eventTypes=Qt,V.debug=function(){return{target:Lt,dragging:Ut,resizing:Wt,gesturing:Rt,prepared:Jt,prevCoords:ot,downCoords:at,pointerIds:lt,pointerMoves:ct,addPointer:_,removePointer:D,recordPointers:P,inertia:yt,downTime:ht,downEvent:pt,prevEvent:dt,Interactable:J,IOptions:$,interactables:wt,dropzones:Et,pointerIsDown:It,defaultOptions:Dt,actions:Vt,dragMove:H,resizeMove:B,gestureMove:j,pointerUp:U,pointerDown:L,pointerMove:M,pointerHover:R,events:an,globalEvents:Gt,delegatedEvents:Ct}},V.getTouchAverage=c,V.getTouchBBox=h,V.getTouchDistance=p,V.getTouchAngle=d,V.getElementRect=f,V.margin=function(e){return"number"==typeof e?(Ft=e,V):Ft},V.styleCursor=function(e){return"boolean"==typeof e?(Dt.styleCursor=e,V):Dt.styleCursor},V.autoScroll=function(t){var r=Dt.autoScroll;return t instanceof Object?(Dt.autoScrollEnabled=!0,"number"==typeof t.margin&&(r.margin=t.margin),"number"==typeof t.speed&&(r.speed=t.speed),r.container=n(t.container)||t.container instanceof e.Window?t.container:r.container,V):"boolean"==typeof t?(Dt.autoScrollEnabled=t,V):Dt.autoScrollEnabled?r:!1},V.snap=function(e){var t=Dt.snap;return e instanceof Object?(Dt.snapEnabled=!0,"string"==typeof e.mode&&(t.mode=e.mode),"boolean"==typeof e.endOnly&&(t.endOnly=e.endOnly),"number"==typeof e.range&&(t.range=e.range),e.actions instanceof Array&&(t.actions=e.actions),e.anchors instanceof Array&&(t.anchors=e.anchors),e.grid instanceof Object&&(t.grid=e.grid),e.gridOffset instanceof Object&&(t.gridOffset=e.gridOffset),V):"boolean"==typeof e?(Dt.snapEnabled=e,V):{enabled:Dt.snapEnabled,mode:t.mode,actions:t.actions,grid:t.grid,gridOffset:t.gridOffset,anchors:t.anchors,paths:t.paths,range:t.range,locked:Pt.locked,x:Pt.x,y:Pt.y,realX:Pt.realX,realY:Pt.realY,dx:Pt.dx,dy:Pt.dy}},V.inertia=function(e){var t=Dt.inertia;return e instanceof Object?(Dt.inertiaEnabled=!0,"number"==typeof e.resistance&&(t.resistance=e.resistance),"number"==typeof e.minSpeed&&(t.minSpeed=e.minSpeed),"number"==typeof e.endSpeed&&(t.endSpeed=e.endSpeed),"boolean"==typeof e.zeroResumeDelta&&(t.zeroResumeDelta=e.zeroResumeDelta),e.actions instanceof Array&&(t.actions=e.actions),V):"boolean"==typeof e?(Dt.inertiaEnabled=e,V):{enabled:Dt.inertiaEnabled,resistance:t.resistance,minSpeed:t.minSpeed,endSpeed:t.endSpeed,actions:t.actions,zeroResumeDelta:t.zeroResumeDelta}},V.supportsTouch=function(){return jt},V.currentAction=function(){return Ut&&"drag"||Wt&&"resize"||Rt&&"gesture"||null},V.stop=function(e){if(Ut||Wt||Rt){Bt.stop(),Nt=[],Lt.options.styleCursor&&(Q.documentElement.style.cursor=""),Lt._gesture&&Lt._gesture.stop(),X();for(var t=0;t<Tt.length;t++)Tt._elements=[];e&&"function"==typeof e.preventDefault&&e.preventDefault()}return lt&&lt.length&&(lt.splice(0),ct.splice(0)),It=Pt.locked=Ut=Wt=Rt=!1,Jt=dt=null,V},V.dynamicDrop=function(e){return"boolean"==typeof e?(Ut&&zt!==e&&!e&&m(Et),zt=e,V):zt},V.deltaSource=function(e){return"page"===e||"client"===e?(Dt.deltaSource=e,this):Dt.deltaSource},V.restrict=function(e){var t=Dt.restrict;return void 0===e?Dt.restrict:(e instanceof Object?((e.drag instanceof Object||/^parent$|^self$/.test(e.drag))&&(t.drag=e.drag),(e.resize instanceof Object||/^parent$|^self$/.test(e.resize))&&(t.resize=e.resize),(e.gesture instanceof Object||/^parent$|^self$/.test(e.gesture))&&(t.gesture=e.gesture),"boolean"==typeof e.endOnly&&(t.endOnly=e.endOnly)):null===e&&(t.drag=t.resize=t.gesture=null,t.endOnly=!1),this)},rt?(an.add(sn,"pointerup",N),an.add(sn,"pointerdown",k),an.add(sn,"MSGestureChange",M),an.add(sn,"MSGestureEnd",U),an.add(sn,"MSInertiaStart",U),an.add(sn,"pointerover",I),an.add(sn,"pointerout",q),an.add(sn,"pointermove",P),an.add(sn,"pointerup",P),an.add(sn,"pointercancel",P),an.add(sn,"pointerup",function(){Ut||Wt||Rt||(It=!1)}),kt=new nt,kt.target=Q.documentElement):(an.add(sn,"mouseup",N),an.add(sn,"touchend",N),an.add(sn,"mousedown",k),an.add(sn,"mousemove",M),an.add(sn,"mouseup",U),an.add(sn,"mouseover",I),an.add(sn,"mouseout",q),an.add(sn,"touchstart",k),an.add(sn,"touchmove",M),an.add(sn,"touchend",U),an.add(sn,"touchcancel",U)),an.add(rn,"blur",U);try{e.frameElement&&(un._element=e.frameElement.ownerDocument,an.add(un,"mouseup",U),an.add(un,"touchend",U),an.add(un,"touchcancel",U),an.add(un,"pointerup",U),an.add(on,"blur",U))}catch(fn){V.windowParentError=fn}an.add(sn,"selectstart",function(e){(Ut||Wt||Rt)&&e.preventDefault()}),en in Element.prototype&&"function"==typeof Element.prototype[en]||(Element.prototype[en]=K=function(e,t){t=t||this.parentNode.querySelectorAll(e);for(var n=t.length,r=0;n>r;r++)if(t[r]===this)return!0;return!1}),function(){for(var t=0,n=["ms","moz","webkit","o"],r=0;r<n.length&&!e.requestAnimationFrame;++r)tn=e[n[r]+"RequestAnimationFrame"],nn=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];tn||(tn=function(n){var r=(new Date).getTime(),i=Math.max(0,16-(r-t)),s=e.setTimeout(function(){n(r+i)},i);return t=r+i,s}),nn||(nn=function(e){clearTimeout(e)})}(),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=V),exports.interact=V):e.interact=V}(this),define("interact",["underscore"],function(e){return function(){var t,n;return t||e.interact}}(this)),define("apps/activities/listActivities/listActivities_view",["app","text!apps/activities/listActivities/templates/activity_item.html","text!apps/activities/listActivities/templates/activity_map.html","text!apps/activities/listActivities/templates/activity_tile.html","interact"],function(e,t,n,r,i){return e.module("ActivitiesApp.ListActivities.View",function(e,i,s,o,u,a){e.Activity=o.ItemView.extend({className:"activity-wrapper btnActivityNoGap col-md4 col-xs-12 col-lg-1 drag-drop",template:a.template(t),events:{"click .js-move":"activityClickedDetected"},modelEvents:{"change:x":"xChanged","change:y":"yChanged"},xChanged:function(e,t){this.trigger("checkpoint:xChanged",t)},yChanged:function(e,t){this.trigger("checkpoint:xChanged",t)},deleteActivityClicked:function(){this.trigger("activity:delete",this.model)},editActivityClicked:function(e){e.preventDefault(),this.trigger("activity:edit",this.model)},renameActivityClicked:function(e){this.trigger("activity:rename",this.model)},remove:function(){var e=this;o.ItemView.prototype.remove.call(this)},initialize:function(){this.model.on("change",this.render)},activityClickedDetected:function(e){this.trigger("element:show",this.model)}}),e.Activities=o.CompositeView.extend({className:"container-fluid activity-area activity-blue-glow padding-0px",template:a.template(n),childView:e.Activity,childViewContainer:"#adventure-view",triggers:{"click .js-new-activity":"activity:new","click .js-select":"plugin:show:adventurePicker","click .js-edit":"activity:show:editor"},onRender:function(){console.log("####Activities are rendered")}}),e.ActivityTile=o.ItemView.extend({className:"activity-wrapper-tiles",template:a.template(r),triggers:{"click .js-toggle-hor":"tile:toggle:hor","click .js-toggle-ver":"tile:toggle:ver"}}),e.ActivityTiles=o.CollectionView.extend({childView:e.ActivityTile,onRender:function(){console.log("####Tiles Collections are rendered")}})}),e.ActivitiesApp.ListActivities.View}),define("entities/tile/tile_model",["jquery","underscore","backbone","app"],function(e,t,n,r){return Tile=n.Model.extend({idAttribute:"_id",parse:function(e){return this.set("_id",e._id),e},defaults:{x:"",y:"",a:!1},clear:function(){console.log("destroy"),this.destroy()}}),r.reqres.setHandler("tile:entity:new",function(e){return new Tile}),Tile}),define("entities/tile/tile_collection",["jquery","underscore","backbone","app","entities/tile/tile_model"],function(e,t,n,r,i){function a(){var e=new TileCollection;e.idLesson=o;var t=5,n=5,r=1,i=0,s=t*4+(t-1)*5;for(var u=0;u<s;u++)i%2===1?r>0?r%8===0?(f(r,i,"linkver",e),r=1,i+=1):(f(r,i,"linkver",e),r+=2):(console.log("Tiles-> x:"+r+" y: "+i),f(r,i,"linkver",e),r+=2):i%2===0&&(r%7===0?(f(r,i,"linkhor",e),r=0,i+=1):(f(r,i,"linkhor",e),r+=2));var a=5,l=5,c=0,h=0,p=a*l;for(var u=0;u<p;u++)c===0?(f(c,h,"dropzone",e),c+=2):c%8===0?(f(c,h,"dropzone",e),c=0,h+=2):(f(c,h,"dropzone",e),c+=2);return console.log(e),e}function f(e,t,n,r){var s="link",o=n;n==="dropzone"&&(s="dropzone",o="dropzone");var u=new i({tileTitle:s,x:e,y:t,tileType:o,activated:!1});r.add(u)}TileCollection=n.Collection.extend({model:i,url:function(){return"/adventures/edit/"+this.idLesson},parse:function(e){return e.tiles},initialize:function(e,t){this.idLesson=t}});var s=JSON.parse(e("#data-session").html()),o=s._id,u=function(){if(s.tiles===null||typeof s.tiles=="undefined")var e=a();else{var e=a();t.each(s.tiles,function(n){var r=e.where({x:n.x,y:n.y});t.each(r,function(e){e.set({a:!0})})})}return e},l={getTileEntities:function(t){var n={},r=new TileCollection(n,o),i=e.Deferred();return r.fetch({success:function(e){i.resolve(e)}}),i.promise()},getTileEntitiesFromHTML:function(){var e=u();return e}};return r.reqres.setHandler("tile:entities",function(){return l.getTileEntities()}),r.reqres.setHandler("tile:entities:initialized",function(){return l.getTileEntitiesFromHTML()}),TileCollection}),define("entities/lesson/lesson_model",["jquery","underscore","backbone","app","entities/tile/tile_collection"],function(e,t,n,r,i){Lesson=n.Model.extend({idAttribute:"_id",url:function(){return"/adventures/edit/"+u},model:{tiles:i},parse:function(e){this.set("_id",e._id);for(var t in this.model){var n=this.model[t],r=e[t];e[t]=new n(r)}return e},defaults:{lessonName:"",tiles:"",isLocked:!1,backgroundImageURL:""},initialize:function(e){if(e&&!(e.tiles instanceof n.Collection)){var t=this.model.tiles,r=e.tiles;e.tiles=new t(r),this.set("tiles",e.tiles)}},toggleSelected:function(){this.set({selected:!this.get("selected")})},clear:function(){console.log("destroy"),this.destroy()}});var s=JSON.parse(e("#data-session").html()),o=s.idSession,u=s.idLesson,a=s.lessonName,f=s.isLocked,l=function(){var e=r.request("tile:entities:initialized");return e},c={getLessonEntity:function(t){var n=new Lesson({_id:t}),r=e.Deferred();return n.fetch({success:function(e){r.resolve(e),console.log("success")},error:function(e){r.resolve(undefined),console.log("fail")}}),r.promise()},getLessonEntityInitialized:function(){var e=new Lesson({_id:o,lessonName:a,lessonEditorId:u,isLocked:f});return e.set("backgroundImageURL",s.backgroundImageURL),e.set("tiles",l()),e}};return r.reqres.setHandler("lesson:entity",function(e){return c.getLessonEntity(e)}),r.reqres.setHandler("lesson:entity:initialized",function(){return c.getLessonEntityInitialized()}),r.reqres.setHandler("lesson:entity:new",function(e){return new Lesson}),Lesson}),define("apps/activities/listActivities/listActivities_controller",["app","apps/activities/listActivities/listActivities_view","interact","bootbox","bootstrap"],function(e,t,n,r){return e.module("ActivitiesApp.ListActivities",function(e,n,i,s,o,u){function l(i){n.reqres.setHandler("activities",function(){return i});var s=e.Controller;u.each(i.models,function(e){typeof e.get("elements")!="undefined"&&u.each(e.get("elements").models,function(e){if(e.get("isImage")){var t=e.get("resourceUrl");window.imgPreloader.push(t)}})}),require(["entities/lesson/lesson_model"],function(){var e=n.request("lesson:entity:initialized");o.when(e).done(function(e){function l(e){var n=new t.ActivityTiles({collection:e});o("#adventure-view").prepend(o(n.render().el)),o(".activity-wrapper-dropzone").unwrap();var r=o(".activity-coordinate");u.each(r,function(e){var t=o(e).data(),n=t.x,r=t.y;o(e).parent().parent().css({left:n*a,top:r*f})})}var s=new t.Activities({collection:i,model:e});n.mainRegion.show(s),n.reqres.setHandler("activity:list:view",function(){return s});var a=72,f=60;l(e.get("tiles")),s.on("childview:element:show",function(e){var t=e.model,i=t.get("activityType");switch(i){case"wordList":console.log("Clicked show  app -> %O",t);var s;s=t.get("pluginApp"),console.log("app",t.get("pluginApp"));if(s===""){r.alert("No apps assigned, please add it in your Adventure");return}n.trigger("plugin:show",s);break;case"media":console.log("Clicked show media ->"),n.trigger("elements:list:local",t)}}),s.on("plugin:show:adventurePicker",function(e){var t="/plugins/lessonPicker/lessonPickerTeacher.html",r={trigger:"internal",full:!0};n.trigger("plugin:show:url",t,r)}),s.on("activity:show:editor",function(e){var t="/adventures/edit/"+e.collection.lessonEditorId;window.open(t,"_top"),console.log("show editor")}),s.on("activity:new",function(e){var t="/adventures/edit/";window.open(t,"_top")})})})}var a=25,f=s.Controller.extend({listActivities:function(e){e===undefined||e===null?require(["entities/activity/activity_collection"],function(){var e=n.request("activity:entities");o.when(e).done(function(e){l(e)})}):e.initialized?(console.log("options.initialized"),require(["entities/activity/activity_collection"],function(){var e=n.request("activity:entities:initialized");l(e)})):e.activities&&l(e.activities)}});e.Controller=new f}),e.ActivitiesApp.ListActivities.Controller}),define("entities/pluginType/pluginType_model",["jquery","underscore","backbone","app"],function(e,t,n,r){var i=n.Model.extend({idAttribute:"_id",url:function(){return t.result(this.collection,"url")+(this.isNew()?"":this.id+"/")},parse:function(e){return this.set("_id",e._id),e},defaults:{title:"",category:"",plugins:""},initialize:function(e){},clear:function(){console.log("destroy"),this.destroy()}}),s={getPluginEntity:function(t){var n=new i({id:t}),r=e.Deferred();return n.fetch({success:function(e){r.resolve(e)},error:function(e){r.resolve(undefined)}}),r.promise()}};return r.reqres.setHandler("pluginType:entity",function(e){return s.getPluginEntity(e)}),r.reqres.setHandler("pluginType:entity:new",function(e){return new i}),i}),define("entities/plugin/plugin_model",["jquery","underscore","backbone","app"],function(e,t,n,r){var i=n.Model.extend({idAttribute:"_id",url:function(){return t.result(this.collection,"url")+(this.isNew()?"":this.id+"/")},parse:function(e){return this.set("_id",e._id),e},defaults:{pluginURL:"",pluginTeacherURL:"",pluginTitle:"",pluginServerPath:"",category:"",thumbnail:"",index:""},initialize:function(e){},clear:function(){console.log("destroy"),this.destroy()}}),s={getPluginEntity:function(t){var n=new i({id:t}),r=e.Deferred();return n.fetch({success:function(e){r.resolve(e)},error:function(e){r.resolve(undefined)}}),r.promise()}};return r.reqres.setHandler("plugin:entity",function(e){return s.getPluginEntity(e)}),r.reqres.setHandler("plugin:entity:new",function(e){return new i}),i}),define("entities/plugin/plugin_collection",["jquery","underscore","backbone","app","entities/plugin/plugin_model"],function(e,t,n,r,i){function f(e){t.each(e.models,function(e){var t=e.collection.indexOf(e)+1;e.set("index",t)},this)}PluginCollection=n.Collection.extend({model:i,url:function(){},parse:function(e){return e.plugins},initialize:function(e,t){this.idSession=t},selected:function(){return this.filter(function(e){return e.get("selected")})},remaining:function(){return this.without.apply(this,this.selected())}});var s=JSON.parse(e("#data-session").html()),o=s.idSession,u=function(){var e=new PluginCollection(s.plugins,o);return f(e),e},a={getActivityEntities:function(t){var n={},r=new PluginCollection(n,o),i=e.Deferred();return r.fetch({success:function(e){i.resolve(e),f(r)}}),i.promise()},getPluginEntitiesFromHTML:function(){var e=u();return f(e),e},getPluginEntitiesInitialized:function(){var e=[{_id:"1",thumbnail:"fa-random",pluginTitle:"Randomizer",type:"",index:"",pluginURL:"/plugins/randomizer/randomizerTeacher.html"},{_id:"2",thumbnail:"fa-columns",pluginTitle:"Sort Me",type:"",index:"",pluginURL:"/plugins/sortMe/sortMeTeacher.html"},{_id:"3",thumbnail:"fa-bolt",pluginTitle:"Word Attack",type:"",index:"",pluginURL:"/plugins/wordAttack/wordAttackTeacher.html"},{_id:"4",thumbnail:"fa-dot-circle-o",pluginTitle:"Buzzer",type:"",index:"",pluginURL:"/plugins/buzzer/buzzerTeacher.html"},{_id:"5",thumbnail:"fa-circle-o",pluginTitle:"Word Wheel",type:"",index:"",pluginURL:"/plugins/wheelWord/wheelWordTeacher.html"},{_id:"6",thumbnail:"fa-bar-chart-o",pluginTitle:"Quick Poll",type:"",index:"",pluginURL:"/plugins/quickPoll/quickPollTeacher.html"},{_id:"7",thumbnail:"fa-pencil",pluginTitle:"Open Response",type:"",index:"",pluginURL:"/plugins/openResponse/openResponseTeacher.html"},{_id:"8",thumbnail:"fa-search",pluginTitle:"Word Search",type:"",index:"",pluginURL:"/plugins/wordSearch/wordSearchTeacher.html"}],t=new PluginCollection(e);return f(t),t}};return r.reqres.setHandler("plugins:entities",function(){return a.getPluginEntities()}),r.reqres.setHandler("plugins:entities:initialized",function(){return a.getPluginEntitiesInitialized()}),PluginCollection}),define("entities/pluginType/pluginType_collection",["jquery","underscore","backbone","app","entities/pluginType/pluginType_model","entities/plugin/plugin_collection"],function(e,t,n,r,i,s){function l(e){t.each(e.models,function(e){var t=e.collection.indexOf(e)+1;e.set("index",t)},this)}PluginTypeCollection=n.Collection.extend({model:i,url:function(){return"/plugins/plugins.json"},parse:function(e){return e.pluginTypes},initialize:function(e,t){this.idSession=t},selected:function(){return this.filter(function(e){return e.get("selected")})},remaining:function(){return this.without.apply(this,this.selected())}});var o=JSON.parse(e("#data-session").html()),u=o.idSession,a=function(){var e=new PluginTypeCollection(o.pluginTypes,u);return l(e),e},f={getPluginTypesEntities:function(n){var r={},i=new PluginTypeCollection(r,u),o=e.Deferred();return i.fetch({success:function(e){t.each(e.models,function(e){var t=e.get("plugins"),n=new s(t);e.set("plugins",n)}),o.resolve(e),l(i)}}),o.promise()},getPluginEntitiesFromHTML:function(){var e=a();return l(e),e},getPluginTypesEntitiesInitialized:function(){var e=[{_id:"1",thumbnail:"fa-random",pluginTitle:"Randomizer",type:"",index:"",pluginURL:"/pluginTypes/randomizer/randomizerTeacher.html"},{_id:"2",thumbnail:"fa-columns",pluginTitle:"Sort Me",type:"",index:"",pluginURL:"/pluginTypes/sortMe/sortMeTeacher.html"},{_id:"3",thumbnail:"fa-bolt",pluginTitle:"Word Attack",type:"",index:"",pluginURL:"/pluginTypes/wordAttack/wordAttackTeacher.html"},{_id:"4",thumbnail:"fa-dot-circle-o",pluginTitle:"Buzzer",type:"",index:"",pluginURL:"/pluginTypes/buzzer/buzzerTeacher.html"},{_id:"5",thumbnail:"fa-circle-o",pluginTitle:"Word Wheel",type:"",index:"",pluginURL:"/pluginTypes/wheelWord/wheelWordTeacher.html"},{_id:"6",thumbnail:"fa-bar-chart-o",pluginTitle:"Quick Poll",type:"",index:"",pluginURL:"/pluginTypes/quickPoll/quickPollTeacher.html"},{_id:"7",thumbnail:"fa-pencil",pluginTitle:"Open Response",type:"",index:"",pluginURL:"/pluginTypes/openResponse/openResponseTeacher.html"},{_id:"8",thumbnail:"fa-search",pluginTitle:"Word Search",type:"",index:"",pluginURL:"/plugins/wordSearch/wordSearchTeacher.html"}],t=new PluginTypeCollection(e);return l(t),t}};return r.reqres.setHandler("pluginTypes:entities",function(){return f.getPluginTypesEntities()}),r.reqres.setHandler("pluginTypes:entities:initialized",function(){return f.getPluginTypesEntitiesInitialized()}),PluginTypeCollection}),define("apps/activities/activities_app",["app"],function(e){e.module("ActivitiesApp",function(e,t,n,r,i,s){e.onStart=function(){console.log("Starting ActivitiesApp")},e.onStop=function(){console.log("Stopping ActivitiesApp")}}),e.module("Router.ActivitiesApp",function(e,t,n,r,i,s){e.Router=r.AppRouter.extend({appRoutes:{"":"listActivitiesInitialized"}}),ActivitiesAPI={listActivities:function(e){require(["apps/activities/listActivities/listActivities_controller"],function(e,t){})},listActivitiesInitialized:function(e){require(["apps/activities/listActivities/listActivities_controller"],function(e){var t={initialized:!0};e.listActivities(t)})}},t.on("activities:listActivities",function(e){ActivitiesAPI.listActivities(e)}),t.on("activities:listActivities:initialized",function(){console.log("activities:listActivities:initialized");var e={initialized:!0};ActivitiesAPI.listActivitiesInitialized(e)}),t.on("activities:listActivities:initialized:noroute",function(){console.log("activities:listActivities:initialized:noroute");var e={initialized:!0};ActivitiesAPI.listActivities(e)}),t.addInitializer(function(){new e.Router({controller:ActivitiesAPI});var n;t.reqres.setHandler("plugins",function(e){return n}),require(["entities/pluginType/pluginType_collection"],function(){var e=t.request("pluginTypes:entities");i.when(e).done(function(e){n=e})})})})}),define("text!apps/dialog/show/templates/dialog.html",[],function(){return'<div class="modal-dialog">\r\n    <div class="modal-content">\r\n      <div class="modal-header">\r\n        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\r\n        <h4 class="modal-title" id="myModalLabel"><%= title %></h4>\r\n      </div>\r\n      <div class="modal-body">       \r\n        <div class="container-fluid" >\r\n          <iframe scrolling="yes" id="frameDialog" src="<%= resourceUrl %>" frameborder="0"></iframe>\r\n        </div>        \r\n      </div>\r\n    </div>\r\n  </div>'}),define("text!apps/dialog/show/templates/loadingDialog.html",[],function(){return'<div class="dialog-spin-area" style="color:white">\r\n  <i class="fa fa-spinner fa-3x fa-spin i-spinning-dialog"></i>  \r\n</div>'}),define("apps/dialog/show/dialogShow_view",["app","text!apps/dialog/show/templates/dialog.html","text!apps/dialog/show/templates/loadingDialog.html"],function(e,t,n){return e.module("DialogApp.Show.View",function(e,r,i,s,o,u){e.Dialog=s.ItemView.extend({template:u.template(t),className:"modal custom fade",id:"myModal",attributes:{tabindex:"-1",role:"dialog","aria-labelledby":"myModalLabel","aria-hidden":"true"},onShow:function(){console.log("dialogshow1"),o("#myModal").modal("show")}}),e.LoadingDialog=s.ItemView.extend({template:u.template(n),className:"modal custom fade",id:"myModal",attributes:{tabindex:"-1",role:"dialog","aria-labelledby":"myModalLabel","aria-hidden":"true"},onShow:function(){console.log("loadingDialogShow"),o("#myModal").modal({backdrop:"static",keyboard:!1})}})}),e.DialogApp.Show.View}),define("apps/dialog/show/dialogShow_controller",["app","apps/dialog/show/dialogShow_view","bootstrap","bootbox"],function(e,t){return e.module("DialogApp.Show",function(e,n,r,i,s,o){e.Controller={showDialog:function(e,i){var s=new r.Model({resourceUrl:e,title:i}),o=new t.Dialog({model:s});n.dialogRegion.show(o)},showLoadingDialog:function(){var e=new t.LoadingDialog;document.socketID||n.dialogRegion.show(e)}}}),e.DialogApp.Show.Controller}),define("apps/dialog/dialog_app",["app"],function(e){e.module("Router.ElementsApp",function(e,t,n,r,i,s){DialogAPI={showDialog:function(e,t){require(["apps/dialog/show/dialogShow_controller"],function(n){n.showDialog(e,t)})},showLoadingDialog:function(){require(["apps/dialog/show/dialogShow_controller"],function(e){e.showLoadingDialog()})}},t.on("dialog:show",function(e,t){DialogAPI.showDialog(e,t)}),t.on("dialog:show:loading",function(){DialogAPI.showLoadingDialog()})}),e.addInitializer(function(){jq(window.document).off("DialogUrl"),jq(window.document).on("DialogUrl",function(t,n){var r=n.detail;switch(r.type){case"UrlUpdate":var i=r.resourceURL;$(".modal-backdrop").remove(),e.trigger("dialog:show",i,r.title)}})})}),define("text!apps/plugins/show/templates/pluginsShow_template.html",[],function(){return'<div class="plugin-title text-center"><i class="fa <%= icon %>"></i> <%= pluginTitle %></div>\r\n<div class="plugin-desc-wrapper ">  \r\n  <div class="plugin-desc-text text-center"><%= desc %></div>\r\n</div>\r\n<iframe id="frameMiniApp" data-plugin="<%= plugin %>" src="<%= url %>" frameborder="0"></iframe>\r\n<a href="#" class="js-expand plugin-expand"><i class="fa fa-expand"></i></a>\r\n<a href="#" class="js-close plugin-close"><i class="fa fa-arrow-left"></i></a>\r\n<!--<button class="btn btn-default js-url">Show</button> \r\n<button class="btn btn-default js-back">Back</button>-->'}),define("text!apps/plugins/show/templates/pluginsShowFull_template.html",[],function(){return'<iframe id="frameMiniApp" src="<%= url %>" frameborder="0"></iframe>\r\n<a href="#" class="js-close plugin-app-close"><i class="fa fa-times "></i></a>\r\n<!--<button class="btn btn-default js-url">Show</button> \r\n<button class="btn btn-default js-back">Back</button>-->'}),define("apps/plugins/show/pluginsShow_view",["app","text!apps/plugins/show/templates/pluginsShow_template.html","text!apps/plugins/show/templates/pluginsShowFull_template.html"],function(e,t,n){return e.module("PluginApps.Show.View",function(e,r,i,s,o,u){e.Element=s.ItemView.extend({template:u.template(t),className:"container-fluid padding-0px plugin-types-area",events:{"click .js-url":"launchPlugin","click .js-close":"exitPlugin","click .js-expand":"expandPlugin"},exitPlugin:function(e){e.preventDefault(),this.trigger("plugin:exit",this)},launchPlugin:function(){var e="//www.youtube.com/embed/hLQl3WQQoQ0",t="";this.trigger("plugin:show",e,t)},expandPlugin:function(e){e.preventDefault(),this.trigger("plugin:expand")},onShow:function(){o("#frameMiniApp").length>0&&r.trigger("plugins:list:show:toggle")}}),e.ElementFull=s.ItemView.extend({template:u.template(n),className:"container-fluid padding-0px plugin-area",events:{"click .js-url":"launchPlugin","click .js-close":"exitPlugin","click .js-expand":"expandPlugin"},exitPlugin:function(e){e.preventDefault(),this.trigger("plugin:exit")},expandPlugin:function(e){e.preventDefault(),this.trigger("plugin:expand")},launchPlugin:function(){var e="//www.youtube.com/embed/hLQl3WQQoQ0",t="";this.trigger("plugin:show",e,t)}})}),e.PluginApps.Show.View}),define("apps/plugins/show/pluginsShow_controller",["app","apps/plugins/show/pluginsShow_view"],function(e,t){return e.module("PluginApps.Show",function(e,n,r,i,s,o){function a(e,t){var n=s(".js-show-plugins").find(".btn-plugins-icon");if(e)if(t){var r=e.get("icon");s(".plugin-types-area").hasClass("visible")!==!1&&s(".js-show-plugins").addClass("plugin-active"),n.removeClass().addClass("fa fa-2x btn-plugins-icon").addClass(r)}else s(".js-show-plugins").removeClass("plugin-active"),n.removeClass().addClass("fa fa-2x btn-plugins-icon fa-fire")}function f(e){var t,r=n.request("plugins");return console.log("plugins requested %O",r),o.each(r.models,function(n){var r=n.get("plugins"),i;i=r.findWhere({plugin:e}),typeof i!="undefined"&&(t=i,console.log("pluginFound -> %O",t))}),t}function l(e){typeof e!="undefined"&&(e.get("pluginTeacherURL")?window.isDevelopment===!1||typeof window.isDevelopment=="undefined"?(e.set("url",e.get("pluginTeacherURLDist")),console.log(e.get("pluginTeacherURLDist"))):(e.set("url",e.get("pluginTeacherURL")),console.log(e.get("pluginTeacherURL"))):e.set("url","about:blank"))}function c(e,t){t.full?t.full&&p(e):h(e)}function h(r){var i=e.Controller,s=new t.Element({model:r});n.pluginsView.show(s),i.listenTo(s,"plugin:exit",function(e){n.trigger("plugins:list:back")}),i.listenTo(s,"plugin:expand",function(e){d()}),i.listenTo(s,"plugin:backToAdventure",function(e,t){n.backToRoot()}),i.listenTo(s,"plugin:show",function(e,t){var n={type:"UrlUpdate",options:"",resourceURL:e},r=new CustomEvent("Plugin",{detail:n});document.dispatchEvent(r)})}function p(r){var i=e.Controller,o=new t.ElementFull({model:r});n.pluginAppRegion.on("show",function(e){s(e.$el).parent().css("display","block")}),n.pluginAppRegion.show(o),i.listenTo(o,"plugin:exit",function(e){n.pluginAppRegion.empty(),s("#pluginApp-region").css("display","none")}),i.listenTo(o,"plugin:backToAdventure",function(e,t){n.backToRoot()})}function d(){s("#plugins-view").toggleClass("minimized-plugins-view")}var u=i.Controller.extend({showPlugin:function(e,t){require(["entities/plugin/plugin_collection"],function(){var n;n=f(e),l(n),c(n,t)})},showPluginInternal:function(e,t){l(e),c(e,t)},showPluginWithUrl:function(e,t){c(e,t)},pluginShowUpdate:function(e,t){var n;n=f(e),a(n,t)}});e.Controller=new u}),e.PluginApps.Show.Controller}),define("apps/plugins/Show/pluginsShow_controller",["app","apps/plugins/show/pluginsShow_view"],function(e,t){return e.module("PluginApps.Show",function(e,n,r,i,s,o){function a(e,t){var n=s(".js-show-plugins").find(".btn-plugins-icon");if(e)if(t){var r=e.get("icon");s(".plugin-types-area").hasClass("visible")!==!1&&s(".js-show-plugins").addClass("plugin-active"),n.removeClass().addClass("fa fa-2x btn-plugins-icon").addClass(r)}else s(".js-show-plugins").removeClass("plugin-active"),n.removeClass().addClass("fa fa-2x btn-plugins-icon fa-fire")}function f(e){var t,r=n.request("plugins");return console.log("plugins requested %O",r),o.each(r.models,function(n){var r=n.get("plugins"),i;i=r.findWhere({plugin:e}),typeof i!="undefined"&&(t=i,console.log("pluginFound -> %O",t))}),t}function l(e){typeof e!="undefined"&&(e.get("pluginTeacherURL")?window.isDevelopment===!1||typeof window.isDevelopment=="undefined"?(e.set("url",e.get("pluginTeacherURLDist")),console.log(e.get("pluginTeacherURLDist"))):(e.set("url",e.get("pluginTeacherURL")),console.log(e.get("pluginTeacherURL"))):e.set("url","about:blank"))}function c(e,t){t.full?t.full&&p(e):h(e)}function h(r){var i=e.Controller,s=new t.Element({model:r});n.pluginsView.show(s),i.listenTo(s,"plugin:exit",function(e){n.trigger("plugins:list:back")}),i.listenTo(s,"plugin:expand",function(e){d()}),i.listenTo(s,"plugin:backToAdventure",function(e,t){n.backToRoot()}),i.listenTo(s,"plugin:show",function(e,t){var n={type:"UrlUpdate",options:"",resourceURL:e},r=new CustomEvent("Plugin",{detail:n});document.dispatchEvent(r)})}function p(r){var i=e.Controller,o=new t.ElementFull({model:r});n.pluginAppRegion.on("show",function(e){s(e.$el).parent().css("display","block")}),n.pluginAppRegion.show(o),i.listenTo(o,"plugin:exit",function(e){n.pluginAppRegion.empty(),s("#pluginApp-region").css("display","none")}),i.listenTo(o,"plugin:backToAdventure",function(e,t){n.backToRoot()})}function d(){s("#plugins-view").toggleClass("minimized-plugins-view")}var u=i.Controller.extend({showPlugin:function(e,t){require(["entities/plugin/plugin_collection"],function(){var n;n=f(e),l(n),c(n,t)})},showPluginInternal:function(e,t){l(e),c(e,t)},showPluginWithUrl:function(e,t){c(e,t)},pluginShowUpdate:function(e,t){var n;n=f(e),a(n,t)}});e.Controller=new u}),e.PluginApps.Show.Controller}),define("text!apps/plugins/list/templates/plugins_item.html",[],function(){return'<div class="btn-app-area campfireapp-normal js-show">\r\n  <a class="btn-app btn-campfire" href="#">\r\n    <i class="fa <%= icon %> fa-4x"></i>\r\n  </a>\r\n</div>\r\n  \r\n<div class="btn-app-icon-description">\r\n  <span ><%= pluginTitle %></span> \r\n</div>\r\n'}),define("text!apps/plugins/list/templates/plugins_template.html",[],function(){return'<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">  \r\n  <span class="adventure-font campfireapp-types-title"><%= title %></span>\r\n  <div class="plugins-js"></div>\r\n</div>\r\n\r\n\r\n'}),define("text!apps/plugins/list/templates/pluginsTypes_template.html",[],function(){return'\r\n<div id="plugins-view" class="plugins-view-wrapper minimized-plugins-view"></div>\r\n\r\n<div title="Choose Plugin" class="btn-plugins text-center js-show-plugins">\r\n  <i class="fa fa-fire btn-plugins-icon fa-2x"></i>\r\n  <span></span>\r\n</div>\r\n\r\n\r\n'}),define("apps/plugins/list/pluginsList_view",["app","text!apps/plugins/list/templates/plugins_item.html","text!apps/plugins/list/templates/plugins_template.html","text!apps/plugins/list/templates/pluginsTypes_template.html","bootstrap"],function(e,t,n,r){return e.module("PluginApps.List.View",function(e,i,s,o,u,a){e.Plugin=o.ItemView.extend({className:"plugin-wrapper",template:a.template(t),events:{"click .js-show":"showPluginClicked"},showPluginClicked:function(e){e.preventDefault(),console.log("showPluginClicked"),this.trigger("plugin:show",this,this.model)},remove:function(){var e=this;o.ItemView.prototype.remove.call(this)},initialize:function(){}}),e.Plugins=o.CompositeView.extend({className:"row",template:a.template(n),childView:e.Plugin,childViewEventPrefix:"plugins",childViewContainer:".plugins-js",initialize:function(){this.collection=this.model.get("plugins"),console.log("%O",this.collection)},events:{}}),e.PluginsTypes=o.CollectionView.extend({className:"container-fluid plugin-types-area activity-red-yellow",childView:e.Plugins,initialize:function(){console.log("%O",this.collection)},events:{}}),e.PluginsTypesLayout=o.LayoutView.extend({className:"plugins-area-wrapper",template:a.template(r),regions:{pluginsView:"#plugins-view"},triggers:{"click .js-show-plugins":"plugins:list:show"},onShow:function(){var e=document.plugin.pluginName;if(typeof e!="undefined"){var t=!0;i.trigger("plugin:show:update",e,t)}}})}),e.PluginApps.List.View}),define("apps/plugins/list/pluginsList_controller",["app","apps/plugins/list/pluginsList_view"],function(e,t){return e.module("PluginsApp.List",function(e,n,r,i,s,o){function f(r,i){console.log(r);var s=e.Controller,o=new t.PluginsTypesLayout;s.listenTo(o,"plugins:list:show",function(){n.trigger("plugins:list:show")}),o.on("show",function(){n.addRegions({pluginsView:"#plugins-view"});var e=new t.PluginsTypes({collection:r});i.back&&e.on("show",function(){l()}),e.on("childview:plugins:plugin:show",function(e,t){var r={internal:!0};n.trigger("plugin:show:internal",t.model,r)}),o.pluginsView.show(e)}),n.pluginsRegion.show(o)}function l(){s("#frameMiniApp").length>0?s(".plugin-types-area").removeClass("has-transition"):s(".plugin-types-area").addClass("has-transition"),s(".plugin-types-area").toggleClass("isVisible");if(s(".plugin-types-area").hasClass("isVisible"))s("#main-region").off("click"),s("#main-region").on("click",function(){n.trigger("plugins:list:show:toggle")}),s(".js-show-plugins").removeClass("plugin-active"),s("#plugins-view").css("z-index","0"),s(".activity-area").css("z-index","-1"),s(".btn-plugins").addClass("plugins-list-open");else{s("#main-region").off("click"),s(".btn-plugins").removeClass("plugins-list-open");var e=document.plugin.pluginName;typeof e!="undefined"&&s(".js-show-plugins").addClass("plugin-active"),setTimeout(function(){s(".activity-area").css("z-index",""),s("#plugins-view").css("z-index","-1")},300)}}var u=12,a=i.Controller.extend({listPlugins:function(e){e.initialized===!1?require(["entities/pluginType/pluginType_collection"],function(){var t=n.request("pluginTypes:entities");s.when(t).done(function(t){f(t,e)})}):e.initialized&&(console.log("options.initialized"),require(["entities/plugin/plugin_collection"],function(){var e=n.request("plugins:entities:initialized");f(e)}))},pluginsListShow:function(){var e=document.plugin.pluginName;l(),s(".plugin-types-area").hasClass("isVisible")&&typeof e!="undefined"&&s("#frameMiniApp").data("plugin")!==e&&n.trigger("plugin:show",e)},pluginsListShowToggle:function(){l()}});e.Controller=new a}),e.PluginsApp.List.Controller}),define("apps/plugins/plugins_app",["app","bootbox"],function(e){e.module("Router.PluginApp",function(e,t,n,r,i,s){e.Router=r.AppRouter.extend({appRoutes:{}}),PluginsAPI={showPlugin:function(e,t){require(["apps/plugins/show/pluginsShow_controller"],function(n){n.showPlugin(e,t)})},showPluginInternal:function(e,t){require(["apps/plugins/show/pluginsShow_controller"],function(n){n.showPluginInternal(e,t)})},showPluginWithUrl:function(e,t){require(["apps/plugins/show/pluginsShow_controller"],function(n){n.showPluginWithUrl(e,t)})},pluginShowUpdate:function(e,t){require(["apps/plugins/Show/pluginsShow_controller"],function(n){n.pluginShowUpdate(e,t)})},backToRoot:function(e,n){t.backToRoot()},listPlugins:function(e){require(["apps/plugins/list/pluginsList_controller"],function(t){t.listPlugins(e)})},listPluginsInitialized:function(e){require(["apps/plugins/list/pluginsList_controller"],function(e){var t={initialized:!0};e.listPlugins(t)})},pluginsListShow:function(){require(["apps/plugins/list/pluginsList_controller"],function(e){e.pluginsListShow()})},pluginsListShowToggle:function(){require(["apps/plugins/list/pluginsList_controller"],function(e){e.pluginsListShowToggle()})}},t.on("plugin:show",function(e,t){if(typeof t=="undefined"){var n={full:!1};PluginsAPI.showPlugin(e,n)}else t.full=!1,PluginsAPI.showPlugin(e,t)}),t.on("plugin:show:internal",function(e,t){if(typeof t=="undefined"){var n={full:!1};PluginsAPI.showPluginInternal(e,n)}else t.full=!1,PluginsAPI.showPluginInternal(e,t)}),t.on("plugin:show:url",function(e,t){var r=new n.Model;r.set("url",e);if(typeof t=="undefined"){var i={full:!0};PluginsAPI.showPluginWithUrl(r,i)}else t.full=!0,PluginsAPI.showPluginWithUrl(r,t)}),t.on("plugins:list",function(){var e={initialized:!1};console.log("plugins:list"),PluginsAPI.listPlugins(e)}),t.on("plugins:list:back",function(){var e={initialized:!1,back:!0};console.log("plugins:list:back"),PluginsAPI.listPlugins(e)}),t.on("plugins:list:initialized",function(){console.log("plugins:list:initialized");var e={initialized:!0};PluginsAPI.listPlugins(e)}),t.on("plugins:list:show",function(){PluginsAPI.pluginsListShow()}),t.on("plugins:list:show:toggle",function(){PluginsAPI.pluginsListShowToggle()}),t.on("plugin:show:update",function(e,t){PluginsAPI.pluginShowUpdate(e,t)}),t.addInitializer(function(){new e.Router({controller:PluginsAPI}),jq(document).off("MiniApp"),jq(document).on("MiniApp",function(e,n){var r=n.detail;switch(r.type){case"UrlUpdate":var i=r.resourceURL;t.trigger("plugin:show",i,r.options);break;case"ShowPlugin":var s=r.pluginName;t.trigger("plugin:show",s,r.options);break;case"UpdatePluginStatus":var s=r.pluginName,o=r.active;t.trigger("plugin:show:update",s,o);break;case"Exit":t.back(),console.log("back")}}),document.pluginListenerReady=!0,i(".js-home").off(),i(".js-home").on("click",function(e){e.preventDefault(),bootbox.confirm("Back to Classrooms & Adventures?",function(e){if(!e)return;t.backToHome()})})})})}),define("text!apps/responses/list/templates/responses_item.html",[],function(){return'<div class="student-avatar <%= color %> text-center">\r\n  <span class="student-name"><%= name.substring(0,1) %></span>\r\n</div>\r\n<div class="response-text"><%= answer %></div>\r\n<div class="action-buttons">\r\n  <a class="btn-action correct js-correct"><i class="fa fa-check"></i></a>\r\n  <a class="btn-action wrong js-wrong"><i class="fa fa-times"></i></a>      \r\n</div>'}),define("text!apps/responses/list/templates/responses_template.html",[],function(){return"\r\n"}),define("apps/responses/list/responsesList_view",["app","text!apps/responses/list/templates/responses_item.html","text!apps/responses/list/templates/responses_template.html"],function(e,t,n){return e.module("ResponsesApp.List.View",function(e,r,i,s,o,u){e.Response=s.ItemView.extend({className:"response-wrapper",template:u.template(t),modelEvents:{"change:correct":"markAnswer"},triggers:{"click .js-correct":"answer:correct","click .js-wrong":"answer:wrong"},style:{mark:function(e){var t=e.model.get("correct");t===!0?(o(e.$el.find(".response-text")[0]).removeClass("answer-wrong"),o(e.$el.find(".response-text")[0]).addClass("answer-correct")):t===!1&&(o(e.$el.find(".response-text")[0]).removeClass("answer-correct"),o(e.$el.find(".response-text")[0]).addClass("answer-wrong"))}},markAnswer:function(){this.style.mark(this)},intialize:function(){}}),e.Responses=s.CollectionView.extend({className:"responses",template:u.template(n),childView:e.Response,initialize:function(){},events:{}})}),e.ResponsesApp.List.View}),define("apps/responses/list/responsesList_controller",["app","apps/responses/list/responsesList_view"],function(e,t){return e.module("ResponsesApp.List",function(e,n,r,i,s,o){function f(e){var i=[{id:1,name:"Jane",answer:"TestAnswer"},{id:2,name:"Michael",answer:"TestAnswer2"},{id:3,name:"Tom",answer:"TestAnswer2"},{id:4,name:"Jeremy",answer:"TestAnswer4"},{id:5,name:"Jeremy",answer:"TestAnswer"},{id:6,name:"Clark",answer:"TestAnswer4"}],s=n.request("activity"),o=r.Model.extend({idAttribute:"id",defaults:{name:"",answer:"",correct:""},initialize:function(){var e=["dullPink","dullGreen","dullBlue","dullYellow","dullPurple","dullOrange"];this.set("color",e[Math.floor(Math.random()*6)])}}),u=r.Collection.extend({model:o}),f=JSON.parse(JSON.stringify(i)),c=new u(f),h=new t.Responses({collection:c}),p=n.request("responses:panel");a.listenTo(h,"show",function(){var e=i.length+1}),p.show(h),h.on("childview:answer:correct",function(e){var t=!0,n=e.model,r=n.get("answer");console.log(n.get("name")+" answered "+r+" and is correct"),n.set({correct:!0}),l.checkForSimiliarAnswerAndMark(n.collection.models,r,!0)}),h.on("childview:answer:wrong",function(e){var t=e.model,n=t.get("answer");console.log(t.get("name")+" answered "+n+" is wrong"),t.set("correct",!1),l.checkForSimiliarAnswerAndMark(t.collection.models,n,!1)})}var u=i.Controller.extend({listResponses:function(e){f(e)}});e.Controller=new u;var a=e.Controller,l={checkForSimiliarAnswerAndMark:function(e,t,n){o.each(e,function(e){e.get("answer")===t&&e.set("correct",n)})}}}),e.ResponsesApp.List.Controller}),define("apps/responses/responses_app",["app"],function(e){e.module("Router.ResponsesApp",function(e,t,n,r,i,s){e.Router=r.AppRouter.extend({}),ResponsesAPI={listResponses:function(e){require(["apps/responses/list/responsesList_controller"],function(t){console.log("here"),t.listResponses(e)})}},t.on("responses:list",function(e){ResponsesAPI.listResponses(e)}),t.addInitializer(function(){new e.Router({controller:ResponsesAPI}),jq(document).off("Responses"),jq(document).on("Responses",function(e,n){var r=n.detail;switch(r.type){case"listResponses":var i=r.data;console.log("listResponses"),t.trigger("responses:list",i)}})})})}),define("app",["marionette","apps/config/marionette/region/dialog"],function(e,t){var n=new e.Application,r=0;return n.addRegions({headerRegion:"#header-region",mainRegion:"#main-region",pluginsRegion:"#plugins-region",pluginAppRegion:"#pluginApp-region",dialogRegion:t}),n.navigate=function(e,t){t||(t={}),r+=1,Backbone.history.navigate(e,t)},n.getCurrentRoute=function(){return Backbone.history.fragment},n.back=function(){r>1?parent.window.history.back():this.navigate("activities",{trigger:!0,replace:!0})},n.backToRoot=function(){n.trigger("activities:listActivities:initialized")},n.backToHome=function(){window.open("/","_top")},n.on("before:start",function(){document.socketID?console.log("####socket ready"):(n.trigger("dialog:show:loading"),console.log("####Initialized before activity"))}),n.on("start",function(){Backbone.history&&(require(["apps/elements/elements_app","apps/activities/activities_app","apps/dialog/dialog_app","apps/plugins/plugins_app","apps/responses/responses_app"],function(){Backbone.history.start(),n.getCurrentRoute()===""?(n.trigger("activities:listActivities:initialized"),n.trigger("plugins:list")):n.trigger("plugins:list");var e=setTimeout(function(){$("#main-region").html().length===0&&location.reload(),console.log("$('#main-region').html().length :"+$("#main-region").html().length)},5e3)}),console.log("Teacher Session has started"))}),n}),requirejs.config({paths:{jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min",underscore:"//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min",backbone:"//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min","backbone.syphon":"//cdnjs.cloudflare.com/ajax/libs/backbone.syphon/0.4.1/backbone.syphon.min",json2:"//cdnjs.cloudflare.com/ajax/libs/json2/20130526/json2.min",marionette:"//cdnjs.cloudflare.com/ajax/libs/backbone.marionette/2.0.3/backbone.marionette.min",templates:"../templates",text:"../../tools/libs/require/text",bootstrap:"//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min",bootbox:"//cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.2.0/bootbox.min",grids:"../../tools/libs/grids/grid_amd",interact:"../../tools/libs/interact/interact.min",tilesprocessor:"../../tools/misc/tilesProcessor",mathjax:"http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML&amp;delayStartupUntil=configured"},shim:{underscore:{exports:"_"},backbone:{deps:["underscore","jquery","json2"],exports:"Backbone"},marionette:{deps:["backbone"],exports:"Marionette"},bootstrap:["jquery"],"backbone.syphon":["backbone"],bootbox:{deps:["bootstrap","jquery"],exports:"bootbox"},grids:["jquery"],interact:{deps:["underscore"],exports:"interact"},tilesprocessor:["underscore"],mathjax:{exports:"MathJax"}}}),require(["app"],function(e){e.start()}),define("require_main",function(){});