function purifyColor(a){var b=Math.round(3*Math.random());return a[b]=0,a}function getRandomColor(){var a=100+Math.round(55*Math.random()),b=100+Math.round(55*Math.random()),c=100+Math.round(55*Math.random()),d=[a,b,c];return d=purifyColor(d),d=purifyColor(d)}function bind(){wheel.on("touchstart",function(a){var b=stage.getPointerPosition();angularVelocity=0,controlled=!0,target=a.targetNode,startRotation=this.rotation(),startX=b.x,startY=b.y}),document.body.addEventListener("touchend",function(){controlled&&(controlled=!1,angularVelocity>MAX_ANGULAR_VELOCITY?angularVelocity=MAX_ANGULAR_VELOCITY:-1*MAX_ANGULAR_VELOCITY>angularVelocity?angularVelocity=-1*MAX_ANGULAR_VELOCITY:angularVelocity>=0&&100>angularVelocity?angularVelocity=MAX_ANGULAR_VELOCITY:0>angularVelocity&&angularVelocity>-100&&(angularVelocity=-1*MAX_ANGULAR_VELOCITY),angularVelocities=[])},!1),document.body.addEventListener("touchmove",function(){if(controlled){var a=stage.getPointerPosition();if(controlled&&a&&target){var b=a.x-wheel.x(),c=a.y-wheel.y(),d=startX-wheel.x(),e=startY-wheel.y(),f=180*Math.atan(c/b)/Math.PI,g=180*Math.atan(e/d)/Math.PI,h=g-f;(0>b&&d>=0||0>d&&b>=0)&&(h+=180),wheel.setRotation(startRotation-h)}}},!1)}function getRandomReward(){var a=5*Math.round(16*Math.random());return a}function convertToString(a){var b=a.toString().split("");return a=b[0],b[1]&&(a+="\n"+b[1]),a}function addWedge(a){var b=getRandomColor(),c=getRandomReward(),d=convertToString(c),e=b[0],f=b[1],g=b[2],h=360/NUM_WEDGES,i="rgb("+e+","+f+","+g+")";e+=100,f+=100,g+=100;var j="rgb("+e+","+f+","+g+")",k=new Kinetic.Group({rotation:360*a/NUM_WEDGES}),l=new Kinetic.Wedge({radius:WHEEL_RADIUS,angle:h,fillRadialGradientStartRadius:0,fillRadialGradientEndRadius:WHEEL_RADIUS,fillRadialGradientColorStops:[0,j,1,i],fill:"#64e9f8",fillPriority:"radial-gradient",stroke:"#ccc",strokeWidth:2,rotation:-1*(90+h/2),rewardValue:c});k.add(l);var m=new Kinetic.Text({text:d,fontFamily:"Calibri",fontSize:50,fill:"white",align:"center",stroke:"yellow",strokeWidth:1,listening:!1});m.offsetX(m.width()/2),m.offsetY(WHEEL_RADIUS-15),k.add(m),wheel.add(k)}function animate(a){if(Math.abs(angularVelocity)<2?angularVelocity=0:Math.abs(angularVelocity)<10&&(0>angularVelocity?angularVelocity++:angularVelocity--),0!=angularVelocity){var b=angularVelocity*a.timeDiff*(1-ANGULAR_FRICTION)/1e3;angularVelocity-=b}controlled?angularVelocity=1e3*(wheel.getRotation()-lastRotation)/a.timeDiff:wheel.rotate(a.timeDiff*angularVelocity/1e3),lastRotation=wheel.getRotation();var c=layer.getIntersection({x:stage.width()/2,y:50});!c||activeWedge&&activeWedge._id===c._id||(currentRewardValue=c.attrs.rewardValue,pointerTween.reset(),pointerTween.play(),activeWedge=c)}function init(){stage=new Kinetic.Stage({container:"container",width:560,height:200}),layer=new Kinetic.Layer,wheel=new Kinetic.Group({x:stage.getWidth()/2,y:WHEEL_RADIUS+20});for(var a=0;NUM_WEDGES>a;a++)addWedge(a);pointer=new Kinetic.Wedge({fillRadialGradientStartPoint:0,fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:0,fillRadialGradientEndRadius:30,fillRadialGradientColorStops:[0,"white",1,"red"],stroke:"white",strokeWidth:2,lineJoin:"round",angle:30,radius:30,x:stage.getWidth()/2,y:20,rotation:-105,shadowColor:"black",shadowOffset:{x:3,y:3},shadowBlur:2,shadowOpacity:.5}),layer.add(wheel),layer.add(pointer),stage.add(layer),pointerTween=new Kinetic.Tween({node:pointer,duration:.1,easing:Kinetic.Easings.EaseInOut,y:30}),pointerTween.finish();var b=WHEEL_RADIUS+2;wheel.cache({x:-1*b,y:-1*b,width:2*b,height:2*b}).offset({x:b,y:b}),layer.draw(),bind(),anim=new Kinetic.Animation(animate,layer),setTimeout(function(){anim.start()},1e3)}function initWord(){currentWord=currentWord.toUpperCase(),charactersFound=0;var a='<button class="btn btn-disabled btn-lg col-centered boardfont" id="letter',b="</button>",c="",d=currentWord.split("");_.each(d,function(d,e){c+=a+e+'">?'+b}),$("#board").html(c)}function processAlphabet(a){var b=currentWord.split(""),c=!1;_.each(b,function(b,d){b===a&&(charactersFound++,$("#letter"+d).html(a),sendLetter(a),$("#button"+a).addClass("correct"),c=!0)}),c?countCorrect++:countWrong++,charactersFound===currentWord.length&&(parent.Messenger().post({message:"Solved!",id:PLUGIN_NAME,type:"success",hideAfter:5,showCloseButton:!0}),setTimeout(function(){$("#buttonNextWord").removeClass("disabled")},500))}function sendLetter(a){var b={letter:a};b.meta=isSingle?{points:Math.round(currentRewardValue/10)}:{points:currentRewardValue},parent.pluginToServer(PLUGIN_NAME,"StudentAnswer",b)}function processNextWord(a){currentWord=a.currentWord.word;var b;if(isSingle)b=500;else{var c=a.timeToStart,d=(new Date).valueOf()+parent.document.timeDifference;b=c-d}setTimeout(function(){initWord()},b),$("#currentCategory").html(a.currentWord.category),$(".keyboard").children().each(function(){$(this).removeClass("disabled"),$(this).removeClass("taken"),$(this).removeClass("correct")})}function processLetterTaken(a){var b=a.letter,c=currentWord.split("");$("#button"+b).addClass("disabled"),$("#button"+b).addClass("taken"),_.each(c,function(a,c){a===b&&(charactersFound++,$("#letter"+c).html(b))})}function singleInitializeWordLists(a,b){var c=JSON.parse(parent.$("#data-session").html()),d=c.wordLists;if(wordList1=_.findWhere(d,{_id:a}),wordList2=_.findWhere(d,{_id:b}),wordList1&&wordList2){wordStatus=[],studentAnswers=[];var e=0;_.each(wordList1.words,function(a){var b={};b.word=a,b.isAnswered=!1,b.studentID=null,b.category=wordList1.title,b.wordID=e++,/^[a-zA-Z]*$/.test(b.word)&&wordStatus.push(b)}),_.each(wordList2.words,function(a){var b={};b.word=a,b.isAnswered=!1,b.studentID=null,b.category=wordList2.title,b.wordID=e++,/^[a-zA-Z]*$/.test(b.word)&&wordStatus.push(b)}),wordStatus=_.sample(wordStatus,_.size(wordStatus));var f={currentWord:wordStatus[currentWordIndex],timeToStart:currentWordStartTime};processNextWord(f)}}function singleNextWord(){if(currentWordIndex++,!wordStatus[currentWordIndex])return $("#buttonNextWord").html("Completed"),$("#buttonNextWord").addClass("disabled"),void processActivityComplete();studentAnswers=[],currentWordStartTime=(new Date).valueOf()+1e3;var a={currentWord:wordStatus[currentWordIndex],timeToStart:currentWordStartTime};processNextWord(a),$("#buttonNextWord").addClass("disabled")}function processActivityComplete(){var a=$("#templateResults").html(),b=_.template(a,{title:"Results",countCorrect:countCorrect,countWrong:countWrong});parent.bootbox.alert(b)}var PLUGIN_NAME="WHEEL_WORD",currentWord="",answered=!0,isSingle=!1,countCorrect=0,countWrong=0,currentWordIndex=0,wordStatus={},currentWordStartTime,studentAnswers=[],wordList1={},wordList2={};$(document).ready(function(){$(function(){FastClick.attach(document.body)});var a=parent.getUrlVars(document);a.isSingle&&(isSingle=!0,PLUGIN_NAME="SINGLE"),isSingle?(singleInitializeWordLists(a.listID1,a.listID2),$(document).on("click",'button[id^="buttonNextWord"]',function(){answered&&singleNextWord()}),$("#buttonNextWord").css("visibility","visible")):(parent.isTeacher||$(document).on("ServerToPlugin"+PLUGIN_NAME,function(a,b){if(parent){var c=b.detail;switch(c.pluginMessageType){case"NextWord":processNextWord(c.data);break;case"ActivityComplete":processActivityComplete(c.data);break;case"LetterTaken":processLetterTaken(c.data)}}}),parent.pluginToServer(PLUGIN_NAME,"StudentOpen",{})),$("#buttonTriggerSpin").on("click",function(){angularVelocity=300}),$(document).on("click","button",function(a){if("keyboard"===a.target.parentElement.className){var b=a.target.innerHTML;$(this).addClass("disabled"),processAlphabet(b)}}),init()});var MAX_ANGULAR_VELOCITY=360,NUM_WEDGES=25,WHEEL_RADIUS=310,ANGULAR_FRICTION=.01,angularVelocity=0,lastRotation=0,controlled=!1,target,activeWedge,stage,layer,wheel,pointer,pointerTween,startRotation,startX,startY,activeWedge,currentRewardValue=0,anim,charactersFound=0;
//# sourceMappingURL=wheelWordStudent.min.js.map