/**
 * @license RequireJS text 2.0.10 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/**
 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
 *
 * @version 0.6.11
 * @codingstandard ftlabs-jsv2
 * @copyright The Financial Times Limited [All Rights Reserved]
 * @license MIT License (see LICENSE.txt)
 */

function initTilesProcessor(e,t,n){tilesProcessor={},tilesProcessor.linkPairs=[],tilesProcessor.activityNeighbours={},tilesProcessor.maxX=9,tilesProcessor.maxY=9;var r=e.models,i=t.models;tilesProcessor.tiles2D=new Array(tilesProcessor.maxY);for(var s=0;s<tilesProcessor.maxY;s++)tilesProcessor.tiles2D[s]=new Array(tilesProcessor.maxX);tilesProcessor.activities2D=new Array(tilesProcessor.maxY);for(var s=0;s<tilesProcessor.maxY;s++)tilesProcessor.activities2D[s]=new Array(tilesProcessor.maxX);_.each(r,function(e,t){if(t>=40)return;tilesProcessor.tiles2D[e.get("y")][e.get("x")]=e.get("a")}),_.each(i,function(e,t){if(!e)return;var r=e.get("x"),i=e.get("y");r||(r=0),i||(i=0);var s=n?e.get("activityTitle"):e.get("_id");tilesProcessor.activities2D[i][r]=s}),processPairs();var o=[];_.each(i,function(e){var t=n?e.get("activityTitle"):e.get("_id");o.push(t)}),tilesProcessor.groups=groupConnected(tilesProcessor.linkPairs,tilesProcessor.activityNeighbours,o)}function processPairs(){for(var e=0;e<tilesProcessor.maxY;e++)for(var t=0;t<tilesProcessor.maxX;t++){var n=tilesProcessor.activities2D[e][t];if(n){var r=n+" connected to ",i=[];checkNeighbours(i,e,t),tilesProcessor.activityNeighbours[n]=[],_.each(i,function(e){var t=tilesProcessor.activities2D[e.i][e.j];r+=", "+t,tilesProcessor.linkPairs.push([n,t]),tilesProcessor.activityNeighbours[n].push(t)})}}}function checkNeighbours(e,t,n,r,i){i||(i=[]);if(_.findWhere(i,{i:t,j:n}))return;i.push({i:t,j:n});if(t>=2&&r!==down&&tilesProcessor.tiles2D[t-1][n+0]){var s=t-2,o=n+0;tilesProcessor.activities2D[s][o]?activityCheckAndAdd(e,i,s,o):checkNeighbours(e,s,o,up,i)}if(t<=tilesProcessor.maxY-2&&r!==up&&tilesProcessor.tiles2D[t+1][n+0]){var s=t+2,o=n+0;tilesProcessor.activities2D[s][o]?activityCheckAndAdd(e,i,s,o):checkNeighbours(e,s,o,down,i)}if(n>=2&&r!==right&&tilesProcessor.tiles2D[t+0][n-1]){var s=t+0,o=n-2;tilesProcessor.activities2D[s][o]?activityCheckAndAdd(e,i,s,o):checkNeighbours(e,s,o,left,i)}if(n<=tilesProcessor.maxX-2&&r!==left&&tilesProcessor.tiles2D[t+0][n+1]){var s=t+0,o=n+2;tilesProcessor.activities2D[s][o]?activityCheckAndAdd(e,i,s,o):checkNeighbours(e,s,o,right,i)}}function activityCheckAndAdd(e,t,n,r){_.findWhere(t,{i:n,j:r})||(e.push({i:n,j:r}),t.push({i:n,j:r}))}function groupConnected(e,t,n){var r=[],i=n,s=0;while(_.size(i)>0){var o=i[0];if(!o)break;r[s]=[],r[s].push(o),i.splice(0,1);var u=t[o];findAndInsertNeighbours(r[s],u,i),s++}return r}function findAndInsertNeighbours(e,t,n){if(!n||_.size(n)===0)return;_.each(t,function(t){var r=n.indexOf(t);if(r>-1){activityFound=t,e.push(activityFound),n.splice(r,1);var i=tilesProcessor.activityNeighbours[activityFound];findAndInsertNeighbours(e,i,n)}})}function startIntro1(e,t){if(t!=="wordList")return;var n=[{intro:"<center><b>Word lists</b></center><br/><br/>                                       Resources that  can be used with the <b> campfire apps </b> or a <b>compatible activity</b> in the adventure."},{element:document.querySelector(".js-guide-am-wordlist"),intro:"Click here to access your <b> word lists for this adventure</b>"},{element:document.querySelector(".guide-wl-new"),intro:"Click here to create a <b>new word list</b>  "}],r=[{element:document.querySelectorAll(".js-title-edit")[0],intro:"Edit the title here"},{element:document.querySelectorAll(".js-list-text")[0],intro:"Click here to edit the words/sentences<br/><br/>                                  <b>Space</b> is accepted as part of a sentence.<br/>                                  <b>Enter</b> for new word or sentence. <br/><br/>                                  Example:<br/><br/>                                  <b>Jump is a verb( sentence)</b><br/>                                   <b>Swim</b>(word)<br/>                                  <b>Run fast</b>(multiple word)<br/>                                   <b>Dance</b>(multiple word)<br/> <br/>                                   In total there are<b> 4 items</b> in this word list ",position:"bottom"}];$(".js-list-edit-area").length!==0&&n.push.apply(n,r),e.setOptions({showStepNumbers:!1,showBullets:!1,steps:n}),e.start()}function FastClick(e){var t,n=this;this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=10,this.layer=e;if(!e||!e.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){return FastClick.prototype.onClick.apply(n,arguments)},this.onMouse=function(){return FastClick.prototype.onMouse.apply(n,arguments)},this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(n,arguments)},this.onTouchMove=function(){return FastClick.prototype.onTouchMove.apply(n,arguments)},this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(n,arguments)},this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(n,arguments)};if(FastClick.notNeeded(e))return;this.deviceIsAndroid&&(e.addEventListener("mouseover",this.onMouse,!0),e.addEventListener("mousedown",this.onMouse,!0),e.addEventListener("mouseup",this.onMouse,!0)),e.addEventListener("click",this.onClick,!0),e.addEventListener("touchstart",this.onTouchStart,!1),e.addEventListener("touchmove",this.onTouchMove,!1),e.addEventListener("touchend",this.onTouchEnd,!1),e.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(e.removeEventListener=function(t,n,r){var i=Node.prototype.removeEventListener;t==="click"?i.call(e,t,n.hijacked||n,r):i.call(e,t,n,r)},e.addEventListener=function(t,n,r){var i=Node.prototype.addEventListener;t==="click"?i.call(e,t,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):i.call(e,t,n,r)}),typeof e.onclick=="function"&&(t=e.onclick,e.addEventListener("click",function(e){t(e)},!1),e.onclick=null)}define("apps/config/marionette/region/dialog",["jquery","underscore","marionette","bootstrap"],function(e,t,n){return n.Region.Dialog=n.Region.extend({el:"#dialog-region",constructor:function(){this.on("show",this.showModal,this)},showModal:function(e){console.log("showModal");var t=this,n=function(){t.$el.children().first().modal("show"),t.$el.children().first().on("hidden.bs.modal",function(e){t.closeDialog()})};n()},hideModal:function(){console.log("hidemodal"),this.$el.children().first().modal("hide"),e("body").removeClass("modal-open"),e(".modal-backdrop").remove()},closeDialog:function(){this.stopListening(),this.hideModal(),this.empty()}}),n.Region.Dialog}),define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.10",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}d.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("﻿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!apps/activities/listActivities/templates/activities_layout.html",[],function(){return'\r\n<div id="wordLists-region"></div>\r\n<div id="adventureMap-region"></div>\r\n'}),define("text!apps/activities/listActivities/templates/activity_item.html",[],function(){return'<% if (tileType === "checkpoint") { %>\n<div class="activity-checkpoint">\n  <div class="activity-delete js-click" >\n    <!--    <i class="fa fa-times 2x btn-activity-delete js-delete"></i>-->\n    <div class="btn-group btn-group-options">      \n      <a  class="btn dropdown-toggle btn-activity-options" data-toggle="dropdown">\n        <i class="fa fa-chevron-down btn-activity-options-icon"></i>\n        <!--        <span class="caret"></span>-->\n        <span class="sr-only">Toggle Dropdown</span>\n      </a>\n      <ul class="dropdown-menu" role="menu">\n        <li><a href="#" class="js-edit">Edit Activity</a></li>\n        <li><a href="#" class="js-delete">Delete</a></li>\n        <li class="colors">\n          <div class="color-option blue js-color"></div>\n          <div class="color-option brown js-color"></div>\n          <div class="color-option green js-color"></div>\n          <div class="color-option pink js-color"></div>\n          <div class="color-option red js-color"></div>\n          <div class="color-option yellow js-color"></div>          \n        </li>\n        <!--<li><a href="#" class="js-first">Mark as first</a></li>-->\n        <!--        <li><a href="#" class="js-activate">Activate</a></li>\n                <li class="divider"></li>\n                <li><a href="#">Separated link</a></li>-->\n      </ul>\n    </div>\n  </div>\n\n  <% if (activityType ==="media" && elements.length ===0  ) { %>\n  <% console.log("this actitvity", elements.length) %>\n  <div class="checkpoint-wrapper js-move">\n    <div class="checkpoint markerBlue ">\n      <!--      <img class="checkpoint-img checkpoint-shadow">-->\n    </div>\n    <div class="checkpoint-desc">?</div>\n  </div>  \n  <% } else if (activityType ==="media" && elements.length !== 0 && checkPointIcon === "" ) { %>\n  <div class="checkpoint-wrapper js-move ">\n    <div class="checkpoint markerBlue">\n      <!--      <img class="checkpoint-img " src="/webapp/images/checkpoint_blue.svg">-->\n    </div>\n    <div class="checkpoint-desc">Q</div>\n  </div>\n  <% } else if (activityType ==="media" && elements.length !== 0 && checkPointIcon !== "" ) { %>\n  <div class="checkpoint-wrapper js-move ">\n    <div class="checkpoint  <%= checkPointIcon %>">\n      <!--      <img class="checkpoint-img " src="/webapp/images/checkpoint_blue.svg">-->\n    </div>\n    <div class="checkpoint-desc">Q</div>\n  </div>  \n  <% } else if (activityType ==="wordList" && pluginApp === "" ){  %>\n  <div class="checkpoint-wrapper js-move">    \n    <div class="checkpoint markerBrown"></div>\n    <div class="checkpoint-desc">W</div>\n  </div>  \n  <% } else if (activityType ==="wordList" && checkPointIcon === ""){  %>\n  <div class="checkpoint-wrapper js-move">   \n    <div class="checkpoint markerBrown"></div>         \n    <div class="checkpoint-desc "> <i class="fa <%= pluginAppIcon %>"></i> </div>  \n  </div>\n  <% } else if (activityType ==="wordList" && checkPointIcon !== ""){  %>\n  <div class="checkpoint-wrapper js-move">   \n    <div class="checkpoint <%= checkPointIcon %>"></div>         \n    <div class="checkpoint-desc "> <i class="fa <%= pluginAppIcon %>"></i> </div>  \n  </div>  \n  <% } else { %>\n  <div class="checkpoint-wrapper js-move">    \n    <div class="checkpoint markerBlue "></div>\n    <div class="checkpoint-desc"></div>\n  </div>  \n  <% }  %>\n  <div class="activity-coordinate" data-x="<%= x  %>" data-y="<%= y %>" ></div>\n\n\n  <div class="activity-description ">\n    <span  contentEditable=true data-ph="Click to edit " class="activity-activity-desc js-rename"><%= activityTitle %></span>\n  </div>\n</div>\n<% }  %>\n\n\n\n'}),define("text!apps/activities/listActivities/templates/activity_map.html",[],function(){return'<div class="row adventure-title">\n  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center camp-adventure-font-style">\n\n    <span class="lesson-name js-rename-lesson"  data-intro="Rename Adventure" data-position="bottom"> <%= lessonName %> <i class="fa fa-edit"></i></span>           \n  </div>\n  <div class="activity-guide-area">\n    <button type="button" class="btn btn-default navbar-btn js-guide">\n      <i class="fa fa-info-circle "></i> Guide</button>\n  </div>\n</div>\n<p></p>\n\n<div id=\'adventure-wrapper\'>\n  <!--  ng-app="kitchensink" class="ng-scope">-->\n  <div id="adventure-view" class="row" style="background-image:url(\'<%= (document.backgroundImageURL)?document.backgroundImageURL:backgroundImageURL %>\')">\n    <a class="btn btn-add-activity js-new  js-guide-new" data-intro="Add new Activity" data-position="top"><i class="fa fa-plus fa-2x"></i></a>  \n    <div class="edit-background" data-intro="Customize the background with fun graphics!" data-position="top">\n      <a class="btn btn-edit-background js-edit-background" \n         <% if (!document.filepickerLoaded){ %>\n         disabled="disabled"\n         <% } %>\n         >Edit Background</a>\n      <div id="background-saving" style="display:none;">\n        <i class="fa fa-spinner fa-spin"></i>\n        <span><b>Saving...</b></span>\n      </div>\n      <div id="background-saved" style="display:none;">\n        <span><b> &nbsp; Saved</b></span>\n      </div>\n    </div>\n    <canvas id="canvas" width="680" height="620"></canvas>\n  </div>\n  <!--<script>\n    var kitchensink = {};\n    var canvas = new fabric.Canvas(\'canvas\');\n  </script>-->\n  <!--\n  <script src="/tools/backgroundEditor/backgroundEditor_utils.js"></script>\n  <script src="/tools/backgroundEditor/backgroundEditor.js"></script>\n  <script src="/tools/backgroundEditor/backgroundEditor_controller.js"></script>-->\n\n  <div id="bd-wrapper" ng-controller="CanvasControls" class="ng-scope" style="display:none;">\n    <div style="position:relative;width:680px;height:50px;float:left;left: 50%;margin-left: -340px;top:-60px;" id="canvas-wrapper">\n\n      <div id="canvas-controls">\n        <nav class="navbar navbar-default" role="navigation">\n          <div class="container-fluid">\n            <!-- Brand and toggle get grouped for better mobile display -->\n            <div class="navbar-header">\n              <div class="navbar-brand" href="#">Add </div>\n            </div>\n            <!-- Collect the nav links, forms, and other content for toggling -->\n            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">\n\n              <ul class="nav navbar-nav">\n                <li class="dropdown">\n                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="fa fa-image" style="font-size:20px"></span> <span class="caret"></span></a>\n                  <ul class="dropdown-menu" role="menu" style="width:400px">\n                    <!--                    <li>&nbsp; Background Color: &nbsp;\n                                          <input type="color" style="width:40px" bind-value-to="canvasBgColor">\n                                          <button class="btn btn-sm" ng-click="canvasTransparent()"> Transparent </button></li>-->\n                    <li> &nbsp; Maps</li>\n                    <button type="button" class="btn btn-thumbnail-large" ng-click="addImageMap(element);\n                          $event.preventDefault()" ng-repeat="element in elementsMap">\n                      <img class="thumbnail-large" ng-src="/media/thumbnails/islands/{{element}}.png">\n                    </button>\n                  </ul>\n                </li>\n                <li class="dropdown">\n                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="fa fa-square-o" style="font-size:20px"></span> <span class="caret"></span></a>\n                  <ul class="dropdown-menu" role="menu" style="width:220px">\n                    <li>  &nbsp; Shapes</li>\n                    <button type="button" class="btn btn-thumbnail" style="width:80px" ng-click="addRect();\n                          $event.preventDefault()"><span class="fa fa-square" style="font-size:60px"></span> </button>\n                    <button type="button" class="btn btn-thumbnail" style="width:80px" ng-click="addCircle();\n                          $event.preventDefault()"><span class="fa fa-circle" style="font-size:60px"></span> </button>\n                    <button type="button" class="btn btn-thumbnail" style="width:80px" ng-click="addTriangle();\n                          $event.preventDefault()"><span class="" style="font-size:60px">▲</span> </button>\n                    <button type="button" class="btn btn-thumbnail" style="width:80px" ng-click="addLine();\n                          $event.preventDefault()"><span class="" style="font-size:60px">\\</span> </button>\n                  </ul>\n                </li>\n                <li class="dropdown">\n                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="fa fa-tree" style="font-size:20px"></span> <span class="caret"></span></a>\n                  <ul class="dropdown-menu" role="menu" style="width:400px">\n                    <div>\n                      <li>  &nbsp; Nature</li>    \n                      <button type="button" class="btn btn-thumbnail" ng-click="addImageEnvironment(element);\n                            $event.preventDefault()" ng-repeat="element in elementsNature">\n                        <img class="thumbnail" ng-src="/media/thumbnails/environment/{{element}}.png" width="150px"/>\n                      </button>\n                    </div>\n                  </ul>\n                <li class="dropdown">\n                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="fa fa-home" style="font-size:20px"></span> <span class="caret"></span></a>\n                  <ul class="dropdown-menu" role="menu" style="width:400px">\n                    <li>  &nbsp; Buildings</li>\n                    <button type="button" class="btn btn-thumbnail" ng-click="addImageBuilding(element);\n                          $event.preventDefault()" ng-repeat="element in elementsBuilding">\n                      <img class="thumbnail" ng-src="/media/thumbnails/buildings/{{element}}.png" width="150px"/>\n                    </button>\n                  </ul>\n                </li>\n                <!--                <li class="dropdown">\n                                  <a href="#" class="dropdown-toggle" data-toggle="dropdown"><span class="fa fa-road" style="font-size:20px"></span> <span class="caret"></span></a>\n                                  <ul class="dropdown-menu" role="menu">\n                                    <li><a href="#"></a></li>\n                                  </ul>\n                                </li>-->\n                <li class="dropdown">\n                  <a href="#" ng-click="addText();\n                        $event.preventDefault()">Text &nbsp;<span class="fa fa-text-width"></span></a>\n                  <!--<button class="btn" ng-click="addText()">Add text</button>-->\n                </li>\n                <li class="dropdown">\n                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" onclick="activateFilePickerBackgroundEditor()">Image Picker &nbsp;<span class="fa fa-upload"></span></a>\n                </li>\n              </ul>\n              <!--              <ul class="nav navbar-nav pull-right">\n                              <li class="dropdown">\n                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" ng-click="actionUndo()"><span class="fa fa-rotate-left"></span></a>\n                              </li>\n                              <li class="dropdown">\n                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" ng-click="actionRedo()"><span class="fa fa-rotate-right"></span></a>\n                              </li>\n                            </ul>-->\n            </div><!-- /.navbar-collapse -->\n          </div><!-- /.container-fluid -->\n        </nav>\n\n      </div>\n\n      <div id="color-opacity-controls" ng-show="canvas.getActiveObject()" class="" style="width:130px;left:50%;margin-left:-130px;top:100px;">\n        <nav class="navbar navbar-default" style="z-index: 1" role="navigation">\n          <div class="container-fluid" style="margin-right:0px; padding-right:0px;margin-left:0px; padding-left:0px;">\n            <!--            <div class="navbar-header">\n                          <a class="navbar-brand" href="#"></a>\n                        </div>-->\n            <!-- Collect the nav links, forms, and other content for toggling -->\n            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" style="padding:5px">\n              <ul class="nav navbar-nav">\n                <li class="dropdown pull-right">\n                  <a href="#" ng-click="removeSelected();\n                        $event.preventDefault()">Delete &nbsp;<span class="fa fa-trash-o"></span></a>\n                </li>\n                <li class="dropdown pull-right">\n                  <a href="#" ng-click="cloneSelected();\n                        $event.preventDefault()">Duplicate &nbsp;<span class="fa fa-copy"></span></a>\n                </li>\n\n                <li class="dropdown pull-right">\n                  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Order <span class="caret"></span></a>\n                  <ul class="dropdown-menu" role="menu" style="width:auto">\n                    <li class="dropdown pull-right">\n                      <a href="#" ng-click="bringForward();\n                            $event.preventDefault()">Bring Forward</a>\n                    </li>\n                    <li class="dropdown pull-right">\n                      <a href="#" ng-click="bringToFront();\n                            $event.preventDefault()">Bring to Front</a>\n                    </li>                 \n                    <li class="dropdown pull-right">\n                      <a href="#" ng-click="sendBackwards();\n                            $event.preventDefault()">Send Backwards</a>\n                    </li>\n                    <li class="dropdown pull-right">\n                      <a href="#" ng-click="sendToBack();\n                            $event.preventDefault()">Send to Back</a>\n                    </li>\n                    <li class="dropdown pull-right">\n                      <a href="#" ng-click="setAsBackground();\n                            $event.preventDefault()">Set As Background</a>\n                    </li>\n                  </ul>\n                </li>\n                <li class="dropdown pull-right"  ng-show="!getActiveLine() && (getActiveShape() || getText())">                                     \n                  <a href="#">Color <input type="color" style="width:40px" bind-value-to="fill"></a>                  \n                </li>                \n                <li class="dropdown pull-right"  ng-show="getActiveLine()">                                     \n                  <a href="#">Color <input type="color" style="width:40px" bind-value-to="strokeColor"></a>                  \n                </li>\n                <li class="dropdown pull-right">                   \n                  <a href="#" class="pull-right">Opacity</a> \n                  <input value="100" type="range" style="width:100%;height:15px;display:inline-block;"  bind-value-to="opacity">     \n                </li>\n              </ul>\n            </div><!-- /.navbar-collapse -->\n          </div><!-- /.container-fluid -->\n\n\n          <div id="text-wrapper" style="margin-top: 10px;margin-bottom: 10px;" ng-show="getText()" class="ng-hide">\n            <!--<textarea bind-value-to="text"></textarea>-->\n\n            <div id="text-controls">\n              <!--<label for="font-family" style="display:inline-block">Font</label>-->\n              <select id="font-family" class="btn-object-action" bind-value-to="fontFamily" style="width:100%">\n                <option value="arial">Arial</option>\n                <option value="helvetica">Helvetica</option>\n                <option value="verdana">Verdana</option>\n                <option value="georgia">Georgia</option>\n                <option value="courier">Courier</option>\n                <option value="comic sans ms">Comic Sans</option>\n              </select>\n              <br>\n              <br>\n            </div>\n            <div id="text-controls-additional">\n              &nbsp;\n              <button type="button" class="btn btn-object-action" ng-click="toggleBold();\n                    $event.preventDefault()" ng-class="{\n            \'btn-inverse\'\n                : isBold()}">\n                B\n              </button>\n              <button type="button" class="btn btn-object-action" id="text-cmd-italic" ng-click="toggleItalic();\n                    $event.preventDefault()" ng-class="{\n            \'btn-inverse\'\n                : isItalic()}">\n                I\n              </button>\n              <button type="button" class="btn btn-object-action" id="text-cmd-underline" ng-click="toggleUnderline();\n                    $event.preventDefault()" ng-class="{\n            \'btn-inverse\'\n                :isUnderline()}">\n                U\n              </button>\n            </div>\n          </div>\n        </nav>\n      </div>\n      <div id="color-opacity-controls-group" ng-show="canvas.getActiveGroup()" class="" style="width:130px;left:50%;margin-left:-130px;top:100px;">\n        <nav class="navbar navbar-default" style="z-index: 1" role="navigation">\n          <div class="container-fluid" style="margin-right:0px; padding-right:0px;margin-left:0px; padding-left:0px;">\n            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" style="padding:5px">\n              <ul class="nav navbar-nav">\n                <li class="dropdown pull-right">\n                  <a href="#" ng-click="removeSelected();\n                        $event.preventDefault()">Delete &nbsp;<span class="fa fa-trash-o"></span></a>\n                </li>\n                <li class="dropdown pull-right">\n                  <a href="#" ng-click="deselect();\n                        $event.preventDefault()">Deselect &nbsp;<span class="fa fa-hand-o-up"></span></a>\n                </li>\n                <!--                <li class="dropdown pull-right">\n                                  <a href="#" ng-click="cloneSelected();\n                                      $event.preventDefault()">Duplicate &nbsp;<span class="fa fa-copy"></span></a>\n                                </li>-->\n              </ul>\n            </div><!-- /.navbar-collapse -->\n          </div><!-- /.container-fluid -->\n        </nav>\n      </div>\n    </div>\n  </div>\n</div>\n'}),define("text!apps/activities/listActivities/templates/activity_tile.html",[],function(){return'<% if (tileType === "linkhor") { %>\n<div class="activity-direction">\n  <div class="activity-coordinate" data-x="<%= x  %>" data-y="<%= y %>" ></div>\n  <!--<span><i class="fa fa-minus fa-3x"></i></span>-->\n  <% if ( a !== true ) { %>\n  <div class="horizontal-line js-toggle-tile tile-non-active" \n       <% if ( x===3 && y===2 ) { %>\n       data-intro="Click to activate paths between Activities" data-position="bottom"\n       <% } %>\n       />\n       <% } else { %>\n       <div class="horizontal-line js-toggle-tile tile-active" \n       <% if ( x===3 && y===2 ) { %>\n       data-intro=\'Click to activate paths between Activities\' data-position="bottom"\n       <% } %>\n       />\n       <% } %>\n  </div>\n  <% } else if (tileType === "linkver") {  %>\n\n  <div class="activity-direction ">\n\n    <div class="activity-coordinate" data-x="<%= x  %>" data-y="<%= y %>" >\n      <!--    <span class="vertical-link"> | </span>-->\n    </div>\n    <% if ( a !== true ) { %>\n    <div class="vertical-line js-toggle-tile tile-non-active" />\n    <% } else { %>\n    <div class="vertical-line js-toggle-tile tile-active" />\n    <% } %>\n  </div>\n  <% } else if (tileType === "dropzone") { %>\n  <div class="activity-dropzone dropzone">\n    <div class="activity-coordinate" data-x="<%= x  %>" data-y="<%= y %>" \n         <% if ( x===4 && y===2 ) { %>\n         data-intro=\'<b>Activity</b><br> -Slides with questions <br> -Word List apps <br>  <br>Click to edit <br> Drag to reposition <br><div style="position:absolute;margin-left: -145px;margin-top: -30px;"><div class="checkpoint checkpoint-media"></div></div>\' \n      data-position="right"\n      <% } %>\n      >\n      <!--    <span class="vertical-link"> | </span>-->\n    </div>\n\n  </div>\n  <% } %>\n'}),define("apps/activities/listActivities/listActivities_view",["app","text!apps/activities/listActivities/templates/activities_layout.html","text!apps/activities/listActivities/templates/activity_item.html","text!apps/activities/listActivities/templates/activity_map.html","text!apps/activities/listActivities/templates/activity_tile.html","bootstrap"],function(e,t,n,r,i){return e.module("ActivitiesApp.ListActivities.View",function(e,s,o,u,a,f){var l=72,c=60;e.ActivitiesLayout=u.LayoutView.extend({template:f.template(t),regions:{wordListsRegion:"#wordLists-region",adventureMapRegion:"#adventureMap-region"}});var h={checkpoint_marker:function(){console.log("pluginAppIcon"+this.pluginAppIcon)}};e.Activity=u.ItemView.extend({className:"activity-wrapper btnActivityNoGap drag-drop",template:f.template(n),templateHelpers:h,events:{"click .js-delete":"deleteActivityClicked","click .js-rename":"renameActivityClicked","mousedown .js-move":"mouseDownDetected","touchstart .js-move":"touchStartDetected","click .js-add":"addActivity","click .js-edit":"editActivityClicked","click .js-first":"makeActivityFirst","click .js-activate":"activateActivity","click .js-color":"changeColorClicked"},modelEvents:{"change:x":"xChanged","change:y":"yChanged","change:active":"aChanged"},initialize:function(){this.model.on("change",this.render)},xChanged:function(e,t){this.style.arrange(this)},yChanged:function(e,t){this.style.arrange(this)},aChanged:function(e,t){this.style.activate(this)},colorChanged:function(e,t){this.sytle.color(this)},onRender:function(){this.style.arrange(this),this.style.activate(this),a(".dropdown-toggle").dropdown()},onShow:function(){this.style.animate(this)},style:{arrange:function(e){var t=e.model.get("x"),n=e.model.get("y");a(e.$el).css({left:t*l,top:n*c})},activate:function(e){var t=e.model.get("active");t?(e.$el.find(".js-activate").text("Deactivate"),e.$el.find(".activity-emblem").css("opacity",1)):(e.$el.find(".activity-emblem").css("opacity",.5),e.$el.find(".js-activate").text("Activate"))},animate:function(e){var t=e.model.get("animate");t&&(e.$el.addClass("animated fadeInDown"),e.$el.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){e.$el.removeClass("animated fadeInDown")}))},color:function(e){var t=e.model.get("checkPointIcon");t==="markerBlue"?e.$el.find(".checkpoint").attr("checkpoint markerBlue"):t==="markerBrown"?e.$el.find(".checkpoint").attr("checkpoint markerBrown"):t==="markerGreen"?e.$el.find(".checkpoint").attr("checkpoint markerGreen"):t==="markerPink"?e.$el.find(".checkpoint").attr("checkpoint markerPink"):t==="markerRed"?e.$el.find(".checkpoint").attr("checkpoint markerRed"):t==="markerYellow"&&e.$el.find(".checkpoint").attr("checkpoint markerYellow")}},changeColorClicked:function(e){e.preventDefault();var t=this;t.e=e,this.trigger("activity:color",t)},makeActivityFirst:function(e,t){e.preventDefault();var n=t;this.trigger("activity:first",this)},activateActivity:function(e){e.preventDefault(),this.trigger("activity:activate",this)},deleteActivityClicked:function(){this.trigger("activity:delete",this.model)},editActivityClicked:function(e){e.preventDefault();var t=a(e.currentTarget).closest(".activity-wrapper");this.model.get("activityType")==="media"&&t.addClass("animated bounce infinite-animation"),this.trigger("activity:edit",this.model)},renameActivityClicked:function(e){this.trigger("activity:rename",this.model)},remove:function(){var e=this;u.ItemView.prototype.remove.call(this)},mouseDownDetected:function(e){var t=this;if(e.which!==3){var t=this;e.preventDefault();var n=!1,r=e.pageX,i=e.pageY,s=0,o=0;a(e.target).on("mousemove",function(t){s=t.pageX,o=t.pageY,s-r>0?n=!0:s-r<0&&(n=!0),o-i>0?n=!0:o-i<0&&(n=!0),n===!0&&a(e.target).off("mousemove"),console.log("mousemoved: "+n)}),a(e.target).one("mouseup",function(){a(e.target).off("mousemove");if(!n){var r=a(e.currentTarget).closest(".activity-wrapper");t.model.get("activityType")==="media"&&r.addClass("animated bounce infinite-animation"),t.trigger("activity:edit",t.model)}else t.trigger("activity:setCoordinates",t.view)})}},touchStartDetected:function(e){var t=this;e.preventDefault();var n=!1,r=e.originalEvent.touches[0].pageX,i=e.originalEvent.touches[0].pageY,s=0,o=0;a(e.target).on("touchmove",function(t){s=t.originalEvent.touches[0].pageX,o=t.originalEvent.touches[0].pageY,s-r>0?n=!0:s-r<0&&(n=!0),o-i>0?n=!0:o-i<0&&(n=!0),console.log("touchmoved: "+n),n===!0&&a(e.target).off("touchmove")}),a(e.target).one({touchend:function(){a(e.target).off("touchmove");if(!n){var r=a(e.currentTarget).closest(".activity-wrapper");t.model.get("activityType")==="media"&&r.addClass("animated bounce infinite-animation"),t.trigger("activity:edit",t.model)}else t.trigger("activity:setCoordinates",t.view,t.model)}})}}),e.Activities=u.CompositeView.extend({className:"container-fluid activity-area activity-blue-glow ",template:f.template(r),childView:e.Activity,childViewContainer:"#adventure-view",onRenderTemplate:function(e,t){console.log("render template")},modelEvents:{"change:lessonName":"lessonNameChanged"},lessonNameChanged:function(){this.render()},activityAdded:function(e,t){console.log("model %O",e),console.log("view %O",t)},initialize:function(){var e=this;a(document).off("BackgroundImageUpdate"),a(document).on("BackgroundImageUpdate",function(t,n){var r=n.detail;switch(r.type){case"ResourceUpdate":var i={backgroundImageURL:r.backgroundImageURL,backgroundThumbnailURL:r.backgroundThumbnailURL,backgroundImageJSON:r.backgroundImageJSON};e.trigger("backgroundImage:update",e,i)}})},triggers:{"click .js-new":"activity:new","click .js-rename-lesson":"lesson:rename","click .js-guide":"editor:show:guide"},onRender:function(){console.log("####Activities are rendered"),this.trigger("activity:tiles",this)},onShow:function(){a(".dropdown-toggle").dropdown()}}),e.ActivityTile=u.ItemView.extend({className:"activity-wrapper-tiles",template:f.template(i),events:{"click .js-toggle-tile":"tileToggleClicked"},tileToggleClicked:function(e){e.preventDefault(),this.trigger("tile:toggle",this)},modelEvents:{"change:a":"aChanged"},aChanged:function(){console.log("aChanged"),this.style.activate(this)},style:{activate:function(e){var t=e.model.get("a");console.log("active:"+t),t?(console.log("set style as active"),e.$el.find(".js-toggle-tile").removeClass("tile-non-active").addClass("tile-active")):(console.log("set style as non active"),e.$el.find(".js-toggle-tile").removeClass("tile-active").addClass("tile-non-active"))}},ui:{activityWrapper:".activity-wrapper-tiles"},onRender:function(){this.$el.css({left:this.model.get("x")*l,top:this.model.get("y")*c})}}),e.ActivityTiles=u.CollectionView.extend({className:"tile-collection",childView:e.ActivityTile,onRender:function(){console.log("####Tiles Collections are rendered")}})}),e.ActivitiesApp.ListActivities.View}),!function(e){function t(){}function n(e){return!!e&&("object"==typeof Element?e instanceof Element:e&&"object"==typeof e&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName)}function r(e,t){o(t,gt),e.pageX=gt.x,e.pageY=gt.y,u(t,gt),e.clientX=gt.x,e.clientY=gt.y,e.timeStamp=(new Date).getTime()}function i(e,t,n){e.pageX=n.pageX-t.pageX,e.pageY=n.pageY-t.pageY,e.clientX=n.clientX-t.clientX,e.clientY=n.clientY-t.clientY,e.timeStamp=(new Date).getTime()-t.timeStamp;var r=Math.max(e.timeStamp/1e3,.001);e.pageSpeed=st(e.pageX,e.pageY)/r,e.pageVX=e.pageX/r,e.pageVY=e.pageY/r,e.clientSpeed=st(e.clientX,e.pageY)/r,e.clientVX=e.clientX/r,e.clientVY=e.clientY/r}function s(e,t,n){var r,i,s;return n=n||{},e=e||"page",/touch/.test(t.type)&&t.touches?(r=t.touches.length?t.touches[0]:t.changedTouches[0],i=r[e+"X"],s=r[e+"Y"]):(i=t[e+"X"],s=t[e+"Y"]),n.x=i,n.y=s,n}function o(t,n){return n=n||{},t instanceof S?/inertiastart/.test(t.type)?(o(yt.pointerUp,n),n.x+=yt.sx,n.y+=yt.sy):(n.x=t.pageX,n.y=t.pageY):Zt?(s("screen",t,n),n.x+=e.scrollX,n.y+=e.scrollY):/gesture|inertia/i.test(t.type)?(s("client",t,n),n.x+=Q.documentElement.scrollLeft,n.y+=Q.documentElement.scrollTop):s("page",t,n),n}function u(e,t){return t=t||{},e instanceof S?/inertiastart/.test(e.type)?(u(yt.pointerUp,t),t.x+=yt.sx,t.y+=yt.sy):(t.x=e.clientX,t.y=e.clientY):s(Zt?"screen":"client",e,t),t}function a(){return{x:e.scrollX||Q.documentElement.scrollLeft,y:e.scrollY||Q.documentElement.scrollTop}}function f(e){var t=/ipad|iphone|ipod/i.test(navigator.userAgent)?{x:0,y:0}:a(),n=e instanceof Y?e.getBoundingClientRect():e.getClientRects()[0];return n&&{left:n.left+t.x,right:n.right+t.x,top:n.top+t.y,bottom:n.bottom+t.y,width:n.width||n.right-n.left,height:n.heigh||n.bottom-n.top}}function l(e){var t=[];return e instanceof Array?(t[0]=e[0],t[1]=e[1]):rt?(t[0]=ct[0],t[1]=ct[1]):(t[0]=e.touches[0],t[1]="touchend"===e.type&&1===e.touches.length?e.changedTouches[0]:e.touches[1]),t}function c(e){var t=l(e);return{pageX:(t[0].pageX+t[1].pageX)/2,pageY:(t[0].pageY+t[1].pageY)/2,clientX:(t[0].clientX+t[1].clientX)/2,clientY:(t[0].clientY+t[1].clientY)/2}}function h(e){if(e.touches&&e.touches.length||rt&&ct.length){var t=l(e),n=Math.min(t[0].pageX,t[1].pageX),r=Math.min(t[0].pageY,t[1].pageY),i=Math.max(t[0].pageX,t[1].pageX),s=Math.max(t[0].pageY,t[1].pageY);return{x:n,y:r,left:n,top:r,width:i-n,height:s-r}}}function p(e){var t=(Lt&&Lt.options||Dt).deltaSource,n=t+"X",r=t+"Y",i=l(e),s=i[0][n]-i[1][n],o=i[0][r]-i[1][r];return st(s,o)}function d(e,t){var n=(Lt&&Lt.options||Dt).deltaSource,r=n+"X",i=n+"Y",s=l(e),o=s[0][r]-s[1][r],u=s[0][i]-s[1][i],a=180*Math.atan(u/o)/Math.PI;if("number"==typeof t){var f=a-t,c=f%360;c>315?a-=360+a/360|0:c>135?a-=180+a/360|0:-315>c?a+=360+a/360|0:-135>c&&(a+=180+a/360|0)}return a}function v(e,t){e=e||Lt;var r=e?e.options.origin:Dt.origin;return t=t||e._element,"parent"===r?r=t.parentNode:"self"===r&&(r=t),n(r)?(r=f(r),r.x=r.left,r.y=r.top):"function"==typeof r&&(r=r(e&&t)),r}function m(e){for(var t=0,n=e.length;n>t;t++)e[t].rect=e[t].getRect()}function g(){var e=yt.target.options.inertia,t=e.resistance,n=(new Date).getTime()/1e3-yt.t0;if(n<yt.te){var r=1-(Math.exp(-t*n)-yt.lambda_v0)/yt.one_ve_v0;if(yt.modifiedXe===yt.xe&&yt.modifiedYe===yt.ye)yt.sx=yt.xe*r,yt.sy=yt.ye*r;else{var i=b(0,0,yt.xe,yt.ye,yt.modifiedXe,yt.modifiedYe,r);yt.sx=i.x,yt.sy=i.y}M(yt.startEvent),yt.i=tn(g)}else yt.sx=yt.modifiedXe,yt.sy=yt.modifiedYe,yt.active=!1,M(yt.startEvent),U(yt.startEvent)}function y(e,t,n,r){var i=1-e;return i*i*t+2*i*e*n+e*e*r}function b(e,t,n,r,i,s,o){return{x:y(o,e,n,i),y:y(o,t,r,s)}}function w(e){if(e.length){var t,n,r,i,s,o=e[0],u=[],a=[];for(i=1;i<e.length;i++){if(t=e[i],!u.length)for(n=o;n.parentNode!==Q;)u.unshift(n),n=n.parentNode;if(o instanceof tt&&t instanceof Y&&!(t instanceof Z)){if(t===o.parentNode)continue;n=t.ownerSVGElement}else n=t;for(a=[];n.parentNode!==Q;)a.unshift(n),n=n.parentNode;for(s=0;a[s]&&a[s]===u[s];)s++;var f=[a[s-1],a[s],u[s]];for(r=f[0].lastChild;r;){if(r===f[1]){o=t,u=[];break}if(r===f[2])break;r=r.previousSibling}}return{element:o,index:e.indexOf(o)}}}function E(e,t){if(Et.length||Tt.length){var r,i,s,o=[],u=[],a=[],f=[];for(t=t||Lt._element,r=0;r<Et.length;r++){var l=Et[r];if(n(l.options.accept)){if(l.options.accept!==t)continue}else if("string"==typeof l.options.accept&&!t[en](l.options.accept))continue;t!==l._element&&l.dropCheck(e,Lt,t)&&(o.push(l),u.push(l._element))}if(i=w(u),s=i?o[i.index]:null,Tt.length){for(r=0;r<Tt.length;r++)for(var c=Tt[r],h=Q.querySelectorAll(c.selector),p=0,d=h.length;d>p;p++){if(c._element=h[p],c.rect=c.getRect(),n(c.options.accept)){if(c.options.accept!==t)continue}else if("string"==typeof c.options.accept&&!t[en](c.options.accept))continue;c._element!==t&&-1===u.indexOf(c._element)&&f.indexOf(-1===c._element)&&c.dropCheck(e,Lt)&&(a.push(c),f.push(c._element))}f.length&&(s&&(a.push(s),f.push(s._element)),i=w(f),i&&(s=a[i.index],s.selector&&(s._element=f[i.index])))}return s?{dropzone:s,element:s._element}:null}}function S(e,t,n,i,s){var a,f,l=(Lt&&Lt.options||Dt).deltaSource,m=l+"X",g=l+"Y",y=Lt?Lt.options:Dt,b=v(Lt,i);if(i=i||Lt._element,"gesture"===t){var w=c(e);f={x:w.pageX-b.x,y:w.pageY-b.y},a={x:w.clientX-b.x,y:w.clientY-b.y}}else f=o(e),a=u(e),f.x-=b.x,f.y-=b.y,a.x-=b.x,a.y-=b.y,y.snapEnabled&&-1!==y.snap.actions.indexOf(t)&&(this.snap={range:Pt.range,locked:Pt.locked,x:Pt.x,y:Pt.y,realX:Pt.realX,realY:Pt.realY,dx:Pt.dx,dy:Pt.dy},Pt.locked&&(f.x+=Pt.dx,f.y+=Pt.dy,a.x+=Pt.dx,a.y+=Pt.dy));if(Lt.options.restrict[t]&&Ht.restricted&&(f.x+=Ht.dx,f.y+=Ht.dy,a.x+=Ht.dx,a.y+=Ht.dy,this.restrict={dx:Ht.dx,dy:Ht.dy}),this.pageX=f.x,this.pageY=f.y,this.clientX=a.x,this.clientY=a.y,"start"!==n||e instanceof S||r(at,this),this.x0=at.pageX,this.y0=at.pageY,this.clientX0=at.clientX,this.clientY0=at.clientY,this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.button=e.button,this.target=i,this.t0=ht,this.type=t+(n||""),yt.active&&(this.detail="inertia"),s&&(this.relatedTarget=s),dt&&"inertia"===dt.detail&&!yt.active&&y.inertia.zeroResumeDelta?this.dx=this.dy=0:"end"===n||"drop"===t?"client"===l?(this.dx=a.x-at.clientX,this.dy=a.y-at.clientY):(this.dx=f.x-at.pageX,this.dy=f.y-at.pageY):"inertiastart"===n?(this.dx=dt.dx,this.dy=dt.dy):"client"===l?(this.dx=a.x-dt.clientX,this.dy=a.y-dt.clientY):(this.dx=f.x-dt.pageX,this.dy=f.y-dt.pageY),"resize"===t?y.squareResize||e.shiftKey?("y"===Xt?this.dx=this.dy:this.dy=this.dx,this.axes="xy"):(this.axes=Xt,"x"===Xt?this.dy=0:"y"===Xt&&(this.dx=0)):"gesture"===t&&(this.touches=rt?[ct[0],ct[1]]:e.touches,"start"===n?(this.distance=p(e),this.box=h(e),this.scale=1,this.ds=0,this.angle=d(e),this.da=0):"end"===n||e instanceof S?(this.distance=dt.distance,this.box=dt.box,this.scale=dt.scale,this.ds=this.scale-1,this.angle=dt.angle,this.da=this.angle-bt.startAngle):(this.distance=p(e),this.box=h(e),this.scale=this.distance/bt.startDistance,this.angle=d(e,bt.prevAngle),this.ds=this.scale-bt.prevScale,this.da=this.angle-bt.prevAngle)),"start"===n)this.timeStamp=ht,this.dt=0,this.duration=0,this.speed=0,this.velocityX=0,this.velocityY=0;else if("inertiastart"===n)this.timeStamp=(new Date).getTime(),this.dt=dt.dt,this.duration=dt.duration,this.speed=dt.speed,this.velocityX=dt.velocityX,this.velocityY=dt.velocityY;else{this.timeStamp=(new Date).getTime(),this.dt=this.timeStamp-dt.timeStamp,this.duration=this.timeStamp-ht;var E,x,T;"end"===n||e instanceof S?(T=Math.max(("end"===n?this.duration:this.dt)/1e3,.001),E=this[m]-dt[m],x=this[g]-dt[g],this.snap&&this.snap.locked&&(E-=this.snap.dx,x-=this.snap.dy),this.restrict&&(E-=this.restrict.dx,x-=this.restrict.dy),dt.snap&&dt.snap.locked&&(E-=dt[m]-dt.snap.dx,x-=dt[g]-dt.snap.dy),dt.restrict&&(E+=dt.restrict.dx,x+=dt.restrict.dy),this.speed=st(E,x)/T,this.velocityX=E/T,this.velocityY=x/T):(this.speed=ft[l+"Speed"],this.velocityX=ft[l+"VX"],this.velocityY=ft[l+"VY"])}}function x(){this.originalEvent.preventDefault()}function T(e,t,n){var r,i,s={};for(r in e)e.hasOwnProperty(r)&&(s[r]=e[r]);s.preventDefault=x,s.stopPropagation=S.prototype.stopPropagation,s.stopImmediatePropagation=S.prototype.stopImmediatePropagation,s.timeStamp=(new Date).getTime(),s.originalEvent=e,s.dt=s.timeStamp-ht,s.type="tap";var o=s.timeStamp-vt,u=mt&&"dubletap"!==mt.type&&mt.target===s.target&&500>o;for(vt=s.timeStamp,i=0;i<t.length;i++){var a=v(t[i],n[i]);if(s.pageX-=a.x,s.pageY-=a.y,s.clientX-=a.x,s.clientY-=a.y,s.currentTarget=n[i],t[i].fire(s),s.immediatePropagationStopped||s.propagationStopped&&t[i+1]!==s.currentTarget)break}if(u){var f={};for(r in s)f[r]=s[r];for(f.dt=o,f.type="doubletap",i=0;i<t.length&&(f.currentTarget=n[i],t[i].fire(f),!(f.immediatePropagationStopped||f.propagationStopped&&t[i+1]!==f.currentTarget));i++);mt=f}else mt=s}function N(e){if(!pt||!qt&&e instanceof pt.constructor&&pt.target===e.target){for(var t=[],n=[],r=e.target;r;){V.isSet(r)&&(t.push(V(r)),n.push(r));for(var i in xt){var s=Element.prototype[en]===K?Q.querySelectorAll(i):void 0;r!==Q&&r[en](i,s)&&(t.push(xt[i]),n.push(r))}r=r.parentNode}t.length&&T(e,t,n)}}function C(e,t){if("string"!=typeof e)return null;t=t||Lt;var n=-1!==e.indexOf("resize")?"resize":e,r=(t||Lt).options;return("resize"===n&&r.resizable||"drag"===e&&r.draggable||"gesture"===e&&r.gesturable)&&$t[n]?(("resize"===e||"resizeyx"===e)&&(e="resizexy"),e):null}function k(e){if(Jt&&pt&&e.type!==pt.type)return void (/^input$|^textarea$/i.test(Lt._element.nodeName)||e.preventDefault());if(!(pt&&"mousedown"===e.type&&"touchstart"===pt.type&&e.timeStamp-pt.timeStamp<300)){var t,n=e.target instanceof et?e.target.correspondingUseElement:e.target;if(rt&&_(e),yt.active&&Lt.selector)for(;n&&n!==Q;){if(n===yt.targetElement&&C(Lt.getAction(e))===Jt)return nn(yt.i),yt.active=!1,void (rt&&_(e,kt));n=n.parentNode}if(!(Ut||Wt||Rt)){if(Nt.length&&/mousedown|pointerdown/i.test(e.type))t=F(e,Nt);else for(var i,s;n&&n!==Q&&!t;){Nt=[];for(i in xt)s=Element.prototype[en]===K?Q.querySelectorAll(i):void 0,n[en](i,s)&&(xt[i]._element=n,Nt.push(xt[i]));t=F(e,Nt),n=n.parentNode}return t?(It=!0,Jt=t,L(e,t)):(ht=(new Date).getTime(),pt=e,r(ot,e),qt=!1,void 0)}}}function L(e,t){if(!t&&It&&pt&&e.type!==pt.type)return void (/^input$|^textarea$/i.test(Lt._element.nodeName)||e.preventDefault());It=!0,rt&&_(e),((e.touches&&e.touches.length<2||lt&&lt.length<2)&&!Lt||!Jt)&&(Lt=wt.get(e.currentTarget));var n=Lt&&Lt.options;if(Lt&&!(Ut||Wt||Rt)){var i=C(t||Lt.getAction(e));if(r(at,e),rt&&e instanceof rt&&(Lt._gesture.target||(Lt._gesture.target=Lt._element),_(e,Lt._gesture)),!i)return e;qt=!1,n.styleCursor&&(Q.documentElement.style.cursor=Vt[i].cursor),Xt="resizexy"===i?"xy":"resizex"===i?"x":"resizey"===i?"y":"","gesture"===i&&(e.touches&&e.touches.length<2||rt&&lt.length<2)&&(i=null),Jt=i,Pt.x=null,Pt.y=null,ht=(new Date).getTime(),pt=e,r(ot,e),qt=!1,/^input$|^textarea$/i.test(Lt._element.nodeName)||e.preventDefault()}else yt.active&&e.currentTarget===yt.targetElement&&Lt===yt.target&&C(Lt.getAction(e))===Jt&&(nn(yt.i),yt.active=!1,rt&&(Lt._gesture.target||(Lt._gesture.target=Lt._element),_(e,Lt._gesture)))}function A(e,t){var n,r,i,s,u,a,f,l,c,h,p=Lt.options.snap,d=p.anchors;if(t=t||Pt,t.useStatusXY)n={x:t.x,y:t.y};else{var m=v(Lt);n=o(e),n.x-=m.x,n.y-=m.y}if(t.realX=n.x,t.realY=n.y,p.range<0&&(p.range=1/0),"path"===p.mode)for(d=[],c=0,h=p.paths.length;h>c;c++){var g=p.paths[c];"function"==typeof g&&(g=g(n.x,n.y)),d.push({x:"number"==typeof g.x?g.x:n.x,y:"number"==typeof g.y?g.y:n.y,range:"number"==typeof g.range?g.range:p.range})}if("anchor"!==p.mode&&"path"!==p.mode||!d.length){if("grid"===p.mode){var y=Math.round((n.x-p.gridOffset.x)/p.grid.x),b=Math.round((n.y-p.gridOffset.y)/p.grid.y),w=y*p.grid.x+p.gridOffset.x,E=b*p.grid.y+p.gridOffset.y;a=w-n.x,f=E-n.y,l=st(a,f),s=l<p.range,u=w!==t.x||E!==t.y,t.x=w,t.y=E,t.dx=a,t.dy=f,t.range=p.range}}else{for(r={anchor:null,distance:0,range:0,dx:0,dy:0},c=0,h=d.length;h>c;c++){var S=d[c];i="number"==typeof S.range?S.range:p.range,a=S.x-n.x,f=S.y-n.y,l=st(a,f),s=i>l,1/0===i&&r.inRange&&1/0!==r.range&&(s=!1),(!r.anchor||(s?r.inRange&&1/0!==i?l/i<r.distance/r.range:l<r.distance:!r.inRange&&l<r.distance))&&(1/0===i&&(s=!0),r.anchor=S,r.distance=l,r.range=i,r.inRange=s,r.dx=a,r.dy=f,t.range=i)}s=r.inRange,u=r.anchor.x!==t.x||r.anchor.y!==t.y,t.x=r.anchor.x,t.y=r.anchor.y,t.dx=r.dx,t.dy=r.dy}return t.changed=u||s&&!t.locked,t.locked=s,t}function O(e,t){var r,i=V.currentAction()||Jt,s=Lt&&Lt.options.restrict[i];if(t=t||Ht,r=r=t.useStatusXY?{x:t.x,y:t.y}:o(e),t.snap&&t.snap.locked&&(r.x+=t.snap.dx||0,r.y+=t.snap.dy||0),t.dx=0,t.dy=0,t.restricted=!1,!i||!s)return t;var u;return"parent"===s?s=Lt._element.parentNode:"self"===s&&(s=Lt._element),n(s)?u=f(s):("function"==typeof s&&(s=s(r.x,r.y,Lt._element)),u=s,"x"in s&&"y"in s&&(u={left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height})),t.dx=Math.max(Math.min(u.right,r.x),u.left)-r.x,t.dy=Math.max(Math.min(u.bottom,r.y),u.top)-r.y,t.restricted=!0,t}function M(e,t){if(It){if(e instanceof S||r(ut,e),!qt){var n=ut.clientX-ot.clientX,s=ut.clientY-ot.clientY;qt=st(n,s)>1}if(Jt&&("mousemove"!==e.type||"touchstart"!==pt.type)){if(qt&&(!yt.active||e instanceof S&&/inertiastart/.test(e.type))&&(Ut||Wt||Rt||i(ft,ot,ut),Jt&&Lt)){var o=Lt.options.restrictEnabled&&(!Lt.options.restrict.endOnly||t),u=!(Ut||Wt||Rt),a=u?pt:e;u&&(dt=pt),o||(Ht.restricted=!1),!Lt.options.snapEnabled||-1===Lt.options.snap.actions.indexOf(Jt)||Lt.options.snap.endOnly&&!t?(o&&O(e),Vt[Jt].moveListener(e)):(A(a),(Pt.changed||!Pt.locked||o)&&(o&&O(e),Vt[Jt].moveListener(e)))}e instanceof S||(i(ft,ot,ut),r(ot,e)),(Ut||Wt)&&Bt.edgeMove(e)}}}function _(e,t){if(!lt.length||ct[0].pointerType===e.pointerType){t&&t.addPointer(e.pointerId);var n=lt.indexOf(e.pointerId);-1===n?(lt.push(e.pointerId),ct[lt.length-1]=e):ct[n]=e}}function D(e){var t=lt.indexOf(e.pointerId);-1!==t&&lt.splice(t,1)}function P(e){var t=lt.indexOf(e.pointerId);-1!==t&&(/move/i.test(e.type)?ct[t]=e:/up|cancel/i.test(e.type)&&(D(e),Rt&&lt.length<2&&Lt._gesture.stop()))}function H(e){e.preventDefault();var t,n,r,i,s;if(!Ut){if(t=new S(pt,"drag","start"),Ut=!0,Lt.fire(t),!zt){m(Et);for(var o=0;o<Tt.length;o++)Tt[o]._elements=Q.querySelectorAll(Tt[o].selector)}dt=t,Lt.options.snapEnabled&&!Lt.options.snap.endOnly&&A(e)}t=new S(e,"drag","move");var u=Lt._element,a=E(t,u);a?(i=a.dropzone,Ot=a.element):i=Ot=null,Lt._element=u,Ot!==_t&&(Mt&&(r=new S(e,"drag","leave",_t,u),t.dragLeave=_t,s=Mt,Mt=_t=null),i&&(n=new S(e,"drag","enter",Ot,u),t.dragEnter=i._element,Mt=i,_t=Mt._element)),Lt.fire(t),r&&s.fire(r),n&&i.fire(n),dt=t}function B(e){e.preventDefault();var t;Wt||(t=new S(pt,"resize","start"),Lt.fire(t),Lt.fire(t),Wt=!0,dt=t,Lt.options.snapEnabled&&!Lt.options.snap.endOnly&&A(e)),t=new S(e,"resize","move"),Lt.fire(t),dt=t}function j(e){if(e.touches&&!(e.touches.length<2)||rt){e.preventDefault();var t;Rt||(t=new S(pt,"gesture","start"),t.ds=0,bt.startDistance=bt.prevDistance=t.distance,bt.startAngle=bt.prevAngle=t.angle,bt.scale=1,Rt=!0,Lt.fire(t),dt=t,Lt.options.snapEnabled&&!Lt.options.snap.endOnly&&A(e)),t=new S(e,"gesture","move"),t.ds=t.scale-bt.scale,Lt.fire(t),dt=t,bt.prevAngle=t.angle,bt.prevDistance=t.distance,1/0===t.scale||null===t.scale||void 0===t.scale||isNaN(t.scale)||(bt.scale=t.scale)}}function F(e,t){for(var n=0,r=t.length;r>n;n++){var i=t[n],s=C(i.getAction(e,i),i);if(s)return Lt=i,s}}function I(e){if(!(It||Ut||Wt||Rt)){var t=[],n=Lt&&Lt._element,r=e.target instanceof et?e.target.correspondingUseElement:e.target;for(var i in xt)xt.hasOwnProperty(i)&&xt[i]&&r[en](i)&&(xt[i]._element=r,t.push(xt[i]));var s=wt.get(r),o=s&&C(s.getAction(e),s);if(o)Lt=s,Nt=[];else if(F(e,t))Nt=t,R(e,Nt),an.addToElement(r,"mousemove",R);else if(Lt){var u=n.querySelectorAll("*");if(-1!==Array.prototype.indexOf.call(u,r)){for(var a=0;a<Nt.length;a++)Nt[a]._element=n;R(e,Nt),an.addToElement(Lt._element,"mousemove",R)}else Lt=null,Nt=[]}}}function q(e){if(!(It||Ut||Wt||Rt)){var t=e.target instanceof et?e.target.correspondingUseElement:e.target;wt.get(t)||an.removeFromElement(t,R),Lt&&Lt.options.styleCursor&&!(Ut||Wt||Rt)&&(Q.documentElement.style.cursor="")}}function R(e,t){if(It||Ut||Wt||Rt)Jt&&e.preventDefault();else{var n;t?n=F(e,t):Lt&&(n=C(Lt.getAction(e))),Lt&&Lt.options.styleCursor&&(Q.documentElement.style.cursor=n?Vt[n].cursor:"")}}function U(e){if((e instanceof S||rt||!It||!pt||e instanceof pt.constructor)&&!(e.touches&&e.touches.length>=2)){if(it&&e instanceof it&&/inertiastart/i.test(e.type))return void e.gestureObject.stop();var t,n,r=Lt&&Lt.options.inertia;if(Ut||Wt||Rt){if(yt.active)return;var i=Lt.options.deltaSource,s=ft[i+"Speed"];if(Lt.options.inertiaEnabled&&"gesture"!==Jt&&-1!==r.actions.indexOf(Jt)&&e!==yt.startEvent&&(new Date).getTime()-ut.timeStamp<50&&s>r.minSpeed&&s>r.endSpeed){var o,u=r.resistance,a=-Math.log(r.endSpeed/s)/u;if(yt.active=!0,yt.target=Lt,yt.targetElement=Lt._element,an.useAttachEvent)for(n in e)e.hasOwnProperty(n)&&(yt.pointerUp[n]=e[n]);else yt.pointerUp=e;yt.startEvent=o=new S(e,"drag","inertiastart"),yt.vx0=ft[i+"VX"],yt.vy0=ft[i+"VY"],yt.v0=s,yt.x0=dt.pageX,yt.y0=dt.pageY,yt.t0=yt.startEvent.timeStamp/1e3,yt.sx=yt.sy=0,yt.modifiedXe=yt.xe=(yt.vx0-a)/u,yt.modifiedYe=yt.ye=(yt.vy0-a)/u,yt.te=a,yt.lambda_v0=u/yt.v0,yt.one_ve_v0=1-r.endSpeed/yt.v0;var f,l=o.pageX,c=o.pageY;if(o.snap&&o.snap.locked&&(l-=o.snap.dx,c-=o.snap.dy),o.restrict&&(l-=o.restrict.dx,c-=o.restrict.dy),f={useStatusXY:!0,x:l+yt.xe,y:c+yt.ye,dx:0,dy:0,snap:null},f.snap=f,Lt.options.snapEnabled&&Lt.options.snap.endOnly){var h=A(e,f);h.locked&&(yt.modifiedXe+=h.dx,yt.modifiedYe+=h.dy)}if(Lt.options.restrictEnabled&&Lt.options.restrict.endOnly){var p=O(e,f);yt.modifiedXe+=p.dx,yt.modifiedYe+=p.dy}return nn(yt.i),yt.i=tn(g),void Lt.fire(yt.startEvent)}(Lt.options.snapEnabled&&Lt.options.snap.endOnly||Lt.options.restrictEnabled&&Lt.options.restrict.endOnly)&&M(e,!0)}if(Ut){t=new S(e,"drag","end");var d,v=Lt._element,m=E(t,v);if(m?(At=m.dropzone,Ot=m.element):(At=null,Ot=null),Lt._element=v,At)d=new S(e,"drop",null,Ot,v),t.dropzone=Ot;else if(Mt){var y=new S(e,"drag","leave",Ot,v);Mt.fire(y,v),t.dragLeave=_t}Lt.fire(t),d&&At.fire(d)}else Wt?(t=new S(e,"resize","end"),Lt.fire(t)):Rt&&(t=new S(e,"gesture","end"),Lt.fire(t));V.stop()}}function z(e,t){var n,r,i={},s=Ct[e.type],o=e.target;t=t?!0:!1;for(var u in e)i[u]=e[u];for(i.preventDefault=function(){e.preventDefault()};o&&o!==Q;){for(n in s)if(o[en](n)){var a=s[n];for(i.currentTarget=o,r=0;r<a.length;r++)if(a[r][1]===t)try{a[r][0](i)}catch(f){G.error('Error thrown from delegated listener: "'+n+'" '+e.type+" "+(a[r][0].name?a[r][0].name:"")),G.log(f)}}o=o.parentNode}}function W(e){return z.call(this,e,!0)}function X(){Lt&&!Lt.selector&&(Lt=null),At=Ot=Mt=_t=null}function V(e){return wt.get(e)||new J(e)}function $(e){for(var t in Dt)e.hasOwnProperty(t)&&typeof e[t]==typeof Dt[t]&&(this[t]=e[t])}function J(e,t){this._element=e,this._iEvents=this._iEvents||{},"string"==typeof e?(Q.querySelector(e),xt[e]=this,this.selector=e,this._gesture=kt):(n(e)&&(rt?(an.add(this,"pointerdown",L),an.add(this,"pointermove",R),this._gesture=new nt,this._gesture.target=e):(an.add(this,"mousedown",L),an.add(this,"mousemove",R),an.add(this,"touchstart",L),an.add(this,"touchmove",R))),St.push(this)),wt.push(this),this.set(t)}var K,Q=e.document,G=e.console,Y=e.SVGElement||t,Z=e.SVGSVGElement||t,et=e.SVGElementInstance||t,tt=e.HTMLElement||e.Element,nt=e.Gesture||e.MSGesture,rt=nt&&(e.PointerEvent||e.MSPointerEvent),it=nt&&(e.GestureEvent||e.MSGestureEvent),st=Math.hypot||function(e,t){return Math.sqrt(e*e+t*t)},ot={pageX:0,pageY:0,clientX:0,clientY:0,timeStamp:0},ut={pageX:0,pageY:0,clientX:0,clientY:0,timeStamp:0},at={pageX:0,pageY:0,clientX:0,clientY:0,timeStamp:0},ft={pageX:0,pageY:0,clientX:0,clientY:0,timeStamp:0,pageSpeed:0,clientSpeed:0},lt=rt?[]:null,ct=rt?[]:null,ht=0,pt=null,dt=null,vt=0,mt=null,gt={},yt={active:!1,target:null,targetElement:null,startEvent:null,pointerUp:{},xe:0,ye:0,duration:0,t0:0,vx0:0,vys:0,lambda_v0:0,one_ve_v0:0,i:null},bt={start:{x:0,y:0},startDistance:0,prevDistance:0,distance:0,scale:1,startAngle:0,prevAngle:0},wt=[],Et=[],St=[],xt={},Tt=[],Nt=[],Ct={},kt=null,Lt=null,At=null,Ot=null,Mt=null,_t=null,Dt={draggable:!1,dropzone:!1,accept:null,resizable:!1,squareResize:!1,resizeAxis:"xy",gesturable:!1,styleCursor:!0,snap:{mode:"grid",endOnly:!1,actions:["drag"],range:1/0,grid:{x:100,y:100},gridOffset:{x:0,y:0},anchors:[],paths:[],arrayTypes:/^anchors$|^paths$|^actions$/,objectTypes:/^grid$|^gridOffset$/,stringTypes:/^mode$/,numberTypes:/^range$/,boolTypes:/^endOnly$/},snapEnabled:!1,restrict:{drag:null,resize:null,gesture:null,endOnly:!1},restrictEnabled:!0,autoScroll:{container:e,margin:60,speed:300,numberTypes:/^margin$|^speed$/},autoScrollEnabled:!1,inertia:{resistance:10,minSpeed:100,endSpeed:10,actions:["drag","resize"],zeroResumeDelta:!1,numberTypes:/^resistance$|^minSpeed$|^endSpeed$/,arrayTypes:/^actions$/,boolTypes:/^zeroResumeDelta$/},inertiaEnabled:!1,origin:{x:0,y:0},deltaSource:"page"},Pt={locked:!1,x:0,y:0,dx:0,dy:0,realX:0,realY:0,anchors:[],paths:[]},Ht={dx:0,dy:0,snap:Pt,restricted:!1},Bt={target:null,i:null,x:0,y:0,scroll:function(){var t=Bt.target.options.autoScroll,n=t.container,r=(new Date).getTime(),i=(r-Bt.prevTime)/1e3,s=t.speed*i;s>=1&&(n instanceof e.Window?n.scrollBy(Bt.x*s,Bt.y*s):n&&(n.scrollLeft+=Bt.x*s,n.scrollTop+=Bt.y*s),Bt.prevTime=r),Bt.isScrolling&&(nn(Bt.i),Bt.i=tn(Bt.scroll))},edgeMove:function(t){if(Lt&&Lt.options.autoScrollEnabled&&(Ut||Wt)){var n,r,i,s,o=Lt.options.autoScroll;if(o.container instanceof e.Window)s=t.clientX<Bt.margin,n=t.clientY<Bt.margin,r=t.clientX>o.container.innerWidth-Bt.margin,i=t.clientY>o.container.innerHeight-Bt.margin;else{var u=f(o.container);s=t.clientX<u.left+Bt.margin,n=t.clientY<u.top+Bt.margin,r=t.clientX>u.right-Bt.margin,i=t.clientY>u.bottom-Bt.margin}Bt.x=r?1:s?-1:0,Bt.y=i?1:n?-1:0,Bt.isScrolling||(Bt.margin=o.margin,Bt.speed=o.speed,Bt.start(Lt))}},isScrolling:!1,prevTime:0,start:function(e){Bt.isScrolling=!0,nn(Bt.i),Bt.target=e,Bt.prevTime=(new Date).getTime(),Bt.i=tn(Bt.scroll)},stop:function(){Bt.isScrolling=!1,nn(Bt.i)}},jt="createTouch"in Q,Ft=jt?20:10,It=!1,qt=!1,Rt=!1,Ut=!1,zt=!1,Wt=!1,Xt="xy",Vt={drag:{cursor:"move",moveListener:H},resizex:{cursor:"e-resize",moveListener:B},resizey:{cursor:"s-resize",moveListener:B},resizexy:{cursor:"se-resize",moveListener:B},gesture:{cursor:"",moveListener:j}},$t={drag:!0,resize:!0,gesture:!0},Jt=null,Kt="onmousewheel"in Q?"mousewheel":"wheel",Qt=["dragstart","dragmove","draginertiastart","dragend","dragenter","dragleave","drop","resizestart","resizemove","resizeinertiastart","resizeend","gesturestart","gesturemove","gestureinertiastart","gestureend","tap","doubletap"],Gt={},Yt={directBind:0,onevent:1,globalBind:2},Zt="Opera"==navigator.appName&&jt&&navigator.userAgent.match("Presto"),en="matchesSelector"in Element.prototype?"matchesSelector":"webkitMatchesSelector"in Element.prototype?"webkitMatchesSelector":"mozMatchesSelector"in Element.prototype?"mozMatchesSelector":"oMatchesSelector"in Element.prototype?"oMatchesSelector":"msMatchesSelector",tn=e.requestAnimationFrame,nn=e.cancelAnimationFrame,rn={_element:e,events:{}},sn={_element:Q,events:{}},on={_element:e.parent,events:{}},un={_element:null,events:{}},an=function(){function t(e,t,n,r){var o=a.indexOf(e),c=f[o];if(c||(c={events:{},typeCount:0},o=a.push(e)-1,f.push(c),l.push(i?{supplied:[],wrapped:[],useCount:[]}:null)),c.events[t]||(c.events[t]=[],c.typeCount++),-1===c.events[t].indexOf(n)){var h;if(i){var p=l[o],d=p.supplied.indexOf(n),v=p.wrapped[d]||function(t){t.immediatePropagationStopped||(t.target=t.srcElement,t.currentTarget=e,/mouse|click/.test(t.type)&&(t.pageX=t.clientX+Q.documentElement.scrollLeft,t.pageY=t.clientY+Q.documentElement.scrollTop),n(t))};h=e[s](u+t,v,Boolean(r)),-1===d?(p.supplied.push(n),p.wrapped.push(v),p.useCount.push(1)):p.useCount[d]++}else h=e[s](t,n,r||!1);return c.events[t].push(n),h}}function n(e,t,r,s){var c,h,p,d=a.indexOf(e),v=f[d],m=r;if(v&&v.events)if(i&&(h=l[d],p=h.supplied.indexOf(r),m=h.wrapped[p]),"all"!==t){if(v.events[t]){var g=v.events[t].length;if("all"===r)for(c=0;g>c;c++)n(e,t,v.events[t][c],Boolean(s));else for(c=0;g>c;c++)if(v.events[t][c]===r){e[o](u+t,m,s||!1),v.events[t].splice(c,1),i&&h&&(h.useCount[p]--,0===h.useCount[p]&&(h.supplied.splice(p,1),h.wrapped.splice(p,1),h.useCount.splice(p,1)));break}v.events[t]&&0===v.events[t].length&&(v.events[t]=null,v.typeCount--)}v.typeCount||(f.splice(d),a.splice(d),l.splice(d))}else for(t in v.events)v.events.hasOwnProperty(t)&&n(e,t,"all")}var r=e.Event,i="attachEvent"in e&&!("addEventListener"in e),s=i?"attachEvent":"addEventListener",o=i?"detachEvent":"removeEventListener",u=i?"on":"",a=[],f=[],l=[];return"indexOf"in Array.prototype||(Array.prototype.indexOf=function(e){var t=this.length>>>0,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=t);t>n;n++)if(n in this&&this[n]===e)return n;return-1}),"stopPropagation"in r.prototype||(r.prototype.stopPropagation=function(){this.cancelBubble=!0},r.prototype.stopImmediatePropagation=function(){this.cancelBubble=!0,this.immediatePropagationStopped=!0}),"preventDefault"in r.prototype||(r.prototype.preventDefault=function(){this.returnValue=!1}),"hasOwnProperty"in r.prototype||(r.prototype.hasOwnProperty=Object.prototype.hasOwnProperty),{add:function(e,n,r,i){t(e._element,n,r,i)},remove:function(e,t,r,i){n(e._element,t,r,i)},addToElement:t,removeFromElement:n,useAttachEvent:i}}();S.prototype={preventDefault:t,stopImmediatePropagation:function(){this.immediatePropagationStopped=this.propagationStopped=!0},stopPropagation:function(){this.propagationStopped=!0}},wt.indexOfElement=Et.indexOfElement=function(e){for(var t=0;t<this.length;t++){var n=this[t];if(n.selector===e||!n.selector&&n._element===e)return t}return-1},wt.get=function(e){return"string"==typeof e?xt[e]:this[this.indexOfElement(e)]},Et.get=function(e){return this[this.indexOfElement(e)]},$.prototype=Dt,J.prototype={setOnEvents:function(e,t){if("drop"===e){var n=t.ondrop||t.onDrop||t.drop,r=t.ondragenter||t.onDropEnter||t.dragenter,i=t.ondragleave||t.onDropLeave||t.dragleave;"function"==typeof n&&(this.ondrop=n),"function"==typeof r&&(this.ondragenter=r),"function"==typeof i&&(this.ondragleave=i)}else{var s=t.onstart||t.onStart||t.start,o=t.onmove||t.onMove||t.move,u=t.onend||t.onEnd||t.end,a=t.oninertiastart||t.onInertiaStart||t.inertiastart;e="on"+e,"function"==typeof s&&(this[e+"start"]=s),"function"==typeof o&&(this[e+"move"]=o),"function"==typeof u&&(this[e+"end"]=u),"function"==typeof a&&(this[e+"inertiastart"]=a)}return this},draggable:function(e){return e instanceof Object?(this.options.draggable=!0,this.setOnEvents("drag",e),this):"boolean"==typeof e?(this.options.draggable=e,this):null===e?(delete this.options.draggable,this):this.options.draggable},dropzone:function(e){if(e instanceof Object)return this.options.dropzone=!0,this.setOnEvents("drop",e),this.accept(e.accept),(this.selector?Tt:Et).push(this),zt||this.selector||(this.rect=this.getRect()),this;if("boolean"==typeof e){if(e)(this.selector?Tt:Et).push(this),zt||this.selector||(this.rect=this.getRect());else{var t=this.selector?Tt:Et,n=t.indexOf(this);-1!==n&&t.splice(n,1)}return this.options.dropzone=e,this}return null===e?(delete this.options.dropzone,this):this.options.dropzone},dropCheck:function(e,t,n){var r,i,s=o(e),u=v(t,n);return s.x+=u.x,s.y+=u.y,zt&&(this.rect=this.getRect()),this.rect?(r=s.x>this.rect.left&&s.x<this.rect.right,i=s.y>this.rect.top&&s.y<this.rect.bottom,r&&i):!1},dropChecker:function(e){return"function"==typeof e?(this.dropCheck=e,this):this.dropCheck},accept:function(e){return n(e)?(this.options.accept=e,this):"string"==typeof e?(Q.querySelector(e),this.options.accept=e,this):null===e?(delete this.options.accept,this):this.options.accept},resizable:function(e){return e instanceof Object?(this.options.resizable=!0,this.setOnEvents("resize",e),/^x$|^y$|^xy$/.test(e.axis)?this.options.resizeAxis=e.axis:null===e.axis&&(this.options.resizeAxis=Dt.resizeAxis),this):"boolean"==typeof e?(this.options.resizable=e,this):this.options.resizable},resizeable:t,squareResize:function(e){return"boolean"==typeof e?(this.options.squareResize=e,this):null===e?(delete this.options.squareResize,this):this.options.squareResize},gesturable:function(e){return e instanceof Object?(this.options.gesturable=!0,this.setOnEvents("gesture",e),this):"boolean"==typeof e?(this.options.gesturable=e,this):null===e?(delete this.options.gesturable,this):this.options.gesturable},gestureable:t,autoScroll:function(t){var r=Dt.autoScroll;if(t instanceof Object){var i=this.options.autoScroll;return i===r&&(i=this.options.autoScroll={margin:r.margin,distance:r.distance,interval:r.interval,container:r.container}),i.margin=this.validateSetting("autoScroll","margin",t.margin),i.speed=this.validateSetting("autoScroll","speed",t.speed),i.container=n(t.container)||t.container instanceof e.Window?t.container:r.container,this.options.autoScrollEnabled=!0,this.options.autoScroll=i,this}return"boolean"==typeof t?(this.options.autoScrollEnabled=t,this):null===t?(delete this.options.autoScrollEnabled,delete this.options.autoScroll,this):this.options.autoScrollEnabled?this.options.autoScroll:!1},snap:function(e){var t=Dt.snap;if(e instanceof Object){var n=this.options.snap;return n===t&&(n={}),n.mode=this.validateSetting("snap","mode",e.mode),n.endOnly=this.validateSetting("snap","endOnly",e.endOnly),n.actions=this.validateSetting("snap","actions",e.actions),n.range=this.validateSetting("snap","range",e.range),n.paths=this.validateSetting("snap","paths",e.paths),n.grid=this.validateSetting("snap","grid",e.grid),n.gridOffset=this.validateSetting("snap","gridOffset",e.gridOffset),n.anchors=this.validateSetting("snap","anchors",e.anchors),this.options.snapEnabled=!0,this.options.snap=n,this}return"boolean"==typeof e?(this.options.snapEnabled=e,this):null===e?(delete this.options.snapEnabled,delete this.options.snap,this):this.options.snapEnabled?this.options.snap:!1},inertia:function(e){var t=Dt.inertia;if(e instanceof Object){var n=this.options.inertia;return n===t&&(n=this.options.inertia={resistance:t.resistance,minSpeed:t.minSpeed,endSpeed:t.endSpeed,actions:t.actions,zeroResumeDelta:t.zeroResumeDelta}),n.resistance=this.validateSetting("inertia","resistance",e.resistance),n.minSpeed=this.validateSetting("inertia","minSpeed",e.minSpeed),n.endSpeed=this.validateSetting("inertia","endSpeed",e.endSpeed),n.actions=this.validateSetting("inertia","actions",e.actions),n.zeroResumeDelta=this.validateSetting("inertia","zeroResumeDelta",e.zeroResumeDelta),this.options.inertiaEnabled=!0,this.options.inertia=n,this}return"boolean"==typeof e?(this.options.inertiaEnabled=e,this):null===e?(delete this.options.inertiaEnabled,delete this.options.inertia,this):this.options.inertiaEnabled?this.options.inertia:!1},getAction:function(e){var t,n,r,i=this.getRect(),s=o(e),u=this.options;return $t.resize&&u.resizable&&(t="y"!==u.resizeAxis&&s.x>i.right-Ft,n="x"!==u.resizeAxis&&s.y>i.bottom-Ft),Xt=(t?"x":"")+(n?"y":""),r=Xt?"resize"+Xt:$t.drag&&u.draggable?"drag":null,$t.gesture&&(e.touches&&e.touches.length>=2||rt&&lt.length>=2)&&!Ut&&!Wt&&(r="gesture"),r},actionChecker:function(e){return"function"==typeof e?(this.getAction=e,this):null===e?(delete this.options.getAction,this):this.getAction},getRect:function(){return this.selector&&!n(this._element)&&(this._element=Q.querySelector(this.selector)),f(this._element)},rectChecker:function(e){return"function"==typeof e?(this.getRect=e,this):null===e?(delete this.options.getRect,this):this.getRect},styleCursor:function(e){return"boolean"==typeof e?(this.options.styleCursor=e,this):null===e?(delete this.options.styleCursor,this):this.options.styleCursor},origin:function(e){return e instanceof Object||/^parent$|^self$/.test(e)?(this.options.origin=e,this):null===e?(delete this.options.origin,this):this.options.origin},deltaSource:function(e){return"page"===e||"client"===e?(this.options.deltaSource=e,this):null===e?(delete this.options.deltaSource,this):this.options.deltaSource},restrict:function(e){if(void 0===e)return this.options.restrict;if(e instanceof Object){var t={};(e.drag instanceof Object||/^parent$|^self$/.test(e.drag))&&(t.drag=e.drag),(e.resize instanceof Object||/^parent$|^self$/.test(e.resize))&&(t.resize=e.resize),(e.gesture instanceof Object||/^parent$|^self$/.test(e.gesture))&&(t.gesture=e.gesture),"boolean"==typeof e.endOnly&&(t.endOnly=e.endOnly),this.options.restrictEnabled=!0,this.options.restrict=t}else null===e&&(delete this.options.restrict,delete this.options.restrictEnabled);return this},validateSetting:function(e,t,r){var i=Dt[e],s=this.options[e];if(void 0!==i&&void 0!==i[t]){if("objectTypes"in i&&i.objectTypes.test(t))return r instanceof Object?r:t in s&&s[t]instanceof Object?s[t]:i[t];if("arrayTypes"in i&&i.arrayTypes.test(t))return r instanceof Array?r:t in s&&s[t]instanceof Array?s[t]:i[t];if("stringTypes"in i&&i.stringTypes.test(t))return"string"==typeof r?r:t in s&&"string"==typeof s[t]?s[t]:i[t];if("numberTypes"in i&&i.numberTypes.test(t))return"number"==typeof r?r:t in s&&"number"==typeof s[t]?s[t]:i[t];if("boolTypes"in i&&i.boolTypes.test(t))return"boolean"==typeof r?r:t in s&&"boolean"==typeof s[t]?s[t]:i[t];if("elementTypes"in i&&i.elementTypes.test(t))return n(r)?r:t in s&&n(s[t])?s[t]:i[t]}return null},element:function(){return this._element},fire:function(e){if(!e||!e.type||-1===Qt.indexOf(e.type))return this;for(var t,n,r=0,i=0,s="on"+e.type;3>r;)try{switch(r){case Yt.directBind:if(e.type in this._iEvents){for(t=this._iEvents[e.type],n=t.length;n>i&&!e.immediatePropagationStopped;i++)t[i](e);break}break;case Yt.onevent:"function"==typeof this[s]&&this[s](e);break;case Yt.globalBind:if(e.type in Gt&&(t=Gt[e.type]))for(n=t.length;n>i&&!e.immediatePropagationStopped;i++)t[i](e)}if(e.propagationStopped)break;i=0,r++}catch(o){G.error("Error thrown from "+e.type+" listener"),G.error(o),i++,r===Yt.onevent&&r++}return this},on:function(e,t,n){if("wheel"===e&&(e=Kt),-1!==Qt.indexOf(e))e in this._iEvents?-1===this._iEvents[e].indexOf(t)&&this._iEvents[e].push(t):this._iEvents[e]=[t];else if(this.selector){Ct[e]||(Ct[e]={});var r=Ct[e];r[this.selector]||(r[this.selector]=[]),r[this.selector].push([t,n?!0:!1]),an.add(sn,e,n?W:z,n)}else an.add(this,e,t,n);return this},off:function(e,t,n){var r,i=-1;if(n=n?!0:!1,"wheel"===e&&(e=Kt),-1!==Qt.indexOf(e))r=this._iEvents[e],r&&-1!==(i=r.indexOf(t))&&this._iEvents[e].splice(i,1);else if(this.selector){var s=Ct[e];if(s&&(r=s[this.selector])){for(i=0;i<r.length&&r[i][1]!==n;i++);i<r.length&&r.splice(i,1)}}else an.remove(this._element,t,n);return this},set:function(e){return e&&"object"==typeof e||(e={}),this.options=new $(e),this.draggable("draggable"in e?e.draggable:this.options.draggable),this.dropzone("dropzone"in e?e.dropzone:this.options.dropzone),this.resizable("resizable"in e?e.resizable:this.options.resizable),this.gesturable("gesturable"in e?e.gesturable:this.options.gesturable),"autoScroll"in e&&this.autoScroll(e.autoScroll),this},unset:function(){return an.remove(this,"all"),"string"==typeof this.selector?delete xt[this.selector]:(an.remove(this,"all"),this.options.styleCursor&&(this._element.style.cursor=""),this._gesture&&(this._gesture.target=null),St.splice(St.indexOf(this.element()))),this.dropzone(!1),wt.splice(wt.indexOf(this),1),V}},J.prototype.gestureable=J.prototype.gesturable,J.prototype.resizeable=J.prototype.resizable,V.isSet=function(e){return-1!==wt.indexOfElement(e)},V.on=function(e,t,n){return-1!==Qt.indexOf(e)?Gt[e]?-1===Gt[e].indexOf(t)&&Gt[e].push(t):Gt[e]=[t]:an.add(sn,e,t,n),V},V.off=function(e,t,n){if(-1===Qt.indexOf(e))an.remove(sn,e,t,n);else{var r;e in Gt&&-1!==(r=Gt[e].indexOf(t))&&Gt[e].splice(r,1)}return V},V.simulate=function(e,n,r){var i,s,o={};if("resize"===e&&(e="resizexy"),e in Vt){if(r)for(i in r)r.hasOwnProperty(i)&&(o[i]=r[i]);else s=Lt._element instanceof Y?n.getBoundingClientRect():s=n.getClientRects()[0],"drag"===e?(o.pageX=s.left+s.width/2,o.pageY=s.top+s.height/2):(o.pageX=s.right,o.pageY=s.bottom);return o.target=o.currentTarget=n,o.preventDefault=o.stopPropagation=t,L(o,e),V}return V},V.enableDragging=function(e){return null!==e&&void 0!==e?($t.drag=e,V):$t.drag},V.enableResizing=function(e){return null!==e&&void 0!==e?($t.resize=e,V):$t.resize},V.enableGesturing=function(e){return null!==e&&void 0!==e?($t.gesture=e,V):$t.gesture},V.eventTypes=Qt,V.debug=function(){return{target:Lt,dragging:Ut,resizing:Wt,gesturing:Rt,prepared:Jt,prevCoords:ot,downCoords:at,pointerIds:lt,pointerMoves:ct,addPointer:_,removePointer:D,recordPointers:P,inertia:yt,downTime:ht,downEvent:pt,prevEvent:dt,Interactable:J,IOptions:$,interactables:wt,dropzones:Et,pointerIsDown:It,defaultOptions:Dt,actions:Vt,dragMove:H,resizeMove:B,gestureMove:j,pointerUp:U,pointerDown:L,pointerMove:M,pointerHover:R,events:an,globalEvents:Gt,delegatedEvents:Ct}},V.getTouchAverage=c,V.getTouchBBox=h,V.getTouchDistance=p,V.getTouchAngle=d,V.getElementRect=f,V.margin=function(e){return"number"==typeof e?(Ft=e,V):Ft},V.styleCursor=function(e){return"boolean"==typeof e?(Dt.styleCursor=e,V):Dt.styleCursor},V.autoScroll=function(t){var r=Dt.autoScroll;return t instanceof Object?(Dt.autoScrollEnabled=!0,"number"==typeof t.margin&&(r.margin=t.margin),"number"==typeof t.speed&&(r.speed=t.speed),r.container=n(t.container)||t.container instanceof e.Window?t.container:r.container,V):"boolean"==typeof t?(Dt.autoScrollEnabled=t,V):Dt.autoScrollEnabled?r:!1},V.snap=function(e){var t=Dt.snap;return e instanceof Object?(Dt.snapEnabled=!0,"string"==typeof e.mode&&(t.mode=e.mode),"boolean"==typeof e.endOnly&&(t.endOnly=e.endOnly),"number"==typeof e.range&&(t.range=e.range),e.actions instanceof Array&&(t.actions=e.actions),e.anchors instanceof Array&&(t.anchors=e.anchors),e.grid instanceof Object&&(t.grid=e.grid),e.gridOffset instanceof Object&&(t.gridOffset=e.gridOffset),V):"boolean"==typeof e?(Dt.snapEnabled=e,V):{enabled:Dt.snapEnabled,mode:t.mode,actions:t.actions,grid:t.grid,gridOffset:t.gridOffset,anchors:t.anchors,paths:t.paths,range:t.range,locked:Pt.locked,x:Pt.x,y:Pt.y,realX:Pt.realX,realY:Pt.realY,dx:Pt.dx,dy:Pt.dy}},V.inertia=function(e){var t=Dt.inertia;return e instanceof Object?(Dt.inertiaEnabled=!0,"number"==typeof e.resistance&&(t.resistance=e.resistance),"number"==typeof e.minSpeed&&(t.minSpeed=e.minSpeed),"number"==typeof e.endSpeed&&(t.endSpeed=e.endSpeed),"boolean"==typeof e.zeroResumeDelta&&(t.zeroResumeDelta=e.zeroResumeDelta),e.actions instanceof Array&&(t.actions=e.actions),V):"boolean"==typeof e?(Dt.inertiaEnabled=e,V):{enabled:Dt.inertiaEnabled,resistance:t.resistance,minSpeed:t.minSpeed,endSpeed:t.endSpeed,actions:t.actions,zeroResumeDelta:t.zeroResumeDelta}},V.supportsTouch=function(){return jt},V.currentAction=function(){return Ut&&"drag"||Wt&&"resize"||Rt&&"gesture"||null},V.stop=function(e){if(Ut||Wt||Rt){Bt.stop(),Nt=[],Lt.options.styleCursor&&(Q.documentElement.style.cursor=""),Lt._gesture&&Lt._gesture.stop(),X();for(var t=0;t<Tt.length;t++)Tt._elements=[];e&&"function"==typeof e.preventDefault&&e.preventDefault()}return lt&&lt.length&&(lt.splice(0),ct.splice(0)),It=Pt.locked=Ut=Wt=Rt=!1,Jt=dt=null,V},V.dynamicDrop=function(e){return"boolean"==typeof e?(Ut&&zt!==e&&!e&&m(Et),zt=e,V):zt},V.deltaSource=function(e){return"page"===e||"client"===e?(Dt.deltaSource=e,this):Dt.deltaSource},V.restrict=function(e){var t=Dt.restrict;return void 0===e?Dt.restrict:(e instanceof Object?((e.drag instanceof Object||/^parent$|^self$/.test(e.drag))&&(t.drag=e.drag),(e.resize instanceof Object||/^parent$|^self$/.test(e.resize))&&(t.resize=e.resize),(e.gesture instanceof Object||/^parent$|^self$/.test(e.gesture))&&(t.gesture=e.gesture),"boolean"==typeof e.endOnly&&(t.endOnly=e.endOnly)):null===e&&(t.drag=t.resize=t.gesture=null,t.endOnly=!1),this)},rt?(an.add(sn,"pointerup",N),an.add(sn,"pointerdown",k),an.add(sn,"MSGestureChange",M),an.add(sn,"MSGestureEnd",U),an.add(sn,"MSInertiaStart",U),an.add(sn,"pointerover",I),an.add(sn,"pointerout",q),an.add(sn,"pointermove",P),an.add(sn,"pointerup",P),an.add(sn,"pointercancel",P),an.add(sn,"pointerup",function(){Ut||Wt||Rt||(It=!1)}),kt=new nt,kt.target=Q.documentElement):(an.add(sn,"mouseup",N),an.add(sn,"touchend",N),an.add(sn,"mousedown",k),an.add(sn,"mousemove",M),an.add(sn,"mouseup",U),an.add(sn,"mouseover",I),an.add(sn,"mouseout",q),an.add(sn,"touchstart",k),an.add(sn,"touchmove",M),an.add(sn,"touchend",U),an.add(sn,"touchcancel",U)),an.add(rn,"blur",U);try{e.frameElement&&(un._element=e.frameElement.ownerDocument,an.add(un,"mouseup",U),an.add(un,"touchend",U),an.add(un,"touchcancel",U),an.add(un,"pointerup",U),an.add(on,"blur",U))}catch(fn){V.windowParentError=fn}an.add(sn,"selectstart",function(e){(Ut||Wt||Rt)&&e.preventDefault()}),en in Element.prototype&&"function"==typeof Element.prototype[en]||(Element.prototype[en]=K=function(e,t){t=t||this.parentNode.querySelectorAll(e);for(var n=t.length,r=0;n>r;r++)if(t[r]===this)return!0;return!1}),function(){for(var t=0,n=["ms","moz","webkit","o"],r=0;r<n.length&&!e.requestAnimationFrame;++r)tn=e[n[r]+"RequestAnimationFrame"],nn=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];tn||(tn=function(n){var r=(new Date).getTime(),i=Math.max(0,16-(r-t)),s=e.setTimeout(function(){n(r+i)},i);return t=r+i,s}),nn||(nn=function(e){clearTimeout(e)})}(),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=V),exports.interact=V):e.interact=V}(this),define("interact",["underscore"],function(e){return function(){var t,n;return t||e.interact}}(this));var tilesProcessor,up=1,down=2,left=3,right=4;define("tilesprocessor",function(){}),define("entities/element/element_model",["jquery","underscore","backbone","app"],function(e,t,n,r){function o(){var e=(new Date).getTime(),t="xxxxxxxxxxxx4xxxyxxxxxxx".replace(/[xy]/g,function(t){var n=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(t=="x"?n:n&7|8).toString(16)});return t}var i=n.Model.extend({idAttribute:"_id",url:function(){return t.result(this.collection,"url")+(this.isNew()?"":this.get("cid")+"/")},defaults:{_id:"",index:"",answer:"a",textAnswer:"",color:"dullBlue",gotAnswer:"false",questionText:"",resourceUrl:"about:blank",isImage:!1,answerTextA:"",answerTextB:"",answerTextC:"",answerTextD:"",thumbnail:"about:blank",responseType:"mul"},setSelected:function(){this.collection.selectElement(this)}}),s={getElementEntity:function(t){var n=new i({id:t}),r=e.Deferred();return n.fetch({success:function(e){r.resolve(e)},error:function(e){r.resolve(undefined)}}),r.promise()}};return r.reqres.setHandler("element:entity",function(e){return s.getElementEntity(e)}),r.reqres.setHandler("element:entity:new",function(e){var t=new i;return t.set("_id",o()),t}),i}),define("entities/element/element_collection",["jquery","underscore","backbone","app","entities/element/element_model"],function(e,t,n,r,i){function u(){var t=e.Deferred();return require(["entities/activity/activity_collection"],function(){var e=r.request("activity:entities:initialized");t.resolve(e)}),t.promise()}var s=n.Collection.extend({model:i,initialize:function(e){this.comparator="index"},resetIndex:function(){t.each(this.models,function(e){e.set("index",this.indexOf(e)+1)},this)},selectElement:function(e){t.each(this.models,function(e){e.set("selected",!1)},this),e.set("selected",!0)}}),o=function(t){e.when(u()).done(function(e){var n=e.get(t),r=n.get("elements");return new s(r)})},a=function(){var e=[{resourceUrl:"https://docs.google.com/document/d/1HeNsERfR37ulbmshKaxvhWzkZFvoMIv5vB02YikswuQ/preview",gotAnswer:"true",questionText:"Test Question 1",answer:"a",color:"dullBlue",answerTextA:"Question 1 Text for Answer A",answerTextB:"Question 1 Text for Answer B",answerTextC:"Question 1 Text for Answer C",answerTextD:"Question 1 Text for Answer D"},{resourceUrl:"https://docs.google.com/document/d/1HeNsERfR37ulbmshKaxvhWzkZFvoMIv5vB02YikswuQ/preview",gotAnswer:"true",questionText:"Test Question 2",answer:"b",color:"dullBlue",answerTextA:"Question 2 Text for Answer A",answerTextB:"Question 2 Text for Answer B",answerTextC:"Question 2 Text for Answer C",answerTextD:"Question 2 Text for Answer D"},{resourceUrl:"https://docs.google.com/document/d/1HeNsERfR37ulbmshKaxvhWzkZFvoMIv5vB02YikswuQ/preview",gotAnswer:"true",questionText:"Test Question 3",answer:"c",color:"dullBlue",answerTextA:"Question 3 Text for Answer A",answerTextB:"Question 3 Text for Answer B",answerTextC:"Question 3 Text for Answer C",answerTextD:"Question 3 Text for Answer D"},{resourceUrl:"https://docs.google.com/document/d/1HeNsERfR37ulbmshKaxvhWzkZFvoMIv5vB02YikswuQ/preview",gotAnswer:"true",questionText:"Test Question 4",answer:"d",color:"dullBlue",answerTextA:"Question 4 Text for Answer A",answerTextB:"Question 4 Text for Answer B",answerTextC:"Question 4 Text for Answer C",answerTextD:"Question 4 Text for Answer D"},{resourceUrl:"https://docs.google.com/document/d/1HeNsERfR37ulbmshKaxvhWzkZFvoMIv5vB02YikswuQ/preview",gotAnswer:"false",questionText:"Test Question 5",answer:"",color:"dullBlue"}],t=JSON.parse(JSON.stringify(e));return new s(t)},f=function(){var e=new i({gotAnswer:"false",questionText:"Test Question 1"}),t=new i({gotAnswer:"false",questionText:"Test Question 2"}),n=new i({gotAnswer:"false",questionText:"Test Question 3"});return new s([e,t,n])};return API={getElementEntities:function(e){},getElementEntititesFromHTML:function(e){return o(e)}},r.reqres.setHandler("element:entities",function(){return API.getElementEntities()}),r.reqres.setHandler("element:entities:initialize",function(e){return API.getElementEntititesFromHTML(e)}),r.reqres.setHandler("element:entities:new",function(e,t){return new s(e,t)}),s}),define("entities/activity/activity_model",["jquery","underscore","backbone","app","entities/element/element_collection"],function(e,t,n,r,i){function s(){var t=JSON.parse(e("#data-results").html()),n=t._id;return n}Activity=n.Model.extend({idAttribute:"_id",url:function(){return"/adventures/edit/"+s()+"/activities/"+(this.isNew()?"":this.id+"/")},model:{elements:i},parse:function(e){this.set("_id",e._id);for(var t in this.model){var n=this.model[t],r=e[t];e[t]=new n(r)}return e},defaults:{thumbnail:"about:blank",activityTitle:"Edit Title",activityType:"",colorTag:"dullPink",selected:!1,index:"",elements:"",tileType:"checkpoint",x:"0",y:"0",active:!0,first:!1,icon:"fa-university",wordLists:[],pluginApp:"",pluginAppIcon:"",checkPointIcon:""},initialize:function(e){if(e&&!(e.elements instanceof n.Collection)){var t=this.model.elements,r=e.elements;e.elements=new t(r),this.set("elements",e.elements),this.set("activityName","test")}},toggleSelected:function(){this.set({selected:!this.get("selected")})},clear:function(){console.log("destroy"),this.destroy()}});var o={getActivityEntity:function(t){var n=new Activity({_id:t}),r=e.Deferred();return n.fetch({success:function(e){r.resolve(e),console.log("success")},error:function(e){r.resolve(undefined),console.log("fail")}}),r.promise()}};return r.reqres.setHandler("activity:entity",function(e){return o.getActivityEntity(e)}),r.reqres.setHandler("activity:entity:new",function(e){return new Activity}),Activity}),define("entities/activity/activity_collection",["jquery","underscore","backbone","app","entities/activity/activity_model"],function(e,t,n,r,i){function f(e){t.each(e.models,function(e){var n=e.collection.indexOf(e)+1;e.set("index",n);var r=e.get("elements");if(r.length!==0){var i=e.get("elements");t.each(i.models,function(e){var t=e.collection.indexOf(e)+1;e.set("index",t);if(e.get("_id")===""){var n=l();e.set("_id",n)}})}},this)}function l(){var e=(new Date).getTime(),t="xxxxxxxxxxxx4xxxyxxxxxxx".replace(/[xy]/g,function(t){var n=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(t=="x"?n:n&7|8).toString(16)});return t}ActivityCollection=n.Collection.extend({model:i,url:function(){return"/adventures/edit/"+this.idLesson+"/activities/"},parse:function(e){return e.activities},initialize:function(e,t){this.idLesson=t},selected:function(){return this.filter(function(e){return e.get("selected")})},remaining:function(){return this.without.apply(this,this.selected())}});var s=JSON.parse(e("#data-results").html()),o=s._id,u=function(){var e=new ActivityCollection(s.activities,o);return f(e),e},a={getActivityEntities:function(t){var n={},r=new ActivityCollection(n,o),i=e.Deferred();return r.fetch({success:function(e){e.length!==0&&f(e),i.resolve(e)}}),i.promise()},getActivityEntitiesFromHTML:function(){var e=u();return f(e),e}};return r.reqres.setHandler("activity:entities",function(){return a.getActivityEntities()}),r.reqres.setHandler("activity:entities:initialized",function(){return a.getActivityEntitiesFromHTML()}),ActivityCollection}),define("entities/tile/tile_model",["jquery","underscore","backbone","app"],function(e,t,n,r){return Tile=n.Model.extend({idAttribute:"_id",parse:function(e){return this.set("_id",e._id),e},defaults:{x:"",y:"",a:!1},clear:function(){console.log("destroy"),this.destroy()}}),r.reqres.setHandler("tile:entity:new",function(e){return new Tile}),Tile}),define("entities/tile/tile_collection",["jquery","underscore","backbone","app","entities/tile/tile_model"],function(e,t,n,r,i){function a(){var e=new TileCollection;e.idLesson=o;var t=5,n=5,r=1,i=0,s=t*4+(t-1)*5;for(var u=0;u<s;u++)i%2===1?r>0?r%8===0?(f(r,i,"linkver",e),r=1,i+=1):(f(r,i,"linkver",e),r+=2):(console.log("Tiles-> x:"+r+" y: "+i),f(r,i,"linkver",e),r+=2):i%2===0&&(r%7===0?(f(r,i,"linkhor",e),r=0,i+=1):(f(r,i,"linkhor",e),r+=2));var a=5,l=5,c=0,h=0,p=a*l;for(var u=0;u<p;u++)c===0?(f(c,h,"dropzone",e),c+=2):c%8===0?(f(c,h,"dropzone",e),c=0,h+=2):(f(c,h,"dropzone",e),c+=2);return console.log(e),e}function f(e,t,n,r){var s="link",o=n;n==="dropzone"&&(s="dropzone",o="dropzone");var u=new i({tileTitle:s,x:e,y:t,tileType:o,activated:!1});r.add(u)}TileCollection=n.Collection.extend({model:i,url:function(){return"/adventures/edit/"+this.idLesson},parse:function(e){var n=a();return t.each(s.tiles,function(e){var r=n.where({x:e.x,y:e.y});t.each(r,function(e){e.set({a:!0})}),console.log("same_spot_tiles %O",r)}),n},initialize:function(e,t){this.idLesson=t}});var s=JSON.parse(e("#data-results").html()),o=s._id,u=function(){if(s.tiles===null||typeof s.tiles=="undefined")var e=a();else{var e=a();t.each(s.tiles,function(n){var r=e.where({x:n.x,y:n.y});t.each(r,function(e){e.set({a:!0})})})}return e},l={getTileEntities:function(t){var n={},r=new TileCollection(n,o),i=e.Deferred();return r.fetch({success:function(e){i.resolve(e)}}),i.promise()},getTileEntitiesFromHTML:function(){var e=u();return e}};return r.reqres.setHandler("tile:entities",function(){return l.getTileEntities()}),r.reqres.setHandler("tile:entities:initialized",function(){return l.getTileEntitiesFromHTML()}),TileCollection}),define("entities/lesson/lesson_model",["jquery","underscore","backbone","app","entities/tile/tile_collection"],function(e,t,n,r,i){Lesson=n.Model.extend({idAttribute:"_id",url:function(){return"/adventures/edit/"+o},model:{tiles:i},parse:function(e){this.set("_id",e._id),console.log("this model %O",e);for(var t in this.model){var n=this.model[t],r=e[t];e[t]=new n(r)}return e},defaults:{lessonName:"",tiles:"",backgroundImageURL:"",backgroundThumbnailURL:"",backgroundImageJSON:""},initialize:function(e){if(e&&!(e.tiles instanceof n.Collection)){var t=this.model.tiles,r=e.tiles;e.tiles=new t(r),this.set("tiles",e.tiles),this.set("lessonName","")}},toggleSelected:function(){this.set({selected:!this.get("selected")})},clear:function(){console.log("destroy"),this.destroy()}});var s=JSON.parse(e("#data-results").html()),o=s._id,u=function(){var e=r.request("tile:entities:initialized");return e},a={getLessonEntity:function(t){var n=new Lesson({_id:t}),r=e.Deferred();return n.fetch({success:function(e){r.resolve(e),console.log("success")},error:function(e){r.resolve(undefined),console.log("fail")}}),r.promise()},getLessonEntityInitialized:function(){var e=new Lesson({_id:o});return e.set("lessonName",s.lessonName),e.set("backgroundImageJSON",s.backgroundImageJSON),e.set("backgroundImageURL",s.backgroundImageURL),e.set("backgroundThumbnailURL",s.backgroundThumbnailURL),e.set("tiles",u()),e}};return r.reqres.setHandler("lesson:entity",function(e){return a.getLessonEntity(e)}),r.reqres.setHandler("lesson:entity:initialized",function(){return a.getLessonEntityInitialized()}),r.reqres.setHandler("lesson:entity:new",function(e){return new Lesson}),Lesson}),define("apps/activities/listActivities/listActivities_controller",["app","apps/activities/listActivities/listActivities_view","interact","bootbox","chardinJs","tilesprocessor","bootstrap"],function(e,t,n,r,i){return e.module("ActivitiesApp.ListActivities",function(e,i,s,o,u,a){function h(e,s){a.each(e.models,function(e){e.get("activityType")===""&&e.get("wordLists").length===0&&(e.set("activityType","media"),e.save())}),a.each(e.models,function(e){typeof e.get("elements")!="undefined"&&a.each(e.get("elements").models,function(e){if(e.get("isImage")){var t=e.get("resourceUrl");window.imgPreloader.push(t)}})}),l.setHandler("activities",function(){return e});var o=new t.ActivitiesLayout;o.on("show",function(){console.log("render map and wordlists editor"),i.trigger("wordLists:list",o.wordListsRegion),require(["entities/lesson/lesson_model"],function(){var s=i.request("lesson:entity:initialized");u.when(s).done(function(s){function p(t){function i(e){var t=!1;a.each(e,function(e){t===!1?(t=!0,g(e)):m(e)})}initTilesProcessor(h,e,!1);var n=t;if(n){var r=t.get("_id");a.each(tilesProcessor.groups,function(e){var n=a.indexOf(e,t.get("_id"));if(n>-1){if(e.length===1){alert("cannot mark single element as first");return}a.each(e,function(t){r===t?v(e[n]):d(t)})}})}}function d(t){var n=e.get({id:t}),r=!1;n.get("first")===!0&&(r=!0),n.get("active")===!0&&(r=!0),r&&(n.set({first:!1,active:!1}),console.log("#####Save Non active Non First: "+n.get("activityTitle")),N(n))}function v(t){var n=e.get({id:t}),r=!1;n.get("first")===!1&&(r=!0),n.get("first")===!1&&(r=!0),r&&(n.set({first:!0,active:!0}),N(n),console.log("#####Save Active First: "+n.get("activityTitle")))}function m(t){var n=e.get({id:t}),r=!1;n.get("active")===!0&&(r=!0),r&&(n.set({active:!1}),console.log("#####Save non-active: "+n.get("activityTitle")),N(n))}function g(t){var n=e.get({id:t}),r=!1;n.get("first")===!1&&(r=!0),r&&(n.set({active:!0}),N(n),console.log("#####Save Active: "+n.get("activityTitle")))}function y(){initTilesProcessor(h,e,!1),a.each(tilesProcessor.groups,function(t){var n="";if(t.length===1){var r=e.get({id:t[0]}),i=!1;r.get("first")===!0&&(r.set({first:!1}),console.log("group with 1 activity, set first to false: "+r.get("activityTitle")),i=!0),r.get("active")===!1&&(r.set({active:!0}),i=!0,console.log("group with 1 activity, set it to active: "+r.get("activityTitle"))),i===!0&&N(r)}else if(t.length>1){var s="";a.each(t,function(t){var r=e.get({id:t});r.get("first")&&(n=r,s=t)});if(n)console.log("activity_with_first",n.get("activityTitle")),a.each(t,function(t){var n=e.get({id:t});s!==t?d(t):n.get("active")===!1&&(g(t),console.log("setting the last element with first to active :"+n.get("activityTitle")))});else if(n===""){var o=t[0],r=e.get({id:o});console.log("No first element, set the first element to be active and first :"+r.get("activityTitle")),a.each(t,function(t){r=e.get({id:t}),t!==o?m(t):v(t)})}}})}function b(n){var r=new t.ActivityTiles({collection:n});u("#adventure-view canvas").after(u(r.render().el)),u(".activity-wrapper-dropzone").unwrap(),initTilesProcessor(n,e,!1);var i=u(".activity-coordinate");a.each(i,function(e){var t=u(e).data(),n=t.x,r=t.y;u(e).parent().parent().css({left:n*l,top:r*c})}),r.on("childview:tile:toggle",function(e){var t=u(e.el).find(".js-toggle-tile");t.hasClass("tile-non-active")?(console.log("set tile active"),e.model.set("a",!0)):t.hasClass("tile-active")&&(console.log("set tile non active"),e.model.set("a",!1)),y(),C()}),r.on("childview:tile:toggle:ver",function(e){console.log("toggle tiles");var t=u(e.el).find(".vertical-line");t.toggleClass("tile-non-active"),t.hasClass("tile-non-active")?e.model.set("a",!1):e.model.set("a",!0);var n=s.get("tiles");console.log("toggle lesson tiles %O",n),y(),C()})}function T(){var e=u(x.el).find(".activity-coordinate").data();if(x.model.get("x")!==e.x||x.model.get("y")!==e.y)x.model.set("x",e.x),x.model.set("y",e.y),x.model.save(),console.log("###save coordinates");y()}function N(e){var t=e.clone();t.save({},{success:function(e){t.trigger("destroy",t,t.collection)},error:function(e){}})}function C(){var e=s.clone(),t=s.get("tiles").clone(),n=t.where({a:!1});t.remove(n,{silent:!0}),a.each(t.models,function(e){e.unset("tileType",{silent:!0}),e.unset("tileTitle",{silent:!0}),e.unset("activated",{silent:!0})}),e.set({tiles:t}),e.save({},{success:function(t){var n=s.get("tiles");a.each(n.models,function(e){e.get("x")%2===0?e.set("tileType","linkver"):e.set("tileType","linkhor")}),e.trigger("destroy",e,e.collection)},error:function(e){}})}var f=new t.Activities({collection:e,model:s});i.reqres.setHandler("activities:view",function(){return f}),o.adventureMapRegion.show(f),f.on("backgroundImage:update",function(e,t){console.log("update activity map");var n=e.model,r={image:"thisImage",url:"this is the url"};n.set({backgroundImageURL:t.backgroundImageURL,backgroundThumbnailURL:t.backgroundThumbnailURL,backgroundImageJSON:t.backgroundImageJSON,silent:!0});var i=n.clone();i.unset("tiles","silent:true"),i.save({},{success:function(e){i.trigger("destroy",i,i.collection)},error:function(e){}})}),f.on("childview:activity:setCoordinates",function(e){x=e}),f.on("lesson:rename",function(e){var t='<form class="bootbox - form"><input class="bootbox-input bootbox-input-text form-control" autocomplete="off" type="text"></form>';r.prompt({title:"Rename Adventure Title",value:e.model.get("lessonName"),callback:function(e){var e=u.trim(e);if(e===null||e.length===0)return;s.set("lessonName",e);var t=s.get("tiles").clone();s.save({lessonName:s.get("lessonName")},{patch:!0,wait:!0,success:function(){s.set("tiles",t),console.log("success %O",s)}})}})}),f.on("editor:show:guide",function(){u(".wordList-editor-area").css("z-index","auto"),u("body").one("chardinJs:stop",function(){u(".wordList-editor-area").css("z-index","")}),u("body").chardinJs("start")}),f.on("editor:live:demo",function(){console.log("live demo")}),f.on("activity:tiles",function(e){b(e.model.get("tiles"))}),f.on("childview:activity:color",function(e){var t=e.model;u(e.e.currentTarget).hasClass("blue")?t.set("checkPointIcon","markerBlue"):u(e.e.currentTarget).hasClass("brown")?t.set("checkPointIcon","markerBrown"):u(e.e.currentTarget).hasClass("green")?t.set("checkPointIcon","markerGreen"):u(e.e.currentTarget).hasClass("pink")?t.set("checkPointIcon","markerPink"):u(e.e.currentTarget).hasClass("red")?t.set("checkPointIcon","markerRed"):u(e.e.currentTarget).hasClass("yellow")&&t.set("checkPointIcon","markerYellow"),N(t)}),f.on("childview:activity:delete",function(t,n){r.confirm("Do you want to delete the activity?",function(t){console.log(t);if(!t)return;n.destroy(),a.each(e.models,function(t){t.set("index",e.indexOf(t)+1)}),console.log("delete activity")})}),f.on("childview:activity:edit",function(e){var t=e.model,n=e.model.get("activityType");switch(n){case"wordList":console.log("Clicked edit activity app -> %O",e),i.trigger("plugins:configureWord",e);break;case"media":console.log("Clicked edit activity media ->"),i.trigger("activity:show:first",e.model)}}),f.on("childview:activity:first",function(e){console.log("Clicked First activity "),p(e.model)}),f.on("childview:activity:activate",function(e){console.log("Clicked activate activity"),e.model.get("active")===!0?e.model.set({active:!1}):e.model.get("active")===!1&&e.model.set({active:!0})}),f.on("activity:new",function(){i.trigger("activityTypes:show")}),f.on("childview:activity:rename",function(e){r.prompt({title:"Rename Activity Title",value:e.model.get("activityTitle"),callback:function(t){var t=u.trim(t);if(t===null||t.length===0)return;e.model.set("activityTitle",t),e.model.save({activityTitle:e.model.get("activityTitle")},{wait:!0,success:function(){console.log("success %O",e.model)}})}})});var l=72,c=60;b(s.get("tiles"));var h=s.get("tiles");u(".activity-dropzone").parent().removeClass("drag-drop");var w=!1,E,S,x;n(".drag-drop").draggable({onmove:function(e){var t=e.target;t.x=(t.x|0)+e.dx,t.y=(t.y|0)+e.dy,t.style.webkitTransform=t.style.msTransform=t.style.transform="translate("+t.x+"px, "+t.y+"px)",E=new Date},onend:function(e){S=new Date;var t=e.target,n=u(e.target);w?(e.target.classList.remove("checkpoint-dropped"),u(e.target).css({"webkit-transform":"translate(0px,0px)",transform:"translate(0px,0px)","-ms-transform":"translate(0px,0px)"}),t.x=0,t.y=0):(t.style.webkitTransform=t.style.transform="translate(0px, 0px)",u(e.target).css({"webkit-transform":"translate(0px,0px)",transform:"translate(0px,0px)","-ms-transform":"translate(0px,0px)"}),t.x=0,t.y=0)}}).restrict({drag:"parent",endOnly:!0}),n(".dropzone").dropzone({accept:".activity-wrapper",overlap:"center",ondragenter:function(e){var t=e.relatedTarget,n=e.target;w=!0,n.classList.add("checkpoint-dropped"),t.classList.add("can-drop"),t.background="Dragged in"},ondragleave:function(e){w=!1,e.target.classList.remove("checkpoint-dropped"),e.relatedTarget.classList.remove("can-drop")},ondrop:function(t){w=!0;var n=t.target,r=t.relatedTarget,i=u(r).find(".activity-coordinate").data(),s=i.x,o=i.y;n.classList.remove("checkpoint-dropped");var f=u(n).find(".activity-coordinate").data();u(r).find(".activity-coordinate").data({x:f.x,y:f.y});var l=u(r).find(".activity-coordinate").data();a.each(e.models,function(e){f.x===e.get("x")&&f.y===e.get("y")&&(console.log("space occupied"),x.model.get("_id")!==e.get("_id")&&(e.set({x:s,y:o}),console.log("#save for swap"),N(e)))}),T()}})}),console.log(e)})}),i.mainRegion.show(o)}var f=25,l=new s.Wreqr.RequestResponse,c=new s.Wreqr.RequestResponse;e.Controller={listActivities:function(e){e===undefined||e===null||e.activityIDToBeAnimated?require(["entities/activity/activity_collection"],function(){var t=i.request("activity:entities");u.when(t).done(function(t){e!==null&&e.activityIDToBeAnimated!==null&&t.get(e.activityIDToBeAnimated).set("animate",!0),h(t)})}):e.initialized?(console.log("options.initialized"),require(["entities/activity/activity_collection"],function(){var e=i.request("activity:entities:initialized");h(e)})):e.activities&&h(e.activities)},moveActivities:function(){u(".js-edit-state").toggleClass("js-edit"),u(".js-rename-state").toggleClass("js-rename"),n(".drag-drop").draggable({onmove:function(e){var t=e.target;t.x=(t.x|0)+e.dx,t.y=(t.y|0)+e.dy,t.style.webkitTransform=t.style.transform="translate("+t.x+"px, "+t.y+"px)"}}).inertia(!1).restrict({drag:"parent",endOnly:!1})},moveStopActivities:function(){u(".js-edit-state").toggleClass("js-edit"),u(".js-rename-state").toggleClass("js-rename"),console.log("stop"),n(".drag-drop").draggable(!1)},addActivity:function(e){var t=e.model.get("type"),n=l.request("activities"),s=l.request("activities:view");if(n.length<25){var o=i.request("activity:entity:new");o.set("index",n.length+1),o.set("activityType",t),require(["entities/element/element_collection"],function(){var e=i.request("element:entities:new");require(["entities/element/element_model"],function(){var r=i.request("element:entity:new"),s=e.length+1;r.set("index",s),e.add(r),console.log("elements after add %O",e),o.set("elements",e);switch(t){case"wordList":o.set("icon","fa-file-o");break;case"media":o.set("icon","fa-file-image-o")}console.log("#####activityType: "+t);var u=9,f=9,l=5,c=5,h=new Array(l);for(var p=0;p<u;p+=2)h[p]=new Array(c);a.each(n.models,function(e){h[e.get("x")][e.get("y")]=e.get("_id")});for(var p=0;p<u;p+=2)for(var d=0;d<f;d+=2);e:for(var p=0;p<u;p+=2)for(var d=0;d<f;d+=2){if(!h[p][d]){o.set({x:p,y:d});break e}console.log("occupied:"+p+", "+d)}n.create(o,{success:function(){var e=i.request("activities:view").children.findByModel(o);e&&(e.$el.addClass("animated bounce"),e.$el.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){e.$el.removeClass("animated bounce")}))}})})})}else r.alert("Maximum number of activities reached,                        please delete one of them before adding!",function(){})}}}),e.ActivitiesApp.ListActivities.Controller}),define("text!apps/header/list/templates/header_template.html",[],function(){return'<a href="#" class="btn-activity js-back"><i class="fa fa-arrow-left fa-2x btn-activity-back"></i></a>\r\n<div class="adventure-title-wrapper camp-adventure-font text-center"><span class="edit-adventure-title">Edit Adventure</span></div>\r\n<div class="btn-group preview-actions" data-intro="Preview this Adventure in Test Classroom">\r\n  <a href="/classroom/preview/<%= document.lessonID %>/teststudents/1_2" target="preview" class="btn btn-success" title="Preview Adventure"><i class=\'fa fa-play\'></i> Preview Adventure</a>        \r\n  <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">\r\n    <span class="caret"></span>\r\n    <span class="sr-only">Toggle Dropdown</span>\r\n  </button>\r\n  <ul class="dropdown-menu " role="menu">\r\n    <li><a href="/classroom/preview/<%= document.lessonID %>/teststudents/0" target="preview" class="">Preview as Teacher </a></li>\r\n    <li><a href="/classroom/preview/<%= document.lessonID %>/teststudents/1" target="preview" class="">Preview as Student</a></li>    \r\n    <li><a href="/classroom/preview/<%= document.lessonID %>/teststudents/1_2" target="preview" class="">With 1 Mock Student</a></li>  \r\n    <li><a href="/classroom/preview/<%= document.lessonID %>/teststudents/2" target="preview" class="">With 2 Mock Students</a></li>    \r\n    <!--<li><a href="/classroom/preview/<%= document.lessonID %>/teststudents/4" target="preview"  class="">Preview with 4 test students</a></li>-->    \r\n  </ul>\r\n</div>\r\n<!--<p style=\'display:inline-block\'>test</p>-->\r\n<!--<div class="container-fluid ">\r\n   Brand and toggle get grouped for better mobile display \r\n  <div class="navbar-header">\r\n    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#engage-navbar">\r\n      <span class="sr-only">Toggle navigation</span>\r\n      <span class="icon-bar"></span>\r\n      <span class="icon-bar"></span>\r\n      <span class="icon-bar"></span>\r\n    </button>\r\n    <a class="navbar-brand" href="#"><i class="fa fa-backward"></i>Home</a>\r\n  </div>\r\n\r\n   Collect the nav links, forms, and other content for toggling \r\n  <div class="collapse navbar-collapse" id="engage-navbar">\r\n    <ul class="nav navbar-nav">\r\n      <li><a href="#" class="js-nav-activities js-guide-am-map">Adventure Map</a></li>\r\n      <li><a href="#" class="js-nav-list step1 js-guide-am-wordlist">Word Lists</a></li>      \r\n    </ul>\r\n\r\n    <ul class="nav navbar-nav navbar-right js-guide-assign" >\r\n      <li class="dropdown keep-open">\r\n        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Classrooms Assigned to this Adventure<b class="caret"></b></a>\r\n        <ul class="dropdown-menu">\r\n          <li>      \r\n            <ul class="list-group checked-list-box" style="width:250px;">              \r\n              <% _.each(classrooms, function(classroom) { %> \r\n              <li class="list-group-item" data-checked=\'<%= (lesson._id === classroom.lesson)? "true":"false" %>\' \r\n                  id="<%= classroom._id %>"><%= classroom.name %>\r\n                <a class="btn btn-sm btn-success pull-right edit" style="margin-top:-5px;position:absolute;right:5px" \r\n                   value=\'<%- classroom._id %>\' href=\'/<%- classroom.path %>\' onclick="event.stopPropagation();">\r\n                  Launch\r\n                </a>\r\n              </li>\r\n              <% }); %> \r\n            </ul>\r\n          </li>\r\n        </ul>\r\n      </li>\r\n    </ul>\r\n  </div> /.navbar-collapse \r\n</div> /.container-fluid -->\r\n\r\n'}),define("apps/header/list/headerList_view",["app","text!apps/header/list/templates/header_template.html"],function(e,t){return e.module("HeaderApp.List.View",function(e,n,r,i,s,o){e.Header=i.ItemView.extend({template:o.template(t),className:"activity-nav-bar",triggers:{"click .js-back":"adventure:back","click .js-preview-2students":"adventure:preview:2students","click .js-preview-4students":"adventure:preview:4students","click .js-preview-1student":"adventure:preview:1student","click .js-preview-1_2student":"adventure:preview:1_2student","click .js-preview-teacher":"adventure:preview:teacher","click .js-guide":"show:guide"},initialize:function(){},onShow:function(){}})}),e.HeaderApp.List.View}),define("apps/header/list/headerList_controller",["app","apps/header/list/headerList_view","bootbox"],function(e,t,n){return e.module("HeaderApp.List",function(e,n,r,i,s,o){e.Controller={listHeader:function(e){var i=e,o=JSON.parse(s("#data-results").html()),u=o.lessonName,a=o;document.lessonID=a._id;var f=JSON.parse(s("#data-classrooms").html()),l=f,c=new r.Model({lessonName:u,classrooms:l,lesson:a}),h=new t.Header({model:c});n.headerRegion.show(h),this.updateClassroomList(l),h.on("adventure:back",function(){location.href="/"}),h.on("adventure:preview:2students",function(){location.href="/classroom/preview/"+document.lessonID+"/teststudents/2"}),h.on("adventure:preview:1student",function(){location.href="/classroom/preview/"+document.lessonID+"/teststudents/1"}),h.on("adventure:preview:1_2student",function(){location.href="/classroom/preview/"+document.lessonID+"/teststudents/1_2"}),h.on("adventure:preview:teacher",function(){location.href="/classroom/preview/"+document.lessonID+"/teststudents/0"}),h.on("wordLists:list",function(e){n.trigger("wordLists:list")}),h.on("activities:list",function(e){n.trigger("activities:list")})},updateClassroomList:function(e){s(".list-group.checked-list-box .list-group-item").each(function(){function o(){var s=t.is(":checked");e.data("state",s?"on":"off"),e.find(".state-icon").removeClass().addClass("state-icon "+i[e.data("state")].icon),s?e.addClass(r+n+" active"):e.removeClass(r+n+" active")}function u(){e.data("checked")==1&&t.prop("checked",!t.is(":checked")),o(),e.find(".state-icon").length==0&&e.prepend('<span class="state-icon '+i[e.data("state")].icon+'"></span>')}var e=s(this),t=s('<input type="checkbox" class="hidden" />'),n=e.data("color")?e.data("color"):"primary",r=e.data("style")=="button"?"btn-":"list-group-item-",i={on:{icon:"glyphicon glyphicon-check"},off:{icon:"glyphicon glyphicon-unchecked"}};e.css("cursor","pointer"),e.append(t),e.on("click",function(){t.prop("checked",!t.is(":checked")),t.triggerHandler("change"),o();var e=t.is(":checked");console.log(this.id),console.log(e);var n="undefined";e&&(n=document.lessonID),s.ajax({url:"/classrooms/"+this.id+"/",type:"PUT",data:"idLesson="+n,success:function(e){console.log(e)}})}),t.on("change",function(){o()}),u()}),s("#get-checked-data").on("click",function(e){e.preventDefault();var t={},n=0;s("#check-list-box li.active").each(function(e,r){t[n]=s(r).text(),n++}),s("#display-json").html(JSON.stringify(t,null,"	"))})}}}),e.HeaderApp.List.Controller}),define("text!apps/activities/newActivity/templates/newActivity_item.html",[],function(){return'<!--<span class="fa fa-3x <%= icon %> activity-type-icon"></span>-->\n\n<div class="activity-type-desc">\n  <!--<h4> Description</h4>-->\n  <div><%= desc %></div>\n  <br>\n</div>\n<div class=\'activity-type-icon-wrapper\'>\n  <% if ( type === \'media\') { %>\n  <div class=\'media-type-desc text-center camp-adventure-font\'><span>Q</span></div>\n  <% } else if ( type === \'wordList\' ) { %>\n    <div class=\'media-type-desc text-center camp-adventure-font\'><span>W</span></div>\n  <% } %> \n  \n  <div class="activity-type-icon" style=\'background-image: url("<%= icon %>")\'></div>\n</div>\n\n<div class="activity-type-title">\n  <%= title %>\n</div>\n\n<div class="text-center btn-select">\n  <a class="btn btn-success js-activity-type">Add Activity</a>  \n</div>\n'}),define("text!apps/activities/newActivity/templates/newActivity_dialog.html",[],function(){return'<div class="modal-dialog">\r\n  <div class="modal-content">    \r\n    <div class="modal-header text-center">\r\n      <div class="activity-types-title">Add New Activity </div>\r\n      <button type="button" class="close js-close" data-dismiss="modal" aria-hidden="true"><span class="modal-close">&times;</span></button>\r\n    </div>    \r\n    <div class="modal-body">\r\n    </div>\r\n  </div>\r\n</div>\r\n'}),define("apps/activities/newActivity/newActivity_view",["app","text!apps/activities/newActivity/templates/newActivity_item.html","text!apps/activities/newActivity/templates/newActivity_dialog.html","bootstrap"],function(e,t,n){return e.module("ActivitiesApp.NewActivity.View",function(e,r,i,s,o,u){e.ActivityType=s.ItemView.extend({className:"activity-types-area ",template:u.template(t),events:{"click .js-delete":"deleteActivityClicked"},triggers:{"click .js-activity-type":"activityType:select"},activityTypeClicked:function(e){console.log("activityTypeClicked"),e.preventDefault(),this.trigger("activityType:select",this)},onRender:function(){o(".activity-types-area").on("click",function(){})},onShow:function(){},initialize:function(){this.model.on("change",this.render)}}),e.ActivityTypes=s.CompositeView.extend({className:"modal custom fade",id:"myModal",template:u.template(n),childView:e.ActivityType,childViewContainer:".modal-body",triggers:{"click .js-new":"activity:new"},onRender:function(){console.log("####Activities are rendered")},onShow:function(){o(".dropdown-toggle").dropdown()}})}),e.ActivitiesApp.NewActivity.View}),define("apps/activities/newActivity/newActivity_controller",["app","apps/activities/newActivity/newActivity_view","bootbox","bootstrap"],function(e,t,n){return e.module("ActivitiesApp.NewActivity",function(e,n,r,i,s,o){function u(e){var r=new t.ActivityTypes({collection:e});n.dialogRegion.show(r),s("#myModal").modal({}),r.on("childview:activityType:select",function(e){console.log("activityType %O",e),n.trigger("activityType:select",e),n.dialogRegion.closeDialog()}),r.on("activity:new:close",function(e){n.dialogRegion.closeDialog()})}e.Controller={newActivityTypes:function(e){var t=r.Model.extend({idAttribute:"_id",defaults:{title:"",type:"",desc:"",icon:""}}),n=r.Collection.extend({model:t}),i=[{_id:"1",title:"Slides with Questions",type:"media",desc:"Import PowerPoint, PDF, YouTube and add Questions to your lesson",icon:"/webapp/images/checkpoint_blue.svg"},{_id:"2",title:"Words List + App",type:"wordList",desc:"Categories with list of words/phrases. Select an App to use with the Word List",icon:"/webapp/images/checkpoint_brown.svg"}],s=new n(i);u(s)}}}),e.ActivitiesApp.NewActivity.Controller}),define("text!apps/activities/show/templates/activityShow_template_landscape.html",[],function(){return'<div class="container-fluid padding-0px">  \r\n  <div class="activity-question-title text-center camp-adventure-font"><a class="btn js-rename"><%= activityTitle %></a></div>  \r\n  <div class="row nav-row">\r\n<!--    <div class="col-md-1 col-sm-1 col-xs-1 text-center">\r\n    </div>-->\r\n    <div class="col-md-4 col-sm-4 text-center">\r\n      <a class="btn-engage btn-engage-default btn-delete-question js-question-delete" id="delete-question">Delete Slide</a>        \r\n    </div>\r\n    <div class="col-md-4 col-sm-4 text-center">          \r\n      <button class="btn-engage btn-engage-default btn-trigger-filepicker">Insert Media</button>\r\n    </div>\r\n    <div class="col-md-4 col-sm-4 text-center">\r\n      <a class="btn-engage btn-engage-default btn-new-question js-question-new" id="new-question">New Slide</a>\r\n      <a class="btn-engage btn-engage-default btn-new-question js-question-duplicate" id="duplicate-question">Duplicate Slide</a>\r\n    </div>\r\n    <div class="col-md-2 col-sm-2 text-center" style="display:none;">\r\n      <a class="btn-engage btn-engage-default btn-new-question js-new-images" id="new-images" style="display:none;">New Images</a>\r\n    </div>\r\n  </div>  \r\n\r\n  <div class="edit-row">\r\n    <div id="elements-side-panel"></div>\r\n    <!--frame content-->\r\n    <div id="element-main-panel"></div>\r\n  </div> \r\n</div>'}),define("text!apps/activities/show/templates/activityShow_template_potrait.html",[],function(){return'<div class="container-fluid">\r\n\r\n  <div class="row nav-row">\r\n<!--    <div class="col-md-1 col-sm-1 col-xs-1 text-center">\r\n         \r\n    </div>-->\r\n\r\n    <div class="col-md-4 col-sm-4 text-center">\r\n      <a class="btn-engage btn-engage-default btn-delete-question js-question-delete" id="delete-question">Delete Question</a>        \r\n    </div>\r\n    <div class="col-md-4 col-sm-4 text-center">          \r\n      <button class="btn-engage btn-engage-default btn-trigger-filepicker">Insert Media</button>\r\n    </div>\r\n    <div class="col-md-4 col-sm-4 text-center">\r\n      <a class="btn-engage btn-engage-default btn-new-question js-question-new" id="new-question">New Question</a>\r\n    </div>\r\n    <div class="col-md-2 col-sm-2 text-center" style="display:none;">\r\n      <a class="btn-engage btn-engage-default btn-new-question js-new-images" id="new-images" style="display:none;">New Images</a>\r\n    </div>\r\n  </div>  \r\n\r\n  <div class="row">\r\n\r\n    <div class="col-xs-12 col-md-12 col-lg-12 frameContent padding-0px">\r\n<!--      <a class="btn-engage-close-element  js-question-close">\r\n        <i class="fa fa-times fa-2x"></i>\r\n      </a>-->\r\n\r\n      <div class="btn-previous-area js-previous">\r\n        <a class="btn-engage ">\r\n          <i class="fa fa-chevron-left fa-2x btn-previous "></i>    \r\n        </a>            \r\n      </div>\r\n\r\n      <% if(!isImage) { %>\r\n      <iframe scrolling="yes" id="frameDoc" src="<%= resourceUrl %>" frameborder="0"></iframe>\r\n      <img id="imageDoc" src="about:blank" style=\'display:none\'>\r\n      <% } else { %>      \r\n      <iframe scrolling="yes" id="frameDoc" src="about:blank" frameborder="0"  style=\'display:none\'></iframe>\r\n      <img id="imageDoc" src="<%= resourceUrl %>">\r\n      <% } %> \r\n\r\n      <div class="btn-next-area js-next">\r\n        <a class="btn-engage  ">\r\n          <i class="fa fa-chevron-right fa-2x btn-next"></i>\r\n        </a>\r\n      </div>\r\n    </div>\r\n\r\n  </div> \r\n\r\n  <div class="row margin-0px">\r\n    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 question-title padding-0px">\r\n      Question/Description:\r\n    </div>\r\n    <div class="question-text-input col-lg-11 col-md-11 col-sm-11 col-xs-11 ">\r\n      <div contentEditable=true  data-ph="Click to edit question/description" class="col-md-12 col-sm-12 col-lg-12 question-text js-question-text" id="question-text"><%= questionText %></div>\r\n      <div class="col-md-12 col-sm-12 col-lg-12 question-text-edit-area padding-0px" id="question-text-edit">\r\n        <textarea name="questionText" class="question-text-edit" id="question-text-desc"><%= questionText %></textarea>\r\n        <a class="btn btn-success question-text-edit-btn js-question-save">Save</a>\r\n        <a class="btn btn-default question-text-edit-btn js-question-cancel">Cancel</a>\r\n      </div>\r\n    </div>\r\n    <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1">\r\n      <div class="answer-select-label">Answer:</div>\r\n      <select class="js-answer-select" id="answer-select">\r\n        <option value="a">A</option>\r\n        <option value="b">B</option>\r\n        <option value="c">C</option>\r\n        <option value="d">D</option>\r\n      </select>\r\n    </div>\r\n  </div>\r\n  <div class="row">\r\n    <div class="col-md-12 col-sm-12 col-xs-12 col-answer-a text-center padding-0px">\r\n      <div class="col-md-1 col-sm-1 col-xs-1 answer-text-label label-a padding-0px dullPink"><p>A</p></div>\r\n      <div contentEditable=true data-ph="Click to edit answer" class="col-md-11 col-sm-11 col-xs-11 col-md-offset-1 col-sm-offset-1  col-xs-offset-1 answer-text js-answerA" id="answer-text-a"><%= answerTextA %></div>\r\n      <div  class="col-md-11 col-sm-11 col-xs-11 col-md-offset-1 col-sm-offset-1  col-xs-offset-1  answer-edit-area" id="answer-text-edit-a">\r\n        <textarea name="answerText" class="answer-text-edit" id="answer-text-a-desc"><%= answerTextA %></textarea>\r\n        <a class="btn btn-success answer-text-edit-btn js-answer-save-a">Save</a>\r\n        <a class="btn btn-default answer-text-edit-btn js-answer-cancel-a">Cancel</a>\r\n      </div>\r\n    </div>\r\n    <div class="col-md-12 col-sm-12 col-xs-12 col-answer-b text-center padding-0px">\r\n      <div class="col-md-1 col-sm-1 answer-text-label label-b dullGreen">B</div>\r\n      <div contentEditable=true data-ph="Click to edit answer" class="col-md-11 col-sm-11 col-xs-11 col-md-offset-1 col-sm-offset-1 col-xs-offset-1 answer-text js-answerB" id="answer-text-b"><%= answerTextB %></div>\r\n      <div  class="col-md-11 col-sm-11 col-xs-11 col-md-offset-1 col-sm-offset-1  col-xs-offset-1  answer-edit-area" id="answer-text-edit-b">\r\n        <textarea name="answerText" class="answer-text-edit" id="answer-text-b-desc"><%= answerTextB %></textarea>\r\n        <a class="btn btn-success answer-text-edit-btn js-answer-save-b">Save</a>\r\n        <a class="btn btn-default answer-text-edit-btn js-answer-cancel-b">Cancel</a>\r\n      </div>\r\n    </div>\r\n    <div class="col-md-12 col-sm-12  col-xs-12 col-answer-c padding-0px text-center">\r\n      <div class="col-md-1 col-sm-1 answer-text-label label-c dullBlue">C</div>\r\n      <div contentEditable=true data-ph="Click to edit answer" class="col-md-11 col-sm-11 col-xs-11 col-md-offset-1 col-sm-offset-1 col-xs-offset-1 answer-text js-answerC" id="answer-text-c"><%= answerTextC %></div>\r\n      <div  class="col-md-11 col-sm-11 col-xs-11 col-md-offset-1 col-sm-offset-1  col-xs-offset-1  answer-edit-area" id="answer-text-edit-c">\r\n        <textarea name="answerText" class="answer-text-edit" id="answer-text-c-desc"><%= answerTextC %></textarea>\r\n        <a class="btn btn-success answer-text-edit-btn js-answer-save-c">Save</a>\r\n        <a class="btn btn-default answer-text-edit-btn js-answer-cancel-c">Cancel</a>\r\n      </div>\r\n    </div>\r\n    <div class="col-md-12 col-sm-12  col-xs-12 col-answer-d text-center padding-0px">\r\n      <div class="col-md-1 col-sm-1 answer-text-label label-d dullYellow">D</div>\r\n      <div contentEditable=true data-ph="Click to edit answer" class="col-md-11 col-sm-11 col-xs-11 col-md-offset-1 col-sm-offset-1 col-xs-offset-1 answer-text js-answerD" id="answer-text-d"><%= answerTextD %></div>\r\n      <div  class="col-md-11 col-sm-11 col-xs-11 col-md-offset-1 col-sm-offset-1  col-xs-offset-1 answer-edit-area" id="answer-text-edit-d">\r\n        <textarea name="answerText" class="answer-text-edit" id="answer-text-d-desc"><%= answerTextD %></textarea>\r\n        <a class="btn btn-success answer-text-edit-btn js-answer-save-d">Save</a>\r\n        <a class="btn btn-default answer-text-edit-btn js-answer-cancel-d">Cancel</a>\r\n      </div>\r\n    </div>\r\n  </div>   \r\n\r\n</div>'}),define("apps/activities/show/activityShow_view",["app","text!apps/activities/show/templates/activityShow_template_landscape.html","text!apps/activities/show/templates/activityShow_template_potrait.html","backbone.syphon"],function(e,t,n){return e.module("ActivitiesApp.Show.View",function(e,n,r,i,s,o){e.Activity=i.LayoutView.extend({regions:{elementsListPanel:"#elements-side-panel",elementPanel:"#element-main-panel"},getTemplate:function(){if(s(window).width()>=800)return console.log("resize for landscape "),o.template(t);if(s(window).width()<800)return console.log("resize for potrait. temporary use landscape for both"),o.template(t)},className:" engage-nav-bar",events:{"click .btn-trigger-filepicker":"triggerFilePickerClicked","click .js-new-images":"newImagesClicked"},triggerFilePickerClicked:function(e){window.activateFilePicker()},deleteQuestionClicked:function(e){e.preventDefault(),this.trigger("element:question:delete",e.target,this.model)},newImagesClicked:function(e){e.preventDefault(),this.trigger("element:question:newImages",e.target,this.model)},triggers:{"click .js-save":"element:link:save","click .js-question-close":"element:show:close","click .js-question-delete":"element:question:delete","click .js-question-new":"element:question:new","click .js-question-duplicate":"element:question:duplicate","click .js-new-images":"element:question:newImages","click .js-rename":"activity:rename"},initialize:function(e){this.collection=e.collection;var t=this;s(window).off("LocalMessageResourceUpdate"),s(window).on("LocalMessageResourceUpdate",function(e,n){var r=JSON.parse(n.detail);switch(r.type){case"ResourceUpdate":var i={resourceURL:r.resourceURL,thumbnail:r.thumbnailLink,title:r.title,isImage:r.isImage};t.trigger("element:link:update",t,i)}})},onRender:function(){console.log("####render activity view ")},onShow:function(){}})}),e.ActivitiesApp.Show.View}),define("text!apps/elements/list/templates/elements_dialog.html",[],function(){return'<div class="modal-dialog">\r\n  <div class="modal-content">    \r\n    <div class="modal-header elements-list">\r\n      <button type="button" class="close js-close" data-dismiss="modal" aria-hidden="true"><span class="modal-close">&times;</span></button>\r\n      <span id="activity-title" class="js-rename">\r\n        <div id="inner-activity-title">\r\n          <div class="circle-index "> <%=index %></div>\r\n          <div  contenteditable="true" data-ph="Click to edit title" class="activity-title-text js-activity-title-text" id="activity-title-text"><%= activityTitle %></div>\r\n          <div class="lesson-list-header-bar">            \r\n<!--            <a href="#" class="btn btn-default btn-sm btn-adventure js-select">Insert Media</a>  \r\n             <a href="#" class="btn btn-default btn-sm btn-adventure js-new-images">Insert Images</a>-->\r\n          </div>\r\n          \r\n          <div id="lessonView"  class="row margin-0px"></div>\r\n          <div class="activity-title-edit-area" id="activity-title-edit-area">\r\n            <textarea name="questionText" class="activity-title-edit" id="activity-title-desc"><%= activityTitle %></textarea>\r\n            <a class="btn btn-success btn-activity-title-edit js-save">Save</a>\r\n            <a class="btn btn-default btn-activity-title-edit js-cancel">Cancel</a>\r\n          </div>\r\n      </span>      \r\n    </div>    \r\n    <div class="modal-body elements-list" >\r\n      <div class="elements-wrapper">\r\n        <div class="element " id="addOne">\r\n          <div class="addOne js-new">\r\n            <span>+</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n'}),define("text!apps/elements/list/templates/elements_panel.html",[],function(){return'<div class="elements-panel-wrapper">\r\n<!--  <div class="element-panel " id="addOne">\r\n    <div class="addOne js-new">\r\n      <span>+</span>\r\n    </div>\r\n  </div>-->\r\n\r\n</div>\r\n<div id="cloned-slides" class="cloned-slides"></div>\r\n<!--<div class="activity-title-edit-area" id="activity-title-edit-area">\r\n  <textarea name="questionText" class="activity-title-edit" id="activity-title-desc"></textarea>\r\n  <a class="btn btn-success btn-activity-title-edit js-save">Save</a>\r\n  <a class="btn btn-default btn-activity-title-edit js-cancel">Cancel</a>\r\n</div>           -->\r\n\r\n'}),define("text!apps/elements/list/templates/elements_panel_item.html",[],function(){return'<!--<div class="element-panel-index"><%= index %></div>-->\r\n\r\n<div class="element-index"><%= index %></div>\r\n<div class="element-panel-preview js-show">\r\n  <div class="btn-element " data-toggle="tooltip" data-placement="left" title="Open Element">\r\n    <% if( thumbnail === "about:blank" &&  questionText !== "") {%>\r\n    <div  class="btn-image "><%= questionText %> </div>\r\n    <% } else { %>\r\n    <div class="btn-image " style=\'background-image: url("<%= thumbnail %>");\'></div>\r\n    <% } %>\r\n  </div>\r\n</div>\r\n<!--<div class="btn-overlay grey"></div>-->\r\n<!--<div class="index number">\r\n  <span class="circle-index index-list-element"><%= index %></span>\r\n</div>-->\r\n<!--<div class="btn-overlay-description">\r\n  <p></p>\r\n</div>\r\n  <div class="btn-edit">\r\n    <a  class="btnNav btnDelete js-delete"></a>\r\n  </div>-->\r\n\r\n<!--  <div class="line"></div>-->\r\n'}),define("text!apps/elements/list/templates/elements_item.html",[],function(){return'<div class="btn-element js-show" data-toggle="tooltip" data-placement="left" title="Open Element">\r\n    <% if( thumbnail === "about:blank" &&  questionText !== "") {%>\r\n    <div  class="btn-image "><%= questionText %> </div>\r\n    <% } else { %>\r\n    <div class="btn-image " style=\'background-image: url("<%= thumbnail %>");\'></div>\r\n    <% } %>\r\n  <div class="btn-overlay grey"></div>\r\n  <div class="index number">\r\n    <span class="circle-index index-list-element"><%= index %></span>\r\n  </div>\r\n  <div class="btn-overlay-description">\r\n    <p></p>\r\n  </div>\r\n  <div class="btn-edit">\r\n    <a  class="btnNav btnDelete js-delete"></a>\r\n  </div>\r\n</div>\r\n<!-- <div class="edit-element-lower-container dullBlueShade">\r\n  <textarea class="input-element" rows="2" cols="50" placeholder="Description"></textarea>\r\n  <div class="edit-element-delete-container">\r\n    <button class="btnDelete btnNav js-delete"></button>\r\n  </div>                    \r\n</div>-->\r\n'}),define("apps/elements/list/elementsList_view",["app","text!apps/elements/list/templates/elements_dialog.html","text!apps/elements/list/templates/elements_panel.html","text!apps/elements/list/templates/elements_panel_item.html","text!apps/elements/list/templates/elements_item.html","jquery-ui"],function(e,t,n,r,i){return e.module("ElementsApp.List.View",function(e,s,o,u,a,f){function h(){a(".elements-panel-wrapper").sortable({axis:"y",revert:!0,scroll:!1,placeholder:"sortable-placeholder",cursor:"move",start:function(e,t){t.helper.addClass("exclude-me"),a(".elements-panel-wrapper .slide:not(.exclude-me)").css("visibility","hidden"),t.helper.data("clone").hide(),a(".cloned-slides .slide").css("visibility","visible")},stop:function(e,t){console.log("e %O",e),console.log("UI %O",t),a(".elements-panel-wrapper .slide.exclude-me").each(function(){var e=a(this),t=e.data("clone"),n=e.position();t.css("left",n.left),t.css("top",n.top),t.show(),e.removeClass("exclude-me")}),a(".elements-panel-wrapper .slide").each(function(){var e=a(this),t=e.data("clone");t.attr("data-pos",e.index()+1)}),a(".elements-panel-wrapper .slide").css("visibility","visible"),a(".cloned-slides .slide").css("visibility","hidden")},change:function(e,t){a(".elements-panel-wrapper .slide:not(.exclude-me)").each(function(){var e=a(this),t=e.data("clone");t.stop(!0,!1);var n=e.position();t.animate({left:n.left,top:n.top},200)})}})}e.Element=u.ItemView.extend({template:f.template(i),className:function(){return"element "+this.model.get("color")},triggers:{"click .js-delete":"element:delete"},events:{"click .js-show":"elementShowClicked"},elementShowClicked:function(e){e.preventDefault(),this.trigger("element:show",this.model)}}),e.Elements=u.CompositeView.extend({template:f.template(t),childView:e.Element,childViewContainer:".elements-wrapper",id:"myModal",events:{"click .js-activity-title-text":"activityTitleTextClicked","click .js-save":"activityTitleTextSaveClicked","click .js-cancel":"activityTitleTextCancelClicked"},triggers:{"click .js-close":"element:list:close","click .js-new":"element:new","click .js-new-images":"element:new:images"},activityTitleTextClicked:function(e){e.preventDefault(),this.trigger("activity:title:edit",e.target,this.model)},activityTitleTextSaveClicked:function(e){e.preventDefault(),this.trigger("activity:title:save",e.target,this.model)},activityTitleTextCancelClicked:function(e){e.preventDefault(),this.trigger("activity:title:cancel",e.target,this.model)},initialize:function(){this.appendHtml=function(e,t,n){e.$el.find("#addOne").before(t.el)}}});var l=".elements-panel-wrapper",c;e.ElementPanel=u.ItemView.extend({template:f.template(r),className:"slide",triggers:{"click .js-delete":"element:delete"},events:{"mousedown .js-show":"mouseDownDetected","touchstart .js-show":"touchStartDetected"},modelEvents:{"change:selected":"selectedChange","change:index":"indexChanged"},selectedChange:function(e,t){this.style.highlight(this)},indexChanged:function(e,t){console.log("render index change")},style:{highlight:function(e){var t=e.model.get("selected");typeof t!==undefined&&t===!0?a(e.el).find(".element-panel-preview").addClass("green-highlight"):a(e.el).find(".element-panel-preview").removeClass("green-highlight")}},initialize:function(){this.style.highlight(this)},onRender:function(){console.log("###element render"),this.style.highlight(this)},mouseDownDetected:function(e){var t=this;c=this,e.preventDefault();var n,r,i=e.target;r=new Date;var s=setTimeout(function(){a(l).sortable("enable"),console.log("sort Elements")},150);a(e.target).mouseup(function(){clearTimeout(s),n=new Date,n.getTime()-r.getTime()<150&&(console.log("show element"),t.trigger("element:show",t.model))})},touchStartDetected:function(e){var t=this;e.preventDefault();var n,r,i=e.target;r=new Date;var s=setTimeout(function(){a(l).sortable("enable")},100);a(e.target).on({touchend:function(){clearTimeout(s),console.log("click"),n=new Date,n.getTime()-r.getTime()<100?(console.log("show element"),t.trigger("element:show",t.model)):console.log("set new position")}})}}),e.ElementsPanel=u.CompositeView.extend({template:f.template(n),childView:e.ElementPanel,className:"elements-wrapper",childViewContainer:".elements-panel-wrapper",events:{"click .js-activity-title-text":"activityTitleTextClicked","click .js-save":"activityTitleTextSaveClicked","click .js-cancel":"activityTitleTextCancelClicked"},triggers:{"click .js-close":"element:list:close","click .js-new":"element:new","click .js-new-images":"element:new:images"},activityTitleTextClicked:function(e){e.preventDefault(),this.trigger("activity:title:edit",e.target,this.model)},activityTitleTextSaveClicked:function(e){e.preventDefault(),this.trigger("activity:title:save",e.target,this.model)},activityTitleTextCancelClicked:function(e){e.preventDefault(),this.trigger("activity:title:cancel",e.target,this.model)},initialize:function(){},onRender:function(){var e=this;console.log("###element list render");var t=a(this.el),n=".elements-panel-wrapper";t.find(".elements-panel-wrapper").sortable({axis:"y",revert:!0,scroll:!1,placeholder:"sortable-placeholder",cursor:"move",start:function(e,t){t.helper.addClass("exclude-me")},stop:function(n,r){e.trigger("element:setIndex",r,c),t.find(".elements-panel-wrapper .slide.exclude-me").each(function(){var e=a(this);e.removeClass("exclude-me")})},change:function(e,t){}}),a(n).sortable("disable")}})}),e.ElementsApp.List.View}),define("text!apps/elements/show/templates/elementShow_template.html",[],function(){return'<div class="frameContent padding-0px\r\n     <% if(!resourceUrl || resourceUrl === "about:blank") { %>\r\n     frameContentEmptyMark\r\n     <% }%>   \r\n     " >\r\n     <!--  <a class="btn-engage-close-element  js-question-close">\r\n         <i class="fa fa-times fa-2x"></i>\r\n       </a>-->\r\n\r\n     <div class="btn-previous-area js-previous">\r\n    <a class="btn-engage ">\r\n      <i class="fa fa-chevron-left fa-2x btn-previous "></i>    \r\n    </a>            \r\n  </div>\r\n\r\n  <% if(!isImage) { %>\r\n  <iframe scrolling="yes" id="frameDoc" src="<%= resourceUrl %>" frameborder="0"></iframe>\r\n  <!--<img id="imageDoc" src="about:blank" style=\'display:none\'>-->\r\n  <div id="imageDocHolder" class="image"  style=\'display:none\'>\r\n    <div class="trick"></div>\r\n    <img id="imageDoc" src="about:blank" onload="" crossOrigin="Anonymous">\r\n  </div>\r\n  <% } else { %>      \r\n  <iframe scrolling="yes" id="frameDoc" src="about:blank" frameborder="0"  style=\'display:none\'></iframe>\r\n  <!--<img id="imageDoc" src="<%= resourceUrl %>" crossOrigin="Anonymous">-->\r\n  <div  id="imageDocHolder" class="image">\r\n    <div class="trick"></div>\r\n    <img id="imageDoc" src="<%= resourceUrl %>"  onload="" crossOrigin="Anonymous">\r\n  </div>\r\n  <div class="crop-button-area"> \r\n    <a href="#" class="btn btn-sm btn-default js-crop"><span class="fa fa-crop"></span> Crop</a>\r\n    <div class="crop-ok-cancel" >      \r\n      <a href="#" class="btn btn-danger btn-default js-crop-cancel"><b>&nbsp;X&nbsp;</b> </a> \r\n      <a href="#" class="btn btn-success btn-default js-crop-ok" style="display:none"><span class="fa fa-check"></span></a>\r\n    </div>  \r\n    <div id="crop-saving" style="display:none;">\r\n      <i class="fa fa-spinner fa-spin"></i>\r\n      <span><b>Saving...</b></span>\r\n    </div>\r\n    <div id="crop-saved" style="display:none;">\r\n      <span><b> &nbsp; Saved</b></span>\r\n    </div>\r\n  </div>\r\n  <!--  <div style="position:absolute; top:50px;left:10px;"> </div>\r\n    <div style="position:absolute; top:50px;left:50px;"> </div>-->\r\n  <% } %> \r\n\r\n  <div class="btn-next-area js-next">\r\n    <a class="btn-engage  ">\r\n      <i class="fa fa-chevron-right fa-2x btn-next"></i>\r\n    </a>\r\n  </div>\r\n</div>\r\n\r\n<div class="frameQuestions">\r\n  <!--frame Question-->\r\n  <div class="row margin-0px">\r\n    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 question-title">\r\n      Question/Description:\r\n    </div>\r\n    <div id="question-input-panel" class="question-text-input col-lg-12 col-md-12 col-sm-12 col-xs-12 ">\r\n\r\n    </div>\r\n  </div>\r\n  <div class="response-type-wrapper">\r\n    <span class="response-type">Answers: </span>\r\n<!--    <span class="response-type">Answer Types:</span>\r\n    <select class="js-response-select" id="response-select">\r\n      <option value="mul">Multiple Choice</option>\r\n      <option value="text">Text Response</option>       \r\n    </select> -->\r\n  </div>\r\n  <div id="response-panel" class="row margin-0px">\r\n  </div>   \r\n</div>'}),define("apps/elements/show/elementsShow_view",["app","text!apps/elements/show/templates/elementShow_template.html","backbone.syphon"],function(e,t){return e.module("ElementsApp.Show.View",function(e,n,r,i,s,o){e.Element=i.LayoutView.extend({regions:{responsePanel:"#response-panel",questionInputPanel:"#question-input-panel"},className:"element-panel-wrapper",template:o.template(t),style:{hideBtn:function(e){var t=e.model.collection.indexOf(e.model);t===0&&s(e.el).find(".btn-previous").hide();var n=t+1;e.model.collection.at(n)||s(e.el).find(".btn-next").hide()},selectAnswer:function(e){var t=e.model.get("answer");s(e.el).find("#answer-select").val(t)},selectAnswerType:function(e){var t=e.model.get("responseType");s(e.el).find("#response-select option[value='"+t+"']").attr("selected","selected")}},onRender:function(){this.style.hideBtn(this),this.style.selectAnswer(this),this.style.selectAnswerType(this)},onShow:function(){},events:{"click .js-next":"questionNextClicked","click .js-previous":"questionPreviousClicked","click .btn-trigger-filepicker":"triggerFilePickerClicked","click .js-answer-save":"saveButtonClicked","change .js-answer-select":"selectAnswer","change .js-response-select":"selectResponse","click .js-crop":"cropImage","click .js-crop-ok":"cropImageOK","click .js-crop-cancel":"cropImageCancel"},triggerFilePickerClicked:function(e){window.activateFilePicker()},questionNextClicked:function(e){e.preventDefault(),this.trigger("element:question:next",this.model)},questionPreviousClicked:function(e){e.preventDefault(),this.trigger("element:question:previous",this.model)},cropImage:function(e){e.preventDefault(),this.trigger("element:crop",this.model)},cropImageOK:function(e){e.preventDefault(),this.trigger("element:crop:ok",this.model)},cropImageCancel:function(e){e.preventDefault(),this.trigger("element:crop:cancel",this.model)},selectAnswer:function(e){console.log("select answe"),this.trigger("element:answer:select",e.target,this.model)},selectResponse:function(e){console.log("select response"),this.trigger("element:response:select",e.target,this.model)},triggers:{"click .js-save":"element:link:save","click .js-question-close":"element:show:close"},initialize:function(){var e=this}})}),e.ElementsApp.Show.View}),define("text!apps/elements/show/templates/elementShowQuestionInput.html",[],function(){return'<div  contentEditable=true  data-ph="Click to edit question/description" class="col-md-12 col-sm-12 col-lg-12 question-text js-question-text" id="question-text"><% console.log( questionText ) %><%= questionText %></div>\r\n<div class="col-md-12 col-sm-12 col-lg-12 question-text-edit-area " id="question-text-edit">\r\n  <textarea name="questionText" class="question-text-edit" id="question-text-desc"><%= questionText %></textarea>\r\n  <a class="btn btn-success question-text-edit-btn js-question-save">Save</a>\r\n  <a class="btn btn-default question-text-edit-btn js-question-cancel">Cancel</a>\r\n</div>\r\n'}),define("apps/elements/show/elementsShowQuestionInput_view",["app","text!apps/elements/show/templates/elementShowQuestionInput.html","backbone.syphon"],function(e,t){return e.module("ElementsApp.Show.View",function(e,n,r,i,s,o){e.ElementQuestion=i.ItemView.extend({template:o.template(t),style:{},events:{"click .js-question-text":"questionTextClicked","click .js-question-cancel":"cancelButtonQuestionClicked","click .js-question-save":"saveTextQuestionClicked"},questionTextClicked:function(e){var t=s(e.target).parent(".js-question-text");this.trigger("element:question:text:edit",t,this.model)},saveTextQuestionClicked:function(e){this.trigger("element:question:save",e.target,this.model)},cancelButtonQuestionClicked:function(e){this.trigger("element:question:cancel",e.target,this.model)},triggers:{},initialize:function(){var e=this}})}),e.ElementsApp.Show.View}),define("text!apps/elements/show/templates/elementShowResponseMultiple.html",[],function(){return'<div class=" col-md-12 col-sm-12 col-xs-12  padding-0px col-answer-a">\r\n  <div class=" answer-text-label-wrapper text-center label-a dullPink">\r\n    <div class="answer-text-label-font">A</div>\r\n    <div class="answer-select-wrapper">\r\n      <!--<div class="camp-adventure-font">Answer</div>-->\r\n      <input id="radioa" class="js-answer-select-radio btn-radio-answer" type="radio" value="a">\r\n      <span class="answer-radio"><label for="radioa"><i class="fa fa-check"></i></label></span>      \r\n    </div>\r\n  </div>\r\n  <div contentEditable=true data-ph="Click to edit answer" class="answer-text js-answer" id="answer-text-a"><%= answerTextA %></div>\r\n  <div  class="answer-edit-area" id="answer-text-edit-a">\r\n    <textarea name="answerText" class="answer-text-edit" id="answer-text-a-desc"><%= answerTextA %></textarea>\r\n    <a class="btn btn-success answer-text-edit-btn js-answer-save">Save</a>\r\n    <a class="btn btn-default answer-text-edit-btn js-answer-cancel">Cancel</a>\r\n  </div>\r\n</div>\r\n<div class="col-md-12 col-sm-12 col-xs-12 col-answer-b  padding-0px">\r\n  <div class=" answer-text-label-wrapper text-center label-b dullGreen">\r\n    <div class="answer-text-label-font">B</div>\r\n    <div class="answer-select-wrapper">\r\n      <!--<div class="camp-adventure-font">Answer</div>-->      \r\n      <input id="radiob" class="js-answer-select-radio btn-radio-answer" type="radio" value="b">\r\n      <span class="answer-radio"><label for="radiob"><i class="fa fa-check "></i></label></span>         \r\n    </div>\r\n  </div>\r\n  <div contentEditable=true data-ph="Click to edit answer" class=" answer-text js-answer" id="answer-text-b"><%= answerTextB %></div>\r\n  <div  class="answer-edit-area" id="answer-text-edit-b">\r\n    <textarea name="answerText" class="answer-text-edit" id="answer-text-b-desc"><%= answerTextB %></textarea>\r\n    <a class="btn btn-success answer-text-edit-btn js-answer-save">Save</a>\r\n    <a class="btn btn-default answer-text-edit-btn js-answer-cancel">Cancel</a>\r\n  </div>\r\n</div>\r\n<div class="col-md-12 col-sm-12  col-xs-12 col-answer-c padding-0px ">\r\n  <div class="answer-text-label-wrapper text-center label-b dullBlue">\r\n    <div class="answer-text-label-font">C</div>\r\n    <div class="answer-select-wrapper">\r\n      <!--<div class="camp-adventure-font">Answer</div>-->\r\n      <input id="radioc" class="js-answer-select-radio btn-radio-answer" type="radio" value="c">\r\n      <span class="answer-radio"><label for="radioc"><i class="fa fa-check"></i></label></span>     \r\n    </div>\r\n  </div>\r\n  <div contentEditable=true data-ph="Click to edit answer" class=" answer-text js-answer" id="answer-text-c"><%= answerTextC %></div>\r\n  <div  class="answer-edit-area" id="answer-text-edit-c">\r\n    <textarea name="answerText" class="answer-text-edit" id="answer-text-c-desc"><%= answerTextC %></textarea>\r\n    <a class="btn btn-success answer-text-edit-btn js-answer-save">Save</a>\r\n    <a class="btn btn-default answer-text-edit-btn js-answer-cancel">Cancel</a>\r\n  </div>\r\n</div>\r\n<div class="col-md-12 col-sm-12  col-xs-12 col-answer-d  padding-0px">\r\n  <div class=" answer-text-label-wrapper text-center label-b dullYellow">\r\n    <div class="answer-text-label-font">D</div>\r\n    <div class="answer-select-wrapper">\r\n      <!--<div class="camp-adventure-font">Answer</div>-->\r\n      <input id="radiod" class="js-answer-select-radio btn-radio-answer" type="radio" value="d">\r\n      <span class="answer-radio"><label for="radiod"><i class="fa fa-check"></i></label></span>     \r\n    </div>\r\n  </div>\r\n  <div contentEditable=true data-ph="Click to edit answer" class=" answer-text js-answer" id="answer-text-d"><%= answerTextD %></div>\r\n  <div  class="answer-edit-area" id="answer-text-edit-d">\r\n    <textarea name="answerText" class="answer-text-edit" id="answer-text-d-desc"><%= answerTextD %></textarea>\r\n    <a class="btn btn-success answer-text-edit-btn js-answer-save">Save</a>\r\n    <a class="btn btn-default answer-text-edit-btn js-answer-cancel">Cancel</a>\r\n  </div>\r\n</div>'}),define("text!apps/elements/show/templates/elementShowResponseText.html",[],function(){return'<div class="student-text-response-area">\r\n  <span><b>The students will be submitting a text response</b></span>\r\n</div>'}),define("apps/elements/show/elementsShowResponse_view",["app","text!apps/elements/show/templates/elementShowResponseMultiple.html","text!apps/elements/show/templates/elementShowResponseText.html","backbone.syphon"],function(e,t,n){return e.module("ElementsApp.Show.View",function(e,r,i,s,o,u){e.ElementResponse=s.ItemView.extend({getTemplate:function(){return this.model.get("responseType")==="mul"?u.template(t):this.model.get("responseType")==="text"?u.template(n):u.template(t)},style:{selectAnswer:function(e){var t=e.model.get("answer");o("input[type=radio]").each(function(e,n){n.value===t&&(n.checked=!0)})}},onRender:function(e){},onShow:function(){this.style.selectAnswer(this)},events:{"click .js-answer":"answerClicked","click .js-question-text":"questionTextClicked","click .js-next":"questionNextClicked","click .js-previous":"questionPreviousClicked","click .btn-trigger-filepicker":"triggerFilePickerClicked","click .js-answer-save":"saveButtonClicked","click .js-answer-cancel":"cancelButtonClicked","click .js-question-cancel":"cancelButtonQuestionClicked","click .js-question-save":"saveTextQuestionClicked","click .js-answer-select-radio":"answerSelectRadioClicked","keypress .answer-edit-area":"keypress"},triggerFilePickerClicked:function(e){window.activateFilePicker()},answerClicked:function(e){this.trigger("element:answer:edit",e.target,this.model)},questionNextClicked:function(e){e.preventDefault(),this.trigger("element:question:next",this.model)},questionPreviousClicked:function(e){e.preventDefault(),this.trigger("element:question:previous",this.model)},saveButtonClicked:function(e){e.preventDefault(),this.trigger("element:answer:save",e.target,this.model)},cancelButtonClicked:function(e){e.preventDefault(),this.trigger("element:answer:cancel",e.target,this.model)},questionTextClicked:function(e){this.trigger("element:question:text:edit",e.target,this.model)},saveTextQuestionClicked:function(e){this.trigger("element:question:save",e.target,this.model)},cancelButtonQuestionClicked:function(e){this.trigger("element:question:cancel",e.target,this.model)},answerSelectRadioClicked:function(e){o("input[type=radio]").each(function(e,t){t.checked=!1}),o(e.target)[0].checked=!0,this.trigger("element:answerRadio:select",e.target,this.model)},triggers:{},initialize:function(){var e=this}})}),e.ElementsApp.Show.View}),define("server/sync",["app"],function(e){return e.module("Server",function(e,t,n,r,i,s){e.Sync={MessageToServerStudentAnswer:function(e){window.appToServer("StudentAnswer",{value:e})}}}),e.Server.Sync}),define("apps/activities/show/activityShow_controller",["app","apps/activities/show/activityShow_view","apps/elements/list/elementsList_view","apps/elements/show/elementsShow_view","apps/elements/show/elementsShowQuestionInput_view","apps/elements/show/elementsShowResponse_view","server/sync","domReady","bootbox","Jcrop","mathjax","ckeditor-j","bootstrap"],function(e,t,n,r,i,s,o,u,a,f,l){return e.module("ActivitiesApp.Show",function(e,o,u,f,c,h){function d(e){var t=JSON.stringify(e.toJSON());c.ajax({url:e.url(),type:"PUT",data:t,async:!0,contentType:"application/json",success:function(e){}})}function v(e,t){e.set("elements",t);var n=e.clone();n.save({},{success:function(e){n.trigger("destroy",n,n.collection)},error:function(e){}})}function m(e){var t=e.findWhere({selected:!0});return t}var p=f.Controller.extend({showFirstElement:function(e,t){require(["entities/element/element_collection","entities/activity/activity_collection"],function(n){var r=e;if(e===null&&typeof t=="undefined"){var i=o.request("activity:entities");c.when(i).done(function(e){var t=e.at(0);r=t.get("elements");var i=0,s=new n(r),o=s.at(i);_helper.showElementView(o)})}else if(r instanceof u.Collection){var a=r.at(t);console.log(a),_helper.showElementView(a)}else{var s=new n(r),a=s.at(t);_helper.showElementView(a)}})},showElementLocal:function(e,t){_helper.showElementView(e,t)},showElement:function(e,t){require(["entities/activity/activity_collection"],function(){var n=o.request("activity:entities");c.when(n).done(function(n){var r=n.get(e),i=r.get("elements").at(t-1);_helper.showElementView(r,i)})})},showActivity:function(f,p){function S(){var e=g.get("elements"),t=m(e),n=e.indexOf(t)+1,r=o.request("element:entity:new");typeof e.at(n)!==undefined&&h.each(e.models,function(t){e.indexOf(t)+1>=n+1&&t.set("index",e.indexOf(t)+2)})}function x(t){function p(e){c(".js-crop-ok").css("display",""),h=e}function m(e){e.focus()}o.reqres.setHandler("current:model",function(){return t}),o.navigate("#activities/"+g.id+"/elements/"+(t.collection.indexOf(t)+1));var n=new r.Element({model:t});b.listenTo(n,"element:link:save",function(e){require(["entities/activity/activity_model"],function(t){var n=e.model,r=o.request("activity:entity",e.model.collection.activityID),i=u.Syphon.serialize(e.view);n.set(i);var s=JSON.parse(JSON.stringify(e.model.collection));c.when(r).done(function(e){v(e,s);var t=c("#frameDoc");t.attr("src",i.resourceUrl),window.imgPreloader.push(i.resourceUrl)})})}),b.listenTo(n,"element:question:previous",function(e){var t=e.collection.indexOf(e),n=t-1,r=e.collection.at(n);o.navigate("#activities/"+g.id+"/elements/"+(n+1)),x(r),r.setSelected(),k(e.collection)}),b.listenTo(n,"element:question:next",function(e){var t=e.collection.indexOf(e),n=t+1,r=e.collection.at(n);o.navigate("#activities/"+g.id+"/elements/"+(n+1)),x(r),r.setSelected(),k(e.collection)}),b.listenTo(n,"element:show:close",function(){var e={activities:g.collection};o.trigger("activities:list",e)}),b.listenTo(n,"element:link:update",function(e,t){var n=e;n.set({resourceUrl:t.resourceURL,isImage:t.isImage,thumbnail:t.thumbnail,resourceTitle:t.title});var r=JSON.parse(JSON.stringify(e.collection));d(g);if(t.isImage){var i=c("#frameDoc");i.attr("src","about:blank"),i.css("display","none");var s=c("#imageDocHolder"),o=c("#imageDoc");o.attr("src",t.resourceURL),s.css("display","")}else{var i=c("#frameDoc");i.attr("src",t.resourceURL),i.css("display","");var s=c("#imageDocHolder"),o=c("#imageDoc");o.attr("src","about:blank"),s.css("display","none")}}),b.listenTo(n,"element:response:select",function(e,t){var n=t,r=c("select#response-select").val();n.set("responseType",r),d(g),console.log(r),o.execute("reset:response:view")});var a,f=!1,h={};e.listenTo(n,"element:crop",function(e,t){f?(f=!1,a.destroy(),c(".crop-ok-cancel").css("display","none"),c(".js-crop-ok").css("display","none"),c("#imageDoc").removeAttr("style")):(c("#imageDoc").Jcrop({bgColor:"gray",bgOpacity:.8,onSelect:p},function(){a=this}),c(".crop-ok-cancel").css("display","block"),f=!0)}),e.listenTo(n,"element:crop:ok",function(e,t){c(".crop-ok-cancel").css("display","none"),c(".js-crop-ok").css("display","none"),c("#crop-saving").css("display",""),c("#imageDoc").css("width",""),c("#imageDoc").css("height","");if(!h)return;var n=document.createElement("CANVAS"),r=n.getContext("2d"),i=document.getElementById("imageDoc"),s=c(i),o=i.width,u=i.height,l=u/s.height(),p=o/s.width(),d=h.x*p,v=h.y*l,m=h.w*p,g=h.h*l;n.height=g,n.width=m,r.drawImage(i,d,v,m,g,0,0,n.width,n.height);var y=n.toDataURL("image/png");console.log(y),c("#filepicker")[0].contentWindow.uploadBackground(y,function(e){console.log(e);var t=120,r=120/g*m,i=document.createElement("CANVAS");i.height=t,i.width=r;var s=i.getContext("2d");s.drawImage(n,0,0,h.w,h.h,0,0,r,t);var o=i.toDataURL("image/png");c("#filepicker")[0].contentWindow.uploadBackground(o,function(t){f=!1,a.destroy(),c("#imageDoc").removeAttr("style"),c("#crop-saving").css("display","none"),c("#crop-saved").css("display",""),c("#filepicker")[0].contentWindow.sendCallBackImageUpdate(e,t),setTimeout(function(){c("#crop-saved").css("display","none")},3e3),i=null,n=null})})}),e.listenTo(n,"element:crop:cancel",function(e,t){f=!1,a.destroy(),c(".crop-ok-cancel").css("display","none"),c("#imageDoc").removeAttr("style")}),b.listenTo(n,"show",function(){function r(){var e=new s.ElementResponse({model:t});b.listenTo(e,"show",function(){C.initializeAnswerCKeditor(".answer-text-edit"),l.Hub.Queue(["Typeset",l.Hub])}),b.listenTo(e,"element:answer:edit",function(e,t){c(e).hide();var n=c(e).next(".answer-edit-area");n.show(),n.find(".cke_wysiwyg_frame").css("width","100%");var r=n.find(".answer-text-edit").attr("id"),i=CKEDITOR.instances[r];m(i)}),b.listenTo(e,"element:answer:cancel",function(e,t){var n=c(e).closest("div[class*='col-answer']");n.find(".answer-text").show(),n.find(".answer-edit-area").hide()}),b.listenTo(e,"element:answer:save",function(e,t){var n=c(e).closest("div[class*='col-answer']");l.Hub.Queue(["Typeset",l.Hub]),N(n)}),b.listenTo(e,"element:answerRadio:select",function(e,t){var n=t,r=c(e).val();n.set("answer",r),d(g)}),n.responsePanel.show(e)}var e=new i.ElementQuestion({model:t});b.listenTo(e,"element:question:text:edit",function(e,t){c(".js-question-text").hide(),c("#question-text-edit").show();var n=CKEDITOR.instances["question-text-desc"];m(CKEDITOR.instances["question-text-desc"]),c("#question-text-desc").next().find(".cke_wysiwyg_frame").css("width","100%")}),b.listenTo(e,"element:question:cancel",function(e,t){c("#question-text").show(),c("#question-text-edit").hide()}),b.listenTo(e,"element:question:save",function(e,t){T()}),b.listenTo(e,"show",function(){console.log("show editor"),C.initializeQuestionCKeditor(".question-text-edit"),l.Hub.Queue(["Typeset",l.Hub])}),n.questionInputPanel.show(e),r(),o.commands.setHandler("reset:response:view",function(){r()})}),E.elementPanel.show(n)}function T(){var e=CKEDITOR.instances["question-text-desc"].getData();console.debug("content:"+e);var t=o.request("current:model");c("#question-text").html(e),l.Hub.Queue(["Typeset",l.Hub]),c("#question-text").show(),c("#question-text-edit").hide(),t.set("questionText",e),d(g),k(t.collection)}function N(e){var t,n=o.request("current:model");e.find(".answer-text").show(),e.find(".answer-edit-area").hide();var r=e.find(".answer-text-label-font").text();switch(r){case"A":t=CKEDITOR.instances["answer-text-a-desc"].getData(),e.find(".answer-text").html(t),n.set("answerTextA",t);break;case"B":console.log("B"),t=CKEDITOR.instances["answer-text-b-desc"].getData(),e.find(".answer-text").html(t),n.set("answerTextB",t);break;case"C":t=CKEDITOR.instances["answer-text-c-desc"].getData(),e.find(".answer-text").html(t),n.set("answerTextC",t);break;case"D":t=CKEDITOR.instances["answer-text-d-desc"].getData(),e.find(".answer-text").html(t),n.set("answerTextD",t)}l.Hub.Queue(["Typeset",l.Hub]),d(g)}function k(e){var t=new n.ElementsPanel({collection:e});b.listenTo(t,"childview:element:show",function(e){e.model.setSelected(),x(e.model)}),b.listenTo(t,"element:setIndex",function(t,n){function p(){var e=[];h.each(l.models,function(t){t.get("index")>r&&t.get("index")<=a&&(e.push(t),t.set({index:t.get("index")-1},{silent:!0}))}),i.set({index:a},{silent:!0}),f=!0,l.sort(),k(l)}function v(){var e=[];h.each(l.models,function(t){t.get("index")<r&&t.get("index")>=a&&(e.push(t),t.set({index:t.get("index")+1},{silent:!0}))}),i.set({index:a},{silent:!0}),f=!0,l.sort(),k(l)}var r=parseInt(c(t.item).find(".element-index").text()),i=n.model,s=c(t.item).next(),o=c(t.item).prev(),u=parseInt(s.find(".element-index").text()),a,f=!1,l=e;if(e.length===1)return;s.length!==0&&r<u?(a=u-1,p()):!f&&s.length===0&&o.length!==0?(a=e.length,p()):!f&&r>u&&(a=u,v()),c(".elements-panel-wrapper").sortable("refresh"),d(g)}),E.elementsListPanel.show(t)}var g=f.clone();if(typeof p=="undefined"){o.trigger("activities:list");return}var y=p.collection.indexOf(p);if(typeof y=="undefined"){o.trigger("activities:list");return}o.trigger("header:list:elements");var b=e.Controller;p.setSelected();var w=new n.ElementsPanel({collection:g.get("elements")}),E=new t.Activity({model:g});b.listenTo(E,"activity:rename",function(e){a.prompt({title:"Rename Activity Title",value:e.model.get("activityTitle"),callback:function(t){var t=c.trim(t);if(t===null||t.length===0)return;g.set("activityTitle",t),d(g),e.view.$el.find(".js-rename").html(t)}})}),b.listenTo(E,"element:question:new",function(e){require(["entities/element/element_model"],function(){var e=g.get("elements"),t=m(e),n=e.indexOf(t)+1,r=o.request("element:entity:new");typeof e.at(n)!==undefined&&h.each(e.models,function(t){e.indexOf(t)+1>=n+1&&t.set("index",e.indexOf(t)+2)}),r.set("index",n+1),e.add(r),v(g,e),x(r),r.setSelected(),k(g.get("elements"))})}),b.listenTo(E,"element:question:duplicate",function(e){var t=g.get("elements"),n=m(t),r=t.indexOf(n)+1,i=n.clone();typeof t.at(r)!==undefined&&h.each(t.models,function(e){t.indexOf(e)+1>=r+1&&e.set("index",t.indexOf(e)+2)}),i.set("index",r+1),t.add(i),v(g,t),x(i),i.setSelected(),k(g.get("elements"))}),b.listenTo(E,"element:question:delete",function(e){var t=g.get("elements"),n=m(t),r=t.indexOf(n);t.remove(n),t.resetIndex();var i=t.at(r),s=t.at(r-1);i?(v(g,t),i.setSelected(),k(g.get("elements")),x(i)):t.length===0?require(["entities/element/element_model"],function(){var e=o.request("element:entity:new");e.set("index",1),t.add(e),i=e,v(g,t),x(i)}):typeof i=="undefined"&&s&&(v(g,t),x(s),s.setSelected(),k(g.get("elements")))}),b.listenTo(E,"element:question:newImages",function(e){var t=g.get("elements"),n=m(t),r=t.indexOf(n),i=document.imageDataArray,s=i.length,u=n.get("index")+1;h.each(t.models,function(e){e.get("index")>=u&&e.set("index",e.get("index")+s-1)}),console.log("active Slide : %O",n),require(["entities/element/element_model"],function(){function s(e,t){e.set("resourceUrl",t.resourceURL),e.set("thumbnail",t.thumbnail),e.set("resourceTitle",t.resourceTitle),e.set("isImage",!0)}var e=u,r=0;s(n,i[0]),i.shift(),h.each(i,function(n){var i=o.request("element:entity:new");i.set("index",e+r),s(i,n),t.add(i),r+=1}),console.log("elements after add"),console.log(g.get("elements")),d(g),x(n),k(t)})}),b.listenTo(E,"element:link:update",function(e,t){var n=g.get("elements"),r=m(n),i=n.indexOf(r);r.set({resourceUrl:t.resourceURL,isImage:t.isImage,thumbnail:t.thumbnail,resourceTitle:t.title}),g.set({thumbnail:t.thumbnail});if(t.isImage){var s=c("#frameDoc");s.attr("src","about:blank"),s.css("display","none");var o=c("#imageDocHolder"),u=c("#imageDoc");u.attr("src",t.resourceURL),o.css("display","")}else{var s=c("#frameDoc");s.attr("src",t.resourceURL),s.css("display","");var o=c("#imageDocHolder"),u=c("#imageDoc");u.attr("src","about:blank"),o.css("display","none")}d(g),k(n)}),b.listenTo(E,"show",function(){c("html").css("cursor",""),x(p),k(p.collection)});var C={initializeQuestionCKeditor:function(e){c(e).ckeditor({toolbarGroups:[{name:"clipboard",groups:["undo"]},{name:"basicstyles"},{name:"styles"},{name:"colors"},{name:"paragraph",groups:["indent","align"]},{name:"insert"},{name:"links"}],specialChars:["&quot;","&rsquo;","#","$","%","&amp;",["&theta;","theta"],["&Pi;","Pi"],["&radic;","square root"],"{","|","}","~","&euro;","&lsquo;","&rsquo;","&ldquo;","&rdquo;","&ndash;","&mdash;","&iexcl;","&cent;","&pound;","&curren;","&yen;","&brvbar;","&sect;","&uml;","&copy;","&ordf;","&laquo;","&not;","&reg;","&macr;","&deg;","&sup2;","&sup3;","&acute;","&micro;","&para;","&middot;","&cedil;","&sup1;","&ordm;","&raquo;","&frac14;","&frac12;","&frac34;","&iquest;","&Agrave;","&Aacute;","&Acirc;","&Atilde;","&Auml;","&Aring;","&AElig;","&Ccedil;","&Egrave;","&Eacute;","&Ecirc;","&Euml;","&Igrave;","&Iacute;","&Icirc;","&Iuml;","&ETH;","&Ntilde;","&Ograve;","&Oacute;","&Ocirc;","&Otilde;","&Ouml;","&times;","&Oslash;","&Ugrave;","&Uacute;","&Ucirc;","&Uuml;","&Yacute;","&THORN;","&szlig;","&agrave;","&aacute;","&acirc;","&atilde;","&auml;","&aring;","&aelig;","&ccedil;","&egrave;","&eacute;","&ecirc;","&euml;","&igrave;","&iacute;","&icirc;","&iuml;","&eth;","&ntilde;","&ograve;","&oacute;","&ocirc;","&otilde;","&ouml;","&divide;","&oslash;","&ugrave;","&uacute;","&ucirc;","&uuml;","&yacute;","&thorn;","&yuml;","&OElig;","&oelig;","&#372;","&#374","&#373","&#375;","&sbquo;","&#8219;","&bdquo;","&hellip;","&trade;","&#9658;","&bull;","&rarr;","&rArr;","&hArr;","&diams;","&asymp;"],removeButtons:"Flash,Iframe,Smiley,PageBreak,Image,Table,Anchor,spellchecker,Cut,Paste,Copy,Styles"}),CKEDITOR.instances["question-text-desc"].on("key",function(e){e.data.keyCode===9&&(e.cancel(),T(),c(".answer-text")[0].click())})},initializeAnswerCKeditor:function(e){c(e).ckeditor({toolbarGroups:[{name:"clipboard",groups:["undo"]},{name:"basicstyles"},{name:"styles"},{name:"colors"},{name:"paragraph",groups:["indent","align"]},{name:"insert"},{name:"insert"}],specialChars:["&quot;","&rsquo;","#","$","%","&amp;",["&theta;","theta"],["&Pi;","Pi"],["&radic;","square root"],"{","|","}","~","&euro;","&lsquo;","&rsquo;","&ldquo;","&rdquo;","&ndash;","&mdash;","&iexcl;","&cent;","&pound;","&curren;","&yen;","&brvbar;","&sect;","&uml;","&copy;","&ordf;","&laquo;","&not;","&reg;","&macr;","&deg;","&sup2;","&sup3;","&acute;","&micro;","&para;","&middot;","&cedil;","&sup1;","&ordm;","&raquo;","&frac14;","&frac12;","&frac34;","&iquest;","&Agrave;","&Aacute;","&Acirc;","&Atilde;","&Auml;","&Aring;","&AElig;","&Ccedil;","&Egrave;","&Eacute;","&Ecirc;","&Euml;","&Igrave;","&Iacute;","&Icirc;","&Iuml;","&ETH;","&Ntilde;","&Ograve;","&Oacute;","&Ocirc;","&Otilde;","&Ouml;","&times;","&Oslash;","&Ugrave;","&Uacute;","&Ucirc;","&Uuml;","&Yacute;","&THORN;","&szlig;","&agrave;","&aacute;","&acirc;","&atilde;","&auml;","&aring;","&aelig;","&ccedil;","&egrave;","&eacute;","&ecirc;","&euml;","&igrave;","&iacute;","&icirc;","&iuml;","&eth;","&ntilde;","&ograve;","&oacute;","&ocirc;","&otilde;","&ouml;","&divide;","&oslash;","&ugrave;","&uacute;","&ucirc;","&uuml;","&yacute;","&thorn;","&yuml;","&OElig;","&oelig;","&#372;","&#374","&#373","&#375;","&sbquo;","&#8219;","&bdquo;","&hellip;","&trade;","&#9658;","&bull;","&rarr;","&rArr;","&hArr;","&diams;","&asymp;"],removeButtons:"Flash,Iframe,Smiley,PageBreak,Image,Table,Anchor,spellchecker,Cut,Paste,Copy,Styles"});for(var t=0;t<4;t++){var n="a".charCodeAt(0),r="answer-text-"+String.fromCharCode(n+t)+"-desc";CKEDITOR.instances[r].on("key",function(e){if(e.data.keyCode===9){e.cancel();var t="#"+e.editor.name,n=c(t),r=n.closest("div[class*='col-answer']");l.Hub.Queue(["Typeset",l.Hub]),N(r);var i=e.editor.name.substring(12,13),s="#answer-text-"+String.fromCharCode(i.charCodeAt(0)+1);c(s).click()}})}}};o.mainRegion.show(E)}});e.Controller=new p}),e.ActivitiesApp.Show.Controller}),define("apps/activities/activities_app",["app"],function(e){e.module("ActivitiesApp",function(e,t,n,r,i,s){e.onStart=function(){console.log("Starting ActivitiesApp")},e.onStop=function(){console.log("Stopping ActivitiesApp")}}),e.module("Router.ActivitiesApp",function(e,t,n,r,i,s){e.Router=r.AppRouter.extend({appRoutes:{"":"listActivities","activities/:id/elements/:id":"showActivityWithIndex"}}),ActivitiesAPI={listActivities:function(e){require(["apps/activities/listActivities/listActivities_controller","apps/header/list/headerList_controller"],function(t,n){t.listActivities(e),n.listHeader("activities")})},addActivityTypes:function(e){console.log("#######show activities"),require(["apps/activities/listActivities/listActivities_controller"],function(t){t.addActivity(e)})},showActivityTypes:function(){console.log("#######show adventure types"),require(["apps/activities/newActivity/newActivity_controller"],function(e){e.newActivityTypes()})},showActivity:function(e,t){require(["apps/activities/show/activityShow_controller"],function(n){n.showActivity(e,t)})},showActivityWithIndex:function(e,n){require(["apps/activities/show/activityShow_controller"],function(r){require(["entities/activity/activity_collection"],function(){var s=t.request("activity:entities");i.when(s).done(function(t){var i=t.get(e),s=i.get("elements").at(n-1);r.showActivity(i,s)})})})}},t.on("activities:list",function(e){typeof e=="undefined"?t.navigate(""):t.getCurrentRoute()!=="activities"&&t.navigate(""),ActivitiesAPI.listActivities(e)}),t.on("activities:list:initialized",function(){t.navigate("activities"),console.log("activities:list:initialized");var e={initialized:!0};ActivitiesAPI.listActivities(e)}),t.on("activities:list:initialized:noroute",function(){console.log("activities:list:initialized");var e={initialized:!0};ActivitiesAPI.listActivities(e)}),t.on("activityType:select",function(e){ActivitiesAPI.addActivityTypes(e)}),t.on("activityTypes:show",function(e){ActivitiesAPI.showActivityTypes()}),t.on("activity:show:first",function(e){var t=e.get("elements").at(0);ActivitiesAPI.showActivity(e,t)}),t.on("activity:show",function(e,t){ActivitiesAPI.showActivity(e,t)}),t.addInitializer(function(){new e.Router({controller:ActivitiesAPI})})})}),define("text!apps/students/list/templates/students_item.html",[],function(){return'<div class="studentWrapper  col-md2 col-xs-12 col-lg1 ">\r\n    <div class="btnStudent dullBlue">\r\n        <span>A</span>\r\n    </div>\r\n    <div>\r\n        <div class="studentStatusBar statusGreen">\r\n            <span></span>\r\n        </div>\r\n        <span class="studentName">Amy</span>\r\n        <span class="studentLevel">1</span>\r\n    </div>\r\n</div>\r\n'}),define("text!apps/students/list/templates/students_template.html",[],function(){return'<div class="container-fluid">\r\n    <div id="studentsManageView" class="row"></div>\r\n</div>\r\n'}),define("apps/students/list/list_view",["app","text!apps/students/list/templates/students_item.html","text!apps/students/list/templates/students_template.html"],function(e,t,n){return e.module("StudentsApp.List.View",function(e,r,i,s,o,u){e.Student=s.ItemView.extend({"class":"studentWrapper  col-md2 col-xs-12 col-lg1",template:u.template(t)}),e.Students=s.CompositeView.extend({template:u.template(n),id:"studentsView",childView:e.Student,childViewContainer:"#studentsManageView"})}),e.StudentsApp.List.View}),define("entities/students/student_model",["jquery","underscore","backbone","app"],function(e,t,n,r){var i=n.Model.extend({idAttribute:"_id",url:function(){return t.result(this.collection,"url")+(this.isNew()?"":this.id+"/")},parse:function(){this.set("_id",response._id)},defaults:{name:0,level:0,statusColour:"white"}});return r.reqres.setHandler("student:entity:new",function(e){return new i}),i}),define("entities/students/student_collection",["jquery","underscore","backbone","app","entities/students/student_model"],function(e,t,n,r,i){var s=n.Collection.extend({url:function(){return"/join/"+this.idJoin},model:i,initialize:function(e,t){this.idJoin=t}}),o=function(){var e=new s([{_id:1,name:"Cheng Yong"},{_id:2,name:"Boon Jin",statusColour:"statusGreen"},{_id:3,name:"JM"}]);return e.models},u={getStudentsEntities:function(){var t=e.Deferred(),n=new s;n.fetch({success:function(e){t.resolve(e)},error:function(e){t.resolve(e)}});var r=t.promise();return e.when(r).done(function(e){if(e.length===0){var t=o();e.reset(t)}}),r}};return r.reqres.setHandler("students:entities",function(){return u.getStudentsEntities()}),s}),define("apps/students/list/list_controller",["app","apps/students/list/list_view"],function(e,t){return e.module("StudentsApp.List",function(e,n,r,i,s,o){e.Controller={listStudents:function(){require(["entities/students/student_collection"],function(){var e=n.request("students:entities");s.when(e).done(function(e){console.log(e);var r=new t.Students({collection:e});console.log(r),n.mainRegion.show(r)})})}}}),e.StudentsApp.List.Controller}),define("apps/students/students_app",["app","apps/students/list/list_view"],function(e,t){e.module("Router.StudentsApp",function(e,t,n,r,i,s){e.Router=r.AppRouter.extend({appRoutes:{join:"listStudents"}}),studentAPI={listStudents:function(){require(["entities/students/student_collection"],function(){t.request("students")})}},t.on("students:list",function(){require(["apps/students/list/list_controller"],function(e){e.listStudents()})}),t.addInitializer(function(){new e.Router({controller:studentAPI})})})}),define("apps/elements/list/elementsList_controller",["app","apps/elements/list/elementsList_view","bootstrap"],function(e,t){return e.module("ElementsApp.List",function(e,n,r,i,s,o){function f(e){var t=JSON.stringify(e.toJSON());s.ajax({url:e.url(),type:"PUT",data:t,async:!0,contentType:"application/json",success:function(e){}})}function l(r,i){var u=e.Controller,a=i.get("elements"),l=new t.ElementsPanel({collection:a});r.elementsListPanel.show(l),u.listenTo(l,"childview:element:show",function(e,t){n.trigger("element:show",r.elementPanel,i,t)}),n.on("element:setIndex",function(e,t){function m(){var e=[];o.each(v.models,function(t){t.get("index")>n&&t.get("index")<=p&&(e.push(t),t.set({index:t.get("index")-1},{silent:!0}))}),r.set({index:p},{silent:!0}),d=!0,l.render()}function g(){var e=[];o.each(v.models,function(t){t.get("index")<n&&t.get("index")>=p&&(e.push(t),t.set({index:t.get("index")+1},{silent:!0}))}),r.set({index:p},{silent:!0}),d=!0,l.render()}var n=parseInt(s(e.item).find(".element-index").text()),r=t.model,u=s(e.item).next(),c=s(e.item).prev(),h=parseInt(u.find(".element-index").text()),p,d=!1,v=a;if(a.length===1)return;u.length!==0&&n<h?(p=h-1,m()):!d&&u.length===0&&c.length!==0?(p=a.length,m()):!d&&n>h&&(p=h,g()),s(".elements-panel-wrapper").sortable("refresh"),f(i)})}function c(e){var t=e.clone();e.save(),e=t}function h(){var e=s.Deferred();return require(["entities/activity/activity_collection"],function(){var t=n.request("activity:entities:initialized");e.resolve(t)}),e.promise()}var u=i.Controller.extend({listElements:function(e){require(["entities/activity/activity_collection"],function(){var t=n.request("activity:entities");s.when(t).done(function(t){var r={activities:t};n.trigger("activities:list:initialized:noroute");var i=t.get(e);l(i)})})},listElementsLocal:function(e,t){l(e,t)}});e.Controller=new u;var a={}}),e.ElementsApp.List.Controller}),define("apps/elements/show/elementsShow_controller",["app","apps/elements/show/elementsShow_view","apps/elements/show/elementsShowQuestionInput_view","apps/elements/show/elementsShowResponse_view","server/sync","backbone.syphon","bootstrap"],function(e,t,n,r,i){return e.module("ElementsApp.Show",function(e,i,s,o,u,a){function f(e){if(typeof e=="undefined"){i.trigger("activities:list");return}var t=e.collection.indexOf(e);if(typeof t=="undefined"){i.trigger("activities:list");return}}function l(e){var t=JSON.stringify(e.toJSON());u.ajax({url:e.url(),type:"PUT",data:t,async:!0,contentType:"application/json",success:function(e){}})}function h(e,t){e.set("elements",t),e.save()}function p(e,t){var n=i.request("element:entity:new"),r=e.collection.indexOf(e)+1,s=t.collection.length+1;n.set("index",r+"."+s),t.collection.add(n),console.log("elements after add"),console.log(e.get("elements"))}e.Controller={showFirstElement:function(e,t){require(["entities/element/element_collection","entities/activity/activity_collection"],function(n){var r=e;if(e===null&&typeof t=="undefined"){var o=i.request("activity:entities");u.when(o).done(function(e){var t=e.at(0);r=t.get("elements");var i=0,s=new n(r),o=s.at(i);c.showElementView(o)})}else if(r instanceof s.Collection){var f=r.at(t);console.log(f),c.showElementView(f)}else{var a=new n(r),f=a.at(t);c.showElementView(f)}})},showElementLocal:function(e,t,n){c.showElementView(e,t,n)},showElement:function(e,t){require(["entities/activity/activity_collection"],function(){var n=i.request("activity:entities");u.when(n).done(function(n){var r=n.get(e),i=r.get("elements").at(t-1);c.showElementView(r,i)})})},showElementLocalQuestions:function(e,t,n){c.showElementQuestionView(e,t,n)},showElementLocalAnswers:function(e,t,n){c.showElementAnswerView(e,t,n)}};var c={highlightElement:function(e){a.each(e.collection.models,function(e){e.set({selected:!1},{silent:!0})}),e.set({selected:!0},{silent:!0})},showElementView:function(n,r,o){f(o),o.setSelected();var a=new t.Element({model:o});e.listenTo(a,"childview:element:show",function(e,t){i.trigger("element:show",a.elementPanel,r,t)}),e.listenTo(a,"element:link:save",function(e){require(["entities/activity/activity_model"],function(t){var n=e.model,r=i.request("activity:entity",e.model.collection.activityID),o=s.Syphon.serialize(e.view);n.set(o);var a=JSON.parse(JSON.stringify(e.model.collection));u.when(r).done(function(e){h(e,a);var t=u("#frameDoc");t.attr("src",o.resourceUrl),window.imgPreloader.push(o.resourceUrl)})})}),e.listenTo(a,"element:question:previous",function(e){var t=e.collection.indexOf(e),s=t-1,o=e.collection.at(s);i.navigate("#activities/"+r.id+"/elements/"+(s+1)),i.trigger("element:show",n,r,o)}),e.listenTo(a,"element:question:next",function(e){var t=e.collection.indexOf(e),s=t+1,o=e.collection.at(s);i.navigate("#activities/"+r.id+"/elements/"+(s+1)),i.trigger("element:show",n,r,o)}),e.listenTo(a,"element:show:close",function(){var e={activities:r.collection};i.trigger("activities:list",e)}),e.listenTo(a,"element:link:update",function(e,t){var n=e;n.set({resourceUrl:t.resourceURL,isImage:t.isImage,thumbnail:t.thumbnail,resourceTitle:t.title}),r.set({thumbnail:t.thumbnail});var i=JSON.parse(JSON.stringify(e.collection));l(r);if(t.isImage){var s=u("#frameDoc");s.attr("src","about:blank"),s.css("display","none");var o=u("#imageDoc");o.attr("src",t.resourceURL),o.css("display","block")}else{var s=u("#frameDoc");s.attr("src",t.resourceURL),s.css("display","block");var o=u("#imageDoc");o.attr("src","about:blank"),o.css("display","none")}}),e.listenTo(a,"element:answer:select",function(e,t){var n=t,i=u("select#answer-select").val();n.set("answer",i),l(r),console.log(i)}),e.listenTo(a,"element:response:select",function(e,t){var n=t,i=u("select#response-select").val();n.set("responseType",i),l(r),console.log(i)}),e.listenTo(a,"show",function(){i.trigger("element:question:show",a.questionInputPanel,r,o),i.trigger("element:answers:show",a.responsePanel,r,o)}),n.show(a)},showElementQuestionView:function(t,r,i){var s=new n.ElementQuestion({model:i});e.listenTo(s,"element:question:text:edit",function(e,t){u(".js-question-text").hide(),u("#question-text-edit").show()}),e.listenTo(s,"element:question:cancel",function(e,t){u("#question-text").show(),u("#question-text-edit").hide()}),e.listenTo(s,"element:question:save",function(e,t){var n=u(".question-text-edit").code();console.debug("content:"+n);var i=t;u("#question-text").html(n),u("#question-text").show(),u("#question-text-edit").hide(),t.set("questionText",n),l(r)}),e.listenTo(s,"show",function(){initializeQuestionSummerNote(".question-text-edit")}),t.show(s)},showElementAnswerView:function(t,n,i){var s=new r.ElementResponse({model:i});e.listenTo(s,"show",function(){initializeAnswerSummerNote(".answer-text-edit")}),e.listenTo(s,"render",function(){initializeAnswerSummerNote(".answer-text-edit")}),t.show(s),e.listenTo(s,"element:answer:a:edit",function(e,t){u(e).hide(),u("#answer-text-edit-a").show(),u("#answer-text-edit-a").find(".note-editable").focus()}),e.listenTo(s,"element:answer:b:edit",function(e,t){u(e).hide(),u("#answer-text-edit-b").show(),u("#answer-text-edit-b").find(".note-editable").focus()}),e.listenTo(s,"element:answer:c:edit",function(e,t){u(e).hide(),u("#answer-text-edit-c").show(),u("#answer-text-edit-c").find(".note-editable").focus()}),e.listenTo(s,"element:answer:d:edit",function(e,t){u(e).hide(),u("#answer-text-edit-d").show(),u("#answer-text-edit-d").find(".note-editable").focus()}),e.listenTo(s,"element:answer:cancel:a",function(e,t){u("#answer-text-a").show(),u("#answer-text-edit-a").hide()}),e.listenTo(s,"element:answer:a:save",function(e){var t=u(".answer-text-edit").code();console.debug("content"+t);var r=e.model;u("#answer-text-a").html(t),console.log(u("textarea#answer-text-a-desc").val()),u("#answer-text-a").show(),u("#answer-text-edit-a").hide(),r.set("answerTextA",t);var i=JSON.parse(JSON.stringify(r.collection));l(n)}),e.listenTo(s,"element:answer:cancel:b",function(e,t){u("#answer-text-b").show(),u("#answer-text-edit-b").hide()}),e.listenTo(s,"element:answer:b:save",function(e,t){var r=u("textarea#answer-text-b-desc").code();console.debug("content"+r);var i=t;u("#answer-text-b").html(r),u("#answer-text-b").show(),u("#answer-text-edit-b").hide(),i.set("answerTextB",r),l(n)}),e.listenTo(s,"element:answer:cancel:c",function(e,t){u("#answer-text-c").show(),u("#answer-text-edit-c").hide()}),e.listenTo(s,"element:answer:c:save",function(e,t){var r=u("textarea#answer-text-c-desc").code();console.debug("content"+r);var i=t,s=u("textarea#answer-text-c-desc").val();u("#answer-text-c").html(r),console.log(u("textarea#answer-text-c-desc").val()),u("#answer-text-c").show(),u("#answer-text-edit-c").hide(),i.set("answerTextC",r),l(n)}),e.listenTo(s,"element:answer:cancel:d",function(e,t){u("#answer-text-d").show(),u("#answer-text-edit-d").hide()}),e.listenTo(s,"element:answer:d:save",function(e,t){var r=u("textarea#answer-text-d-desc").code();console.debug("content"+r);var i=t;u("#answer-text-d").html(r),console.log(u("textarea#answer-text-d-desc").val()),u("#answer-text-d").show(),u("#answer-text-edit-d").hide(),i.set("answerTextD",r),l(n)}),e.listenTo(s,"element:answer:select",function(e,t){var r=t,i=u("select#answer-select").val();r.set("answer",i),l(n),console.log(i)})}},d={MessageToServerStudentAnswer:function(e){var t={type:"StudentAnswer",value:e};jq(document).trigger("studentToServer",{detail:t})}}}),e.ElementsApp.Show.Controller}),define("apps/elements/elements_app",["app"],function(e){e.module("Router.ElementsApp",function(e,t,n,r,i,s){e.Router=r.AppRouter.extend({appRoutes:{}});var o={listElements:function(e){require(["apps/elements/list/elementsList_controller"],function(t){t.listElements(e)})},listElementsLocal:function(e,t){require(["apps/elements/list/elementsList_controller"],function(n){n.listElementsLocal(e,t)})},showElementLocal:function(e,n,r){t.navigate("#activities/"+n.id+"/elements/"+(r.collection.indexOf(r)+1)),require(["apps/elements/show/elementsShow_controller"],function(t){t.showElementLocal(e,n,r)})},showElementLocalQuestions:function(e,t,n){require(["apps/elements/show/elementsShow_controller"],function(r){r.showElementLocalQuestions(e,t,n)})},showElementLocalAnswers:function(e,t,n){require(["apps/elements/show/elementsShow_controller"],function(r){r.showElementLocalAnswers(e,t,n)})},showElement:function(e,t){require(["apps/elements/show/elementsShow_controller"],function(n){n.showElement(e,t)})}};t.on("elements:list",function(e,t){o.listElementsLocal(e,t)}),t.on("element:show",function(e,t,n){o.showElementLocal(e,t,n)}),t.on("element:question:show",function(e,t,n){o.showElementLocalQuestions(e,t,n)}),t.on("element:answers:show",function(e,t,n){o.showElementLocalAnswers(e,t,n)}),t.on("element:show:first",function(e){var t=e.get("elements").at(0);o.showElementLocal(e,t)}),t.addInitializer(function(){new e.Router({controller:o})})})}),define("text!apps/dialog/show/templates/dialog.html",[],function(){return'<div class="modal-dialog">\r\n  <div class="modal-content">\r\n    <div class="modal-header">\r\n      <button type="button" class="close js-close" data-dismiss="modal" aria-hidden="true">&times;</button>\r\n      <h4 class="modal-title" id="myModalLabel">Modal title</h4>\r\n    </div>\r\n    <div class="modal-body">\r\n      <iframe scrolling="yes" id="frameDoc" src="<%= resourceUrl %>" frameborder="0"></iframe>  \r\n    </div>\r\n\r\n  </div>\r\n</div>\r\n'}),define("apps/dialog/show/dialogShow_view",["app","text!apps/dialog/show/templates/dialog.html"],function(e,t){return e.module("DialogApp.Show.View",function(e,n,r,i,s,o){e.Dialog=i.ItemView.extend({template:o.template(t)})}),e.DialogApp.Show.View}),define("apps/dialog/show/dialogShow_controller",["app","apps/dialog/show/dialogShow_view","bootstrap"],function(e,t){return e.module("DialogApp.Show",function(e,n,r,i,s,o){e.Controller={showDialog:function(e){var i=new r.Model({resourceUrl:e}),o=new t.Dialog({model:i});n.dialogRegion.show(o),s("#mymodal").modal({})},hideDialog:function(){n.dialogRegion.hideModal()}}}),e.DialogApp.Show.Controller}),define("apps/dialog/dialog_app",["app"],function(e){e.module("Router.ElementsApp",function(e,t,n,r,i,s){DialogAPI={showDialog:function(e){require(["apps/dialog/show/dialogShow_controller"],function(t){t.showDialog(e)})},hideDialog:function(e){require(["apps/dialog/show/dialogShow_controller"],function(e){e.hideDialog()})}},t.on("dialog:show",function(e){DialogAPI.showDialog(e)}),t.on("dialog:hide",function(){DialogAPI.hideDialog()})})}),define("text!apps/header/listElements/templates/headerListElements_template.html",[],function(){return'<a href="#" class="btn-activity js-back"><i class="fa fa-arrow-left fa-2x btn-activity-back"></i></a>\r\n<div class="slides-title-wrapper camp-adventure-font text-center"><span class="edit-adventure-title">Edit Slides & Questions</span></div>\r\n<div class="btn-group preview-actions">\r\n  <a href="/classroom/preview/<%= document.lessonID %>/teststudents/1_2" class="btn btn-success js-preview-1_2student" title="Preview Adventure"><i class=\'fa fa-play\'></i> Preview Adventure</a>        \r\n  <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">\r\n    <span class="caret"></span>\r\n    <span class="sr-only">Toggle Dropdown</span>\r\n  </button>\r\n  <ul class="dropdown-menu " role="menu">\r\n    <li><a href="/classroom/preview/<%= document.lessonID %>/teststudents/0" target="preview" class="js-preview-teacher">Preview as Teacher </a></li>\r\n    <li><a href="/classroom/preview/<%= document.lessonID %>/teststudents/1" target="preview" class="js-preview-1student">Preview as Student</a></li>    \r\n    <li><a href="/classroom/preview/<%= document.lessonID %>/teststudents/1_2" target="preview" class="js-preview-1_2students">With 1 Mock Student</a></li>    \r\n    <li><a href="/classroom/preview/<%= document.lessonID %>/teststudents/2" target="preview" class="js-preview-2students">With 2 Mock Students</a></li>    \r\n    <!--<li><a href="/classroom/preview/<%= document.lessonID %>/teststudents/4" class="js-preview-4students">Preview with 4 test students</a></li>-->    \r\n  </ul>\r\n</div>'}),define("apps/header/listElements/headerListElements_view",["app","text!apps/header/listElements/templates/headerListElements_template.html"],function(e,t){return e.module("HeaderApp.ListElements.View",function(e,n,r,i,s,o){e.Header=i.ItemView.extend({template:o.template(t),className:"activity-nav-bar",triggers:{"click .js-back":"adventure:back","click .js-preview-4students":"adventure:preview:4students","click .js-preview-2students":"adventure:preview:2students","click .js-preview-1student":"adventure:preview:1student","click .js-preview-1_2student":"adventure:preview:1_2student","click .js-preview-teacher":"adventure:preview:teacher","click .js-guide":"show:guide"},initialize:function(){},onShow:function(){s(".dropdown-toggle").dropdown()}})}),e.HeaderApp.ListElements.View}),define("apps/header/listElements/headerListElements_controller",["app","apps/header/listElements/headerListElements_view","bootbox"],function(e,t,n){return e.module("HeaderApp.ListElements",function(e,n,r,i,s,o){e.Controller={listElementsHeader:function(e){var r=JSON.parse(s("#data-results").html());lessonID=r._id;var i=new t.Header;n.headerRegion.show(i),i.on("adventure:back",function(){console.log("window.location.pathname"+n.getCurrentRoute());var e=n.getCurrentRoute().split("/")[1],t;t={activityIDToBeAnimated:e},n.trigger("activities:list",t)}),i.on("adventure:preview:4students",function(){var e=window.location.hash.replace("activities","adventures"),t=btoa(e);window.open("/classroom/preview/"+lessonID+"/teststudents/4?path="+t,"preview")}),i.on("adventure:preview:2students",function(){var e=window.location.hash.replace("activities","adventures"),t=btoa(e);window.open("/classroom/preview/"+lessonID+"/teststudents/2?path="+t,"preview")}),i.on("adventure:preview:1_2student",function(){var e=window.location.hash.replace("activities","adventures"),t=btoa(e);window.open("/classroom/preview/"+lessonID+"/teststudents/1_2?path="+t,"preview")}),i.on("adventure:preview:1student",function(){var e=window.location.hash.replace("activities","adventures"),t=btoa(e);window.open("/classroom/preview/"+lessonID+"/teststudents/1?path="+t,"preview")}),i.on("adventure:preview:teacher",function(){var e=window.location.hash.replace("activities","adventures"),t=btoa(e);window.open("/classroom/preview/"+lessonID+"/teststudents/0?path="+t,"preview")}),i.on("wordLists:list",function(e){n.trigger("wordLists:list")}),i.on("activities:list",function(e){n.trigger("activities:list")})}}}),e.HeaderApp.ListElements.Controller}),define("apps/header/header_app",["app"],function(e){e.module("HeaderApp",function(e,t,n,r,i,s){HeaderAPI={listHeader:function(e){require(["apps/header/list/headerList_controller"],function(t){t.listHeader(e)})},listElementsHeader:function(){require(["apps/header/listElements/headerListElements_controller"],function(e){e.listElementsHeader()})}},t.on("header:list",function(e){console.log("###header:list"),HeaderAPI.listHeader(e)}),t.on("header:list:elements",function(){console.log("####header:list:elements"),HeaderAPI.listElementsHeader()})})}),define("text!apps/wordLists/list/templates/wordLists_item.html",[],function(){return'\r\n<div class="list-area" data-toggle="tooltip" data-placement="left">\r\n  <div class="col-md-1 col-sm-1 col-lg-1 padding-0px list-title-description camp-adventure-font"><p>Title:</p></div>\r\n  <div title="Edit Title" contentEditable=true data-ph="Click here to edit Title" class="col-md-11 col-sm-11 col-lg-11 camp-adventure-font padding-0px list-title js-title-edit"><%= title %></div>\r\n  <div class="title-edit-area col-md-11 col-sm-11 col-lg-11 padding-0px">\r\n    <textarea class="title-edit-textarea js-title-edit-area" rows="1"><%= title %></textarea>\r\n    <a class="btn btn-success js-title-save">\r\n      <i class="icon-white icon-ok"></i>Save\r\n    </a>\r\n    <a class="btn btn-default js-title-cancel">Cancel</a>\r\n  </div>\r\n  \r\n  <% \r\n    var string=\'\';\r\n    _.each(words,function(word){        \r\n        if(word !== \' \' || word !==\'\\n\'){\r\n          string += (word + "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp");\r\n        }\r\n       // console.log(string);\r\n     })\r\n  %>\r\n\r\n  <div title="Edit Word List" contentEditable=true data-ph="Click to edit Word List" class="col-md-12 col-sm-12 col-lg-12 padding-0px list-text js-list-text">\r\n  <%= string %></div>\r\n  <div class="list-edit-area js-list-edit-area">\r\n    <textarea class="list-edit-textarea"></textarea>\r\n    <a class="btn btn-success js-save">\r\n      <i class="icon-white icon-ok"></i>Save\r\n    </a>\r\n    <a class="btn btn-default js-cancel">Cancel</a>\r\n  </div>\r\n  <a class="btn btn-default btn-list-delete js-delete">\r\n    <i class="fa fa-trash-o"></i> \r\n  </a>\r\n</div>\r\n'}),define("text!apps/wordLists/list/templates/wordLists_template.html",[],function(){return'<div title="Edit Word Lists" class="btn-wordLists-editor text-center js-show-wordLists"\r\n     data-intro="Manage Word Lists <br>(Category and Words)" data-position="right"\r\n     ><span></span><i class="fa fa-list-alt btn-editor-icon fa-2x"></i></div>\r\n<div class="wordLists-editor-wrapper container-fluid">  \r\n  <div class="wordListHeader row  text-center guide-wl-new" >\r\n    <span class="camp-adventure-font-white wordLists-title">Edit Word Lists</span>\r\n<!--    <a class="btn btn-info btn-guide js-guide">\r\n      <i class="fa fa-info-circle"></i>\r\n    </a>-->\r\n  </div>\r\n  <div class="wl-guide-area text-center">\r\n    <button title="Add New Word List" class="btn btn-new-list js-new" >        \r\n      <i class="fa fa-plus new-list-icon"></i>\r\n    </button> \r\n  </div>  \r\n  <div id="wordListsView"  class="row wordListViewArea">\r\n  </div>\r\n  <div><span class="">Note: Create new Word List and enter a <b>new line for each word or phrase</b> in the list</span></div>\r\n</div>\r\n'}),define("apps/wordLists/list/wordListsList_view",["app","text!apps/wordLists/list/templates/wordLists_item.html","text!apps/wordLists/list/templates/wordLists_template.html"],function(e,t,n){return e.module("WordListsApp.List.View",function(e,r,i,s,o,u){e.WordList=s.ItemView.extend({className:"listWrapper col-md12 col-xs-12 col-lg-12",template:u.template(t),events:{"click .js-edit":"editWordListClicked","click .js-delete":"deleteWordListClicked","click .js-rename":"renameWordListClicked","click .js-list-text":"listTextClicked","click .js-cancel":"listTextEditCancelClicked","click .js-title-edit":"listTitleEditClicked","click .js-title-cancel":"listTitleCancelClicked","keydown ":"titleEditAreaEnter"},triggers:{"click .js-title-save":"wordList:title:save","click .js-save":"wordList:edit:save"},deleteWordListClicked:function(){this.trigger("wordList:delete",this.model)},editWordListClicked:function(e){e.preventDefault(),this.trigger("activity:edit",this.model)},renameWordListClicked:function(e){this.trigger("activity:rename",this.model)},listTextClicked:function(e){e.preventDefault(),this.trigger("wordList:edit",e.target,this.model)},listTextEditCancelClicked:function(e){e.preventDefault(),this.trigger("wordList:edit:cancel",e.target,this.model)},listTitleEditClicked:function(e){e.preventDefault(),this.trigger("wordList:title:edit",e.target,this.model)},listTitleCancelClicked:function(e){e.preventDefault(),this.trigger("wordList:title:cancel",e.target,this.model)},titleEditAreaEnter:function(e){if(e.which===13){var t=e.target.className.split(" ");u.contains(t,"js-title-edit-area")&&(console.log("contains"),e.preventDefault(),this.trigger("wordList:title:enter",e.target,this.model))}},remove:function(){var e=this;s.ItemView.prototype.remove.call(this)},initialize:function(){}}),e.WordLists=s.CompositeView.extend({className:"wordList-editor-area",template:u.template(n),childView:e.WordList,childViewContainer:"#wordListsView",initialize:function(){},onCompositeCollectionRendered:function(){this.appendHtml=function(e,t,n){e.$el.find("#wordListsView").prepend(t.el)}},triggers:{"click .js-new":"wordList:new","click .js-guide":"wordlist:show:guide","click .js-show-wordLists":"wordLists:show"},events:{}})}),e.WordListsApp.List.View}),define("wordListsGuide",function(){}),define("entities/wordList/wordList_model",["jquery","underscore","backbone","app"],function(e,t,n,r){function i(){var t=JSON.parse(e("#data-results").html()),n=t._id;return n}WordList=n.Model.extend({idAttribute:"_id",url:function(){return"/adventures/edit/"+i()+"/word-lists/"+(this.isNew()?"":this.id+"/")},parse:function(e){return this.set("_id",e._id),e},defaults:{title:"",words:"",selected:!1,index:""},initialize:function(e){},toggleSelected:function(){this.set({selected:!this.get("selected")})},clear:function(){console.log("destroy"),this.destroy()}});var s={getWordListEntity:function(t){var n=new WordList({_id:t}),r=e.Deferred();return n.fetch({success:function(e){r.resolve(e),console.log("success")},error:function(e){r.resolve(undefined),console.log("fail")}}),r.promise()}};return r.reqres.setHandler("wordList:entity",function(e){return s.getWordListEntity(e)}),r.reqres.setHandler("wordList:entity:new",function(e){return new WordList}),WordList}),define("entities/wordList/wordList_collection",["jquery","underscore","backbone","app","entities/wordList/wordList_model"],function(e,t,n,r,i){function f(e){t.each(e.models,function(e){var t=e.collection.indexOf(e)+1;e.set("index",t)},this)}WordListCollection=n.Collection.extend({model:i,url:function(){return"/adventures/edit/"+this.idLesson+"/word-lists/"},parse:function(e){return e.wordLists},initialize:function(e,t){this.idLesson=t},selected:function(){return this.filter(function(e){return e.get("selected")})},remaining:function(){return this.without.apply(this,this.selected())}});var s=JSON.parse(e("#data-results").html()),o=s._id,u=function(){var e=new WordListCollection(s.wordLists,o);return f(e),e},a={getWordListEntities:function(t){var n={},r=new WordListCollection(n,o),i=e.Deferred();return r.fetch({success:function(e){e.length!==0&&f(e),i.resolve(e)}}),i.promise()},getWordListEntitiesFromHTML:function(){var e=u();return f(e),e}};return r.reqres.setHandler("wordList:entities",function(){return a.getWordListEntities()}),r.reqres.setHandler("wordList:entities:initialized",function(){return a.getWordListEntitiesFromHTML()}),WordListCollection}),define("apps/wordLists/list/wordListsList_controller",["app","apps/wordLists/list/wordListsList_view","bootbox","bootstrap","wordListsGuide"],function(e,t,n,r){return e.module("WordListsApp.List",function(e,r,i,s,o,u){function f(e,i){function a(e){var t="";return u.each(e,function(e){t+=e+"\n"}),t}var s=new t.WordLists({collection:e});i.show(s),s.on("childview:wordList:delete",function(t){n.confirm("Delete Word List?",function(e){if(e!==!0)return;t.model.destroy()}),u.each(e.models,function(t){t.set("index",e.indexOf(t)+1)})}),s.on("childview:wordList:edit",function(e,t){var n=e.model.get("words"),r=a(n);o(t).next(".list-edit-area").children("textarea.list-edit-textarea").multiline(r),o(t).hide(),o(t).next(".list-edit-area").show(),o(t).next(".list-edit-area").children("textarea.list-edit-textarea").focus()}),s.on("wordList:new",function(){var t=r.request("wordList:entity:new");t.set("index",e.length+1),e.create(t),window.scrollTo(0,0)}),s.on("wordlist:show:guide",function(){introJs().exit();var e=introJs();startIntro1(e,"wordList")}),s.on("wordLists:show",function(e){var t=e.view,n=o(t.el).find(".isVisible");n.length===0?(o(t.el).css("z-index",7),o(t.el).find(".wordLists-editor-wrapper").addClass("isVisible"),o(t.el).find(".btn-wordLists-editor").addClass("word-list-open")):(o(t.el).css("z-index","auto"),o(t.el).find(".wordLists-editor-wrapper").removeClass("isVisible"),o(t.el).find(".btn-wordLists-editor").removeClass("word-list-open"))}),s.on("childview:wordList:edit:cancel",function(e,t){o(t).parent().hide(),o(t).parent().prev(".list-text").show()}),s.on("childview:wordList:edit:save",function(e){var t=e.model,n=e.el,r=o(n).find(".list-edit-textarea").val(),i=o(n).find(".list-edit-textarea").text();r.charCodeAt()===10?(r="",o(n).find(".list-text").text("")):(r=r.trim(),o(n).find(".list-text").text(r)),o(n).find(".list-edit-area").hide(),o(n).find(".list-text").show();var s=r.split(/\r\n|\r|\n/g);t.set("words",s),t.save()}),s.on("childview:wordList:title:edit",function(e,t){o(t).hide(),o(t).next(".title-edit-area").show(),o(t).next(".title-edit-area").children("textarea").focus()}),s.on("childview:wordList:title:save",function(e){var t=e.model,n=e.el,r=o(n).find(".title-edit-textarea").val();o(n).find(".list-title").text(r),o(n).find(".title-edit-area").hide(),o(n).find(".js-title-edit").show(),t.set("title",r),t.save()}),s.on("childview:wordList:title:enter",function(e,t){var n=e.model,r=o(t).val();o(t).prev(".list-title").text(r),o(t).hide(),o(t).prev(".list-text").show(),n.set("title",r),n.save()}),s.on("childview:wordList:title:cancel",function(e,t){o(t).parent().hide(),o(t).parent().prev(".list-title").show()}),s.on("childview:wordList:rename",function(e){n.prompt("Rename WordList Title",function(t){if(t===null){e.model.set("wordListTitle",""),e.model.save();return}t===""?(e.model.set("wordListTitle",""),e.model.save()):(e.model.set("wordListTitle",t),e.model.save())})}),o.fn.multiline=function(e){return this.text(e),this.html(this.html().replace(/\n/g,"&#13;&#10;")),this},o(window.document).off("DialogUrl"),o(window.document).on("DialogUrl",function(e,t){var n=t.detail;switch(n.type){case"UrlUpdate":var i=n.resourceURL;r.trigger("dialog:show",i,n.title)}})}var a=12;e.Controller={listWordLists:function(e){require(["entities/wordList/wordList_collection"],function(){var t=r.request("wordList:entities");o.when(t).done(function(t){f(t,e)})})}}}),e.WordListsApp.List.Controller}),define("apps/wordLists/wordLists_app",["app"],function(e){e.module("WordListsApp",function(e,t,n,r,i,s){e.onStart=function(){console.log("Starting WordListsApp")},e.onStop=function(){console.log("Stopping WordListsApp")}}),e.module("Router.WordListsApp",function(e,t,n,r,i,s){e.Router=r.AppRouter.extend({appRoutes:{"word-lists":"listWordLists"}}),WordListsAPI={listWordLists:function(e){require(["apps/wordLists/list/wordListsList_controller","apps/header/list/headerList_controller"],function(t,n){t.listWordLists(e),n.listHeader("list")})}},t.on("wordLists:list",function(e){WordListsAPI.listWordLists(e)}),t.on("wordLists:list:initialized",function(){t.navigate("word-lists"),console.log("wordLists:list:initialized");var e={initialized:!0};WordListsAPI.listWordLists(e)}),t.addInitializer(function(){new e.Router({controller:WordListsAPI})})})}),define("text!apps/plugins/configureWord/templates/plugins_item.html",[],function(){return'\r\n<!-- <a class="btn-image js-show " href="#" style=\'background-image: url("<%= thumbnail %>");\'></a> -->  \r\n<div class="btn-app-area word-list-normal js-plugin-select">\r\n  <a class="btn-app btn-word-list" href="#">\r\n    <i class="fa <%= icon %> fa-4x"></i>\r\n  </a>\r\n</div>\r\n\r\n\r\n<div class="btn-app-icon-description">\r\n  <span ><%= pluginTitle %></span> \r\n</div>\r\n'}),define("text!apps/plugins/configureWord/templates/plugins_template.html",[],function(){return'<div class="row">\r\n  <div id="plugins-apps"></div>\r\n</div>'}),define("text!apps/plugins/configureWord/templates/pluginsConfigureWord_template.html",[],function(){return'<div class="row gutter">\r\n  <div  class="col-lg-12 col-md-12 col-sm-12 col-xs-12">\r\n    <button type="button" class="close js-close" data-dismiss="modal" aria-hidden="true"><span class="modal-close">&times;</span></button>\r\n    <div class="center-block text-center">\r\n      <h3>Configure Word List with App</h3> \r\n    </div>\r\n  </div>\r\n\r\n  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">\r\n    <span class="word-list-title">1. Choose Word Lists </span>  \r\n    <button type="button" class="btn btn-info navbar-btn js-guide">\r\n            <i class="fa fa-info-circle"></i> Guide</button>\r\n  </div>\r\n\r\n  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">\r\n    <!--<button class="btn btn-success btn-large js-new-list"><i class="fa fa-th-list"></i> Create New List</button>-->\r\n    Note: You can create new Word Lists with the &nbsp;<div class="btn-wordLists-editor-shortcut"><i class="fa fa-list-alt btn-editor-icon-shortcut fa-2x"></i></div> <b>Word List Editor</b> on the Adventure Map\r\n  </div>\r\n\r\n  <div class="col-lg-3 col-md-3 col-sm-6 col-xs-6 configure-wordlist">\r\n    <span>First WordList :</span>\r\n\r\n    <select id="wl1" class="form-control js-select-wordList">\r\n      <option value=0>Select a word list</option>\r\n      <% _.each(wordLists.models,function(wordList){ %>             \r\n      <% var title=wordList.get("title"); %>\r\n      <% var id=wordList.get("_id"); %>\r\n      <option value="<%= id %>"><%=  title %></option>\r\n      <% }) %>            \r\n    </select>\r\n  </div>\r\n  <div  class="col-lg-3 col-md-3 col-sm-6 col-xs-6 configure-wordlist">\r\n    <span>Second WordList :</span>\r\n    <select id="wl2" class="form-control js-select-wordList">\r\n      <option value=0>Select a word list</option>\r\n      <% _.each(wordLists.models,function(wordList){ %>             \r\n      <% var title=wordList.get("title"); %>\r\n      <% var id=wordList.get("_id"); %>\r\n      <option value="<%= id %>"><%=  title %></option>\r\n      <% }) %>  \r\n    </select>\r\n  </div>\r\n</div>\r\n\r\n<!--<div class="row">\r\n  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">\r\n    <button class="btn btn-default">Create New List</button>\r\n    <div class="list-area" data-toggle="tooltip" data-placement="left" title="Edit Title">\r\n      <div contentEditable=true data-ph="Click to edit Title" class="col-md-12 col-sm-12 col-lg-12 padding-0px list-title js-title-edit">Title</div>\r\n      <div class="title-edit-area ">\r\n        <textarea class="title-edit-textarea js-title-edit-area">Title</textarea>\r\n        <a class="btn btn-success js-title-save">\r\n          <i class="icon-white icon-ok"></i>Save\r\n        </a>\r\n        <a class="btn btn-default js-title-cancel">Cancel</a>\r\n      </div>\r\n            var string=\'\';\r\n              _.each(words,function(word){        \r\n                if(word !== \' \' || word !==\'\\n\'){\r\n                  string += (word + "&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp");\r\n                }\r\n                console.log(string);\r\n              })\r\n      <div contentEditable=true data-ph="Click to edit Word List" class="col-md-12 col-sm-12 col-lg-12 padding-0px list-text js-list-text" >\r\n           string \r\n      </div>\r\n      <div class="list-edit-area js-list-edit-area">\r\n        <textarea class="list-edit-textarea"></textarea>\r\n        <a class="btn btn-success js-save">\r\n          <i class="icon-white icon-ok"></i>Save\r\n        </a>\r\n        <a class="btn btn-default js-cancel">Cancel</a>\r\n      </div>\r\n      <a class="btn btn-default btn-list-delete js-delete">\r\n        <i class="fa fa-trash-o"></i> \r\n      </a>\r\n    </div>\r\n  </div>\r\n</div>-->\r\n\r\n<div class="row" id="plugins">\r\n\r\n</div>\r\n\r\n\r\n\r\n\r\n\r\n'}),define("text!apps/plugins/configureWord/templates/pluginsConfigureWordLayout_template.html",[],function(){return'<div class="modal-dialog">\r\n  <div class="modal-content">\r\n    <section class="container-fluid">\r\n      <div id="wordsList"></div>\r\n      <div class="row">\r\n        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">\r\n          <h3>2. Choose App</h3>\r\n        </div>\r\n\r\n      </div>\r\n      <div id="apps" class="col-lg-12 col-md-12 col-sm-12 col-xs-12 configure-word-plugin-area">\r\n\r\n      </div>\r\n\r\n      <div class="row">\r\n        <div class="configure-word-button-area col-lg-12 col-md-12 col-sm-12 col-xs-12">\r\n          <a class="btn btn-default btn-success btn-configure-word js-save">Save</a>\r\n          <a class="btn btn-default btn-submit btn-configure-word js-cancel">Cancel</a>\r\n        </div>\r\n      </div>\r\n    </section>\r\n  </div>\r\n</div>\r\n\r\n'}),define("apps/plugins/configureWord/pluginsConfigureWord_view",["app","text!apps/plugins/configureWord/templates/plugins_item.html","text!apps/plugins/configureWord/templates/plugins_template.html","text!apps/plugins/configureWord/templates/pluginsConfigureWord_template.html","text!apps/plugins/configureWord/templates/pluginsConfigureWordLayout_template.html","bootstrap"],function(e,t,n,r,i){return e.module("PluginApps.ConfigureWord.View",function(e,s,o,u,a,f){e.Plugin=u.ItemView.extend({className:"plugin-wrapper",template:f.template(t),events:{"click .js-plugin-select":"selectPluginApp"},modelEvents:{"change:selected":"selectedChanged"},style:{selected:function(e){var t=e.model.get("selected");t?a(e.el).find(".js-plugin-select").removeClass("word-list-normal").addClass("word-list-selected"):a(e.el).find(".js-plugin-select").removeClass("word-list-selected").addClass("word-list-normal")},deactivated:function(e){var t=e.model.get("activated");t?(a(e.el).find(".js-plugin-select").removeClass("word-list-deactivated").addClass("word-list-normal"),a(e.el).find(".btn-app").removeClass("btn-word-list-deactivated").addClass("btn-word-list")):(a(e.el).find(".js-plugin-select").removeClass("word-list-normal").addClass("word-list-deactivated"),a(e.el).find(".btn-app").removeClass("btn-word-list").addClass("btn-word-list-deactivated"))}},selectedChanged:function(){this.style.selected(this)},selectPluginApp:function(e){e.preventDefault(),a(e.currentTarget).hasClass("word-list-deactivated")||this.trigger("plugin:selected",this)},remove:function(){var e=this;u.ItemView.prototype.remove.call(this)},initialize:function(){},onRender:function(){this.style.selected(this),this.style.deactivated(this)}}),e.Plugins=u.CompositeView.extend({className:"",template:f.template(n),childView:e.Plugin,childViewEventPrefix:"plugins",childViewContainer:"#plugins-apps",initialize:function(){this.collection=this.model.get("plugins")},events:{}}),e.ConfigureWordLayout=u.LayoutView.extend({className:"modal custom fade ",id:"myModal",regions:{wordsList:"#wordsList",apps:"#apps"},attributes:{tabindex:"-1",role:"dialog","aria-labelledby":"myModalLabel","aria-hidden":"true"},template:f.template(i),initialize:function(){},triggers:{"click  .js-save":"configure:save","click .js-cancel":"configure:cancel","click .js-new-list":"new:wordList","click .js-guide":"configureWord:guide"},onRender:function(){},onShow:function(){}}),e.ConfigureWord=u.ItemView.extend({template:f.template(r),initialize:function(){},events:{"change .js-select-wordList":"selectedWordList","click .js-close":"closeDialog"},selectedWordList:function(e){e.preventDefault();var t=e.target,n=t.selectedIndex;this.trigger("plugins:configureWord:wordlist",this,e)},closeDialog:function(){}})}),e.PluginApps.ConfigureWord.View}),define("entities/pluginType/pluginType_model",["jquery","underscore","backbone","app"],function(e,t,n,r){var i=n.Model.extend({idAttribute:"_id",url:function(){return t.result(this.collection,"url")+(this.isNew()?"":this.id+"/")},parse:function(e){return this.set("_id",e._id),e},defaults:{title:"",category:"",plugins:""},initialize:function(e){},clear:function(){console.log("destroy"),this.destroy()}}),s={getPluginEntity:function(t){var n=new i({id:t}),r=e.Deferred();return n.fetch({success:function(e){r.resolve(e)},error:function(e){r.resolve(undefined)}}),r.promise()}};return r.reqres.setHandler("pluginType:entity",function(e){return s.getPluginEntity(e)}),r.reqres.setHandler("pluginType:entity:new",function(e){return new i}),i}),define("entities/plugin/plugin_model",["jquery","underscore","backbone","app"],function(e,t,n,r){var i=n.Model.extend({idAttribute:"_id",url:function(){return t.result(this.collection,"url")+(this.isNew()?"":this.id+"/")},parse:function(e){return this.set("_id",e._id),e},defaults:{pluginURL:"",pluginTeacherURL:"",pluginTitle:"",pluginServerPath:"",category:"",thumbnail:"",index:"",minLists:""},initialize:function(e){},clear:function(){console.log("destroy"),this.destroy()}}),s={getPluginEntity:function(t){var n=new i({id:t}),r=e.Deferred();return n.fetch({success:function(e){r.resolve(e)},error:function(e){r.resolve(undefined)}}),r.promise()}};return r.reqres.setHandler("plugin:entity",function(e){return s.getPluginEntity(e)}),r.reqres.setHandler("plugin:entity:new",function(e){return new i}),i}),define("entities/plugin/plugin_collection",["jquery","underscore","backbone","app","entities/plugin/plugin_model"],function(e,t,n,r,i){function f(e){t.each(e.models,function(e){var t=e.collection.indexOf(e)+1;e.set("index",t)},this)}PluginCollection=n.Collection.extend({model:i,url:function(){},parse:function(e){return e.plugins},initialize:function(e,t){this.idSession=t},selected:function(){return this.filter(function(e){return e.get("selected")})},remaining:function(){return this.without.apply(this,this.selected())}});var s=JSON.parse(e("#data-classrooms").html()),o=s.lesson,u=function(){var e=new PluginCollection(s.plugins,o);return f(e),e},a={getActivityEntities:function(t){var n={},r=new PluginCollection(n,o),i=e.Deferred();return r.fetch({success:function(e){i.resolve(e),f(r)}}),i.promise()},getPluginEntitiesFromHTML:function(){var e=u();return f(e),e},getPluginEntitiesInitialized:function(){var e=[{_id:"1",thumbnail:"fa-random",pluginTitle:"Randomizer",type:"",index:"",pluginURL:"/plugins/randomizer/randomizerTeacher.html"},{_id:"2",thumbnail:"fa-columns",pluginTitle:"Sort Me",type:"",index:"",pluginURL:"/plugins/sortMe/sortMeTeacher.html"},{_id:"3",thumbnail:"fa-bolt",pluginTitle:"Word Attack",type:"",index:"",pluginURL:"/plugins/wordAttack/wordAttackTeacher.html"},{_id:"4",thumbnail:"fa-dot-circle-o",pluginTitle:"Buzzer",type:"",index:"",pluginURL:"/plugins/buzzer/buzzerTeacher.html"},{_id:"5",thumbnail:"fa-circle-o",pluginTitle:"Word Wheel",type:"",index:"",pluginURL:"/plugins/wheelWord/wheelWordTeacher.html"},{_id:"6",thumbnail:"fa-bar-chart-o",pluginTitle:"Quick Poll",type:"",index:"",pluginURL:"/plugins/quickPoll/quickPollTeacher.html"},{_id:"7",thumbnail:"fa-pencil",pluginTitle:"Open Response",type:"",index:"",pluginURL:"/plugins/openResponse/openResponseTeacher.html"},{_id:"8",thumbnail:"fa-search",pluginTitle:"Word Search",type:"",index:"",pluginURL:"/plugins/wordSearch/wordSearchTeacher.html"}],t=new PluginCollection(e);return f(t),t}};return r.reqres.setHandler("plugins:entities",function(){return a.getPluginEntities()}),r.reqres.setHandler("plugins:entities:initialized",function(){return a.getPluginEntitiesInitialized()}),PluginCollection}),define("entities/pluginType/pluginType_collection",["jquery","underscore","backbone","app","entities/pluginType/pluginType_model","entities/plugin/plugin_collection"],function(e,t,n,r,i,s){function l(e){t.each(e.models,function(e){var t=e.collection.indexOf(e)+1;e.set("index",t)},this)}PluginTypeCollection=n.Collection.extend({model:i,url:function(){return"/plugins/plugins.json"},parse:function(e){return e.pluginTypes},initialize:function(e,t){this.idSession=t},selected:function(){return this.filter(function(e){return e.get("selected")})},remaining:function(){return this.without.apply(this,this.selected())}});var o=JSON.parse(e("#data-classrooms").html()),u=o.lesson,a=function(){var e=new PluginTypeCollection(o.pluginTypes,u);return l(e),e},f={getPluginTypesEntities:function(n){var r={},i=new PluginTypeCollection(r,u),o=e.Deferred();return i.fetch({success:function(e){t.each(e.models,function(e){var t=e.get("plugins"),n=new s(t);e.set("plugins",n)}),o.resolve(e),l(i)}}),o.promise()},getPluginEntitiesFromHTML:function(){var e=a();return l(e),e},getPluginTypesEntitiesInitialized:function(){var e=[{_id:"1",thumbnail:"fa-random",pluginTitle:"Randomizer",type:"",index:"",pluginURL:"/pluginTypes/randomizer/randomizerTeacher.html"},{_id:"2",thumbnail:"fa-columns",pluginTitle:"Sort Me",type:"",index:"",pluginURL:"/pluginTypes/sortMe/sortMeTeacher.html"},{_id:"3",thumbnail:"fa-bolt",pluginTitle:"Word Attack",type:"",index:"",pluginURL:"/pluginTypes/wordAttack/wordAttackTeacher.html"},{_id:"4",thumbnail:"fa-dot-circle-o",pluginTitle:"Buzzer",type:"",index:"",pluginURL:"/pluginTypes/buzzer/buzzerTeacher.html"},{_id:"5",thumbnail:"fa-circle-o",pluginTitle:"Word Wheel",type:"",index:"",pluginURL:"/pluginTypes/wheelWord/wheelWordTeacher.html"},{_id:"6",thumbnail:"fa-bar-chart-o",pluginTitle:"Quick Poll",type:"",index:"",pluginURL:"/pluginTypes/quickPoll/quickPollTeacher.html"},{_id:"7",thumbnail:"fa-pencil",pluginTitle:"Open Response",type:"",index:"",pluginURL:"/pluginTypes/openResponse/openResponseTeacher.html"},{_id:"8",thumbnail:"fa-pencil",pluginTitle:"Word Search",type:"",index:"",pluginURL:"/pluginTypes/wordSearch/wordSearchTeacher.html"}],t=new PluginTypeCollection(e);return l(t),t}};return r.reqres.setHandler("pluginTypes:entities",function(){return f.getPluginTypesEntities()}),r.reqres.setHandler("pluginTypes:entities:initialized",function(){return f.getPluginTypesEntitiesInitialized()}),PluginTypeCollection}),define("apps/plugins/configureWord/pluginsConfigureWord_controller",["app","apps/plugins/configureWord/pluginsConfigureWord_view"],function(e,t,n){return e.module("PluginsApp.ConfigureWord",function(e,n,r,i,s,o){function p(){var e=new t.ConfigureWordLayout;e.on("show",function(){}),e.on("render",function(){n.reqres.setHandler("plugins:layout",function(){return e}),d()}),e.on("configure:save",function(){c.set({pluginApp:a,pluginAppIcon:f,wordLists:l}),m(c),n.dialogRegion.closeDialog()}),e.on("configure:cancel",function(){console.log("cancel"),n.dialogRegion.closeDialog()}),e.on("new:wordList",function(){n.trigger("wordLists:list")}),e.on("configureWord:guide",function(){}),n.dialogRegion.show(e)}function d(){require(["entities/wordList/wordList_collection"],function(){var e=n.request("wordList:entities");s.when(e).done(function(e){var i=r.Model.extend(),o=new i;o.set("wordLists",e);var u=new t.ConfigureWord({model:o});u.on("show",function(){l.length!==0&&(l[0]&&s("select#wl1 option[value='"+l[0]+"']").attr("selected","selected"),l[1]&&s("select#wl2 option[value='"+l[1]+"']").attr("selected","selected"),v())});var a=n.request("plugins:layout");a.wordsList.show(u),u.on("plugins:configureWord:wordlist",function(e,t){var n=t.target,r=n.selectedIndex,i=n.options[r].value,s=n.id.substring(2),o={listId:i,index:s};l[o.index-1]=o.listId,v()})})})}function v(){require(["entities/pluginType/pluginType_collection"],function(){var e=n.request("pluginTypes:entities");s.when(e).done(function(e){var r=o.find(e.models,function(e){return e.get("category")==="word"}),i=0,u=s("#wl1").find(":selected").val(),l=s("#wl2").find(":selected").val();u!=="0"&&(i+=1),l!=="0"&&(i+=1);if(r){o.each(r.get("plugins").models,function(e){i>=e.get("minLists")?e.set("activated",!0):e.set("activated",!1)});var c=new t.Plugins({model:r}),h=n.request("plugins:layout");h.apps.show(c);if(a){var p=r.get("plugins").findWhere({plugin:a});console.log("pluginFound"+p),typeof p!="undefined"&&p.set("selected",!0)}c.on("plugins:plugin:selected",function(e){a=e.model.get("plugin"),f=e.model.get("icon"),o.each(e.model.collection.models,function(e){e.set("selected",!1)}),e.model.set("selected",!0),console.log("pluginSelected: "+a)})}})})}function m(e){var t=e.clone();t.save({},{success:function(e){console.log("saved"),t.trigger("destroy",t,t.collection)},error:function(e){}})}var u=12,a,f,l=[],c,h=i.Controller.extend({configureWordPlugins:function(e){c=e.model,c.get("pluginApp")!==""&&(a=c.get("pluginApp")),c.get("wordLists").length!==0&&(l=c.get("wordLists")),p()}});e.Controller=new h}),e.PluginsApp.ConfigureWord.Controller}),define("apps/plugins/plugins_app",["app"],function(e){e.module("Router.PluginApp",function(e,t,n,r,i,s){e.Router=r.AppRouter.extend({appRoutes:{}}),PluginsAPI={configureWord:function(e){require(["apps/plugins/configureWord/pluginsConfigureWord_controller"],function(t){t.configureWordPlugins(e)})}},t.on("plugins:configureWord",function(e){PluginsAPI.configureWord(e)}),t.addInitializer(function(){new e.Router({controller:PluginsAPI})})})}),FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),FastClick.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(this.deviceIsIOS&&e.type==="file"||e.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(e.className)},FastClick.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!this.deviceIsAndroid;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},FastClick.prototype.sendClick=function(e,t){var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},FastClick.prototype.determineEventType=function(e){return this.deviceIsAndroid&&e.tagName.toLowerCase()==="select"?"mousedown":"click"},FastClick.prototype.focus=function(e){var t;this.deviceIsIOS&&e.setSelectionRange&&e.type.indexOf("date")!==0&&e.type!=="time"?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},FastClick.prototype.updateScrollParent=function(e){var t,n;t=e.fastClickScrollParent;if(!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},FastClick.prototype.onTouchStart=function(e){var t,n,r;if(e.targetTouches.length>1)return!0;t=this.getTargetElementFromEventTarget(e.target),n=e.targetTouches[0];if(this.deviceIsIOS){r=window.getSelection();if(r.rangeCount&&!r.isCollapsed)return!0;if(!this.deviceIsIOS4){if(n.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=n.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=n.pageX,this.touchStartY=n.pageY,e.timeStamp-this.lastClickTime<200&&e.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},FastClick.prototype.onTouchMove=function(e){if(!this.trackingClick)return!0;if(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))this.trackingClick=!1,this.targetElement=null;return!0},FastClick.prototype.findControl=function(e){return e.control!==undefined?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(e){var t,n,r,i,s,o=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,n=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,this.deviceIsIOSWithBadTarget&&(s=e.changedTouches[0],o=document.elementFromPoint(s.pageX-window.pageXOffset,s.pageY-window.pageYOffset)||o,o.fastClickScrollParent=this.targetElement.fastClickScrollParent),r=o.tagName.toLowerCase();if(r==="label"){t=this.findControl(o);if(t){this.focus(o);if(this.deviceIsAndroid)return!1;o=t}}else if(this.needsFocus(o)){if(e.timeStamp-n>100||this.deviceIsIOS&&window.top!==window&&r==="input")return this.targetElement=null,!1;this.focus(o);if(!this.deviceIsIOS4||r!=="select")this.targetElement=null,e.preventDefault();return!1}if(this.deviceIsIOS&&!this.deviceIsIOS4){i=o.fastClickScrollParent;if(i&&i.fastClickLastScrollTop!==i.scrollTop)return!0}return this.needsClick(o)||(e.preventDefault(),this.sendClick(o,e)),!1},FastClick.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable?!this.needsClick(this.targetElement)||this.cancelNextClick?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0:!0},FastClick.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):e.target.type==="submit"&&e.detail===0?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},FastClick.prototype.destroy=function(){var e=this.layer;this.deviceIsAndroid&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(e){var t,n;if(typeof window.ontouchstart=="undefined")return!0;n=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(n){if(!FastClick.prototype.deviceIsAndroid)return!0;t=document.querySelector("meta[name=viewport]");if(t){if(t.content.indexOf("user-scalable=no")!==-1)return!0;if(n>31&&window.innerWidth<=window.screen.width)return!0}}return e.style.msTouchAction==="none"?!0:!1},FastClick.attach=function(e){return new FastClick(e)},typeof define!="undefined"&&define.amd?define("libs/fastclick/fastclick",[],function(){return FastClick}):typeof module!="undefined"&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick,define("app",["marionette","apps/config/marionette/region/dialog"],function(e,t){var n=new e.Application;return n.addRegions({headerRegion:"#header-region",mainRegion:"#main-region",dialogRegion:t}),n.navigate=function(e,t){t||(t={}),Backbone.history.navigate(e,t)},n.getCurrentRoute=function(){return Backbone.history.fragment},n.on("start",function(){Backbone.history&&(require(["apps/activities/activities_app","apps/students/students_app","apps/elements/elements_app","apps/dialog/dialog_app","apps/header/header_app","apps/wordLists/wordLists_app","apps/plugins/plugins_app"],function(){Backbone.history.start(),n.getCurrentRoute()===""&&(n.trigger("activities:listAdventures:initialized"),n.trigger("header:list"),require(["libs/fastclick/fastclick"],function(){FastClick.attach(document.body)}))}),console.log("Lesson Manager has started"))}),n}),requirejs.config({paths:{jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min","jquery-ui":"//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min",Jcrop:"//cdnjs.cloudflare.com/ajax/libs/jquery-jcrop/0.9.12/js/jquery.Jcrop.min",underscore:"//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min",backbone:"//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min","backbone.syphon":"//cdnjs.cloudflare.com/ajax/libs/backbone.syphon/0.4.1/backbone.syphon.min",json2:"//cdnjs.cloudflare.com/ajax/libs/json2/20130526/json2.min",marionette:"//cdnjs.cloudflare.com/ajax/libs/backbone.marionette/2.0.3/backbone.marionette",text:"../../tools/libs/require/text",bootstrap:"//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/js/bootstrap.min",bootbox:"//cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.2.0/bootbox.min",interact:"../../tools/libs/interact/interact.min",tilesprocessor:"../../tools/misc/tilesProcessor",activitiesGuide:"../../guides/listAdventures_controllerGuide",wordListsGuide:"../../guides/wordListsList_controllerGuide",domReady:"//cdnjs.cloudflare.com/ajax/libs/require-domReady/2.0.1/domReady.min",chardinJs:"//cdnjs.cloudflare.com/ajax/libs/chardin.js/0.1.2/chardinjs.min","ckeditor-core":"http://store.hit.camp/libs/ckeditor/ckeditor","ckeditor-j":"http://store.hit.camp/libs/ckeditor/adapters/jquery",mathjax:"//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML&amp;delayStartupUntil=configured"},shim:{underscore:{exports:"_"},backbone:{deps:["underscore","jquery","json2"],exports:"Backbone"},marionette:{deps:["backbone"],exports:"Marionette"},bootstrap:{deps:["jquery"]},"backbone.syphon":["backbone"],bootbox:{deps:["bootstrap","jquery"],exports:"bootbox"},interact:{deps:["underscore"],exports:"interact"},tilesprocessor:["underscore"],"jquery-ui":{exports:"$",deps:["jquery"]},chardinJs:{deps:["jquery"],exports:"chardinJs"},Jcrop:{deps:["jquery"]},"ckeditor-j":{deps:["jquery","ckeditor-core"]},mathjax:{exports:"MathJax"}}}),require(["app"],function(e){e.start()}),define("require_main",function(){});