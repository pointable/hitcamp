!function(){"use strict";app=app||{},app.Record=Backbone.Model.extend({idAttribute:"_id",defaults:{_id:void 0,data:"",name:"",path:"",PIN:"",isComplete:"",isLocked:!1},url:function(){return"/classrooms"+(this.isNew()?"":"/"+this.get("path"))},fullPath:function(){return location.protocol+"//"+location.host+"/"+this.get("path")}}),app.RecordCollection=Backbone.Collection.extend({model:app.Record,url:"/classrooms",parse:function(a){return app.pagingView.model.set({pages:a.pages,items:a.items}),a.data}}),app.Filter=Backbone.Model.extend({defaults:{name:"",isComplete:"",sort:"",limit:""}}),app.Paging=Backbone.Model.extend({defaults:{pages:{},items:{}}}),app.HeaderView=Backbone.View.extend({el:"#header",template:_.template($("#tmpl-header").html()),events:{"submit form":"preventSubmit",'keypress input[type="text"]':"addNewOnEnter","click .btn-add":"addNew","click .btn-intro":"intro"},initialize:function(){this.model=new app.Record,this.listenTo(this.model,"change",this.render),this.render()},render:function(){this.$el.html(this.template(this.model.attributes))},preventSubmit:function(a){a.preventDefault()},addNewOnEnter:function(a){13===a.keyCode&&(a.preventDefault(),this.addNew())},addNew:function(){""===this.$el.find('[name="lessonName"]').val()?alert("Please enter a classroom name."):this.model.save({name:this.$el.find('[name="name"]').val()},{success:function(a,b){b.success?(a.id=b.record._id,app.resultsView.collection.fetch({data:"",reset:!0}),introJSRunning&&(intro.exit(),setTimeout(function(){introStart(!0)},500))):alert(b.errors.join("\n"))}})},intro:function(){document.introStart()}}),app.ResultsView=Backbone.View.extend({el:"#results-table",template:_.template($("#tmpl-results-table").html()),initialize:function(){this.collection=new app.RecordCollection(app.mainView.results.data),this.listenTo(this.collection,"reset",this.render),this.render()},render:function(){this.$el.html(this.template());var a=document.createDocumentFragment(),b=0;this.collection.each(function(c){c.attributes.index=b++,console.log(c);var d=new app.ResultsRowView({model:c});a.appendChild(d.render().el)},this),$("#results-rows").append(a),0===this.collection.length&&$("#results-rows").append($("#tmpl-results-empty-row").html())}}),app.ResultsRowView=Backbone.View.extend({tagName:"tr",template:_.template($("#tmpl-results-row").html()),events:{"click .launch":"runClassroom","click .viewReports":"viewReports","click .manageStudents":"manageStudents","click .configureClassroom":"configureClassroom","click .deleteClassroom":"deleteClassroom","click .lessonEdit":"lessonEdit","click .dropdown-menu li a":"selectLesson"},lessonEdit:function(a){a.preventDefault(),a.stopPropagation(),location.href="/adventures/edit/"+$(a.target).parents("li")[0].id},selectLesson:function(a){a.preventDefault();var b=$(a.target).parents("li"),c=b.find(".lesson-name").text();if($(a.target).parents(".btn-group").find(".dropdown-toggle").html(c+' <span class="caret pull-right"></span>'),$(a.target).parent().hasClass("lessonNew"))location.href="/adventures/edit/";else{var d=b[0].id;console.log(d),$.ajax({url:"/classrooms/"+this.model.get("_id")+"/",type:"PUT",data:"idLesson="+d,success:function(){}})}$(a.target).parents(".btn-group").find("li").removeClass("active"),b.addClass("active")},viewReports:function(a){a.preventDefault(),location.href=this.model.url()+"/reports/"},manageStudents:function(a){a.preventDefault(),location.href=this.model.url()+"/students/"},configureClassroom:function(){event.preventDefault(event),location.href=this.model.url()+"/configure/"},runClassroom:function(a){a.preventDefault(),window.open("/"+this.model.get("path"),"_blank")},deleteClassroom:function(a){a.preventDefault(),confirm("Delete: "+this.model.get("name")+"\nAre you sure?")&&this.model.destroy({success:function(){app.resultsView.collection.fetch({data:"",reset:!0})}})},render:function(){var a=this.model.attributes;a.fullPath=this.model.fullPath(),a.lessons=app.mainView.lessons,a.lesson||(a.lesson=null);var b=_.findWhere(a.lessons,{_id:this.model.get("lesson")});return a.lessonName=b?b.lessonName:"No Adventure",console.log(a),this.$el.html(this.template(a)),this}}),app.FilterView=Backbone.View.extend({el:"#filters",template:_.template($("#tmpl-filters").html()),events:{"submit form":"preventSubmit",'keypress input[type="text"]':"filterOnEnter","change select":"filter"},initialize:function(){this.model=new app.Filter(app.mainView.results.filters),this.listenTo(this.model,"change",this.render),this.render()},render:function(){this.$el.html(this.template(this.model.attributes));for(var a in this.model.attributes)this.model.attributes.hasOwnProperty(a)&&this.$el.find('[name="'+a+'"]').val(this.model.attributes[a])},preventSubmit:function(a){a.preventDefault()},filterOnEnter:function(a){13===a.keyCode&&this.filter()},filter:function(){var a=$("#filters form").serialize();Backbone.history.navigate("q/"+a,{trigger:!0})}}),app.PagingView=Backbone.View.extend({el:"#results-paging",template:_.template($("#tmpl-results-paging").html()),events:{"click .btn-page":"goToPage"},initialize:function(){this.model=new app.Paging({pages:app.mainView.results.pages,items:app.mainView.results.items}),this.listenTo(this.model,"change",this.render),this.render()},render:function(){this.model.get("pages").total>1?(this.$el.html(this.template(this.model.attributes)),this.model.get("pages").hasPrev||this.$el.find(".btn-prev").attr("disabled","disabled"),this.model.get("pages").hasNext||this.$el.find(".btn-next").attr("disabled","disabled")):this.$el.empty()},goToPage:function(a){var b=$("#filters form").serialize()+"&page="+$(a.target).data("page");Backbone.history.navigate("q/"+b,{trigger:!0}),$("body").scrollTop(0)}}),app.MainView=Backbone.View.extend({el:".page .container",initialize:function(){app.mainView=this,this.results=JSON.parse($("#data-results").html()),this.lessons=JSON.parse($("#data-lessons").html()),this.lessons=this.lessons.reverse(),console.log(this.results),app.headerView=new app.HeaderView,app.resultsView=new app.ResultsView,app.pagingView=new app.PagingView}}),app.Router=Backbone.Router.extend({routes:{"":"default","q/:params":"query"},initialize:function(){app.mainView=new app.MainView},"default":function(){app.firstLoad||app.resultsView.collection.fetch({reset:!0}),app.firstLoad=!1},query:function(a){app.resultsView.collection.fetch({data:a,reset:!0}),app.firstLoad=!1}}),$(document).ready(function(){app.firstLoad=!0,app.router=new app.Router,Backbone.history.start(),$("#create").focus(),"true"!==$("#data-hideGuide").html()&&$(".adventure-guide").css("display","block"),$(".js-guide-close").click(function(){event.preventDefault();var a=document.getElementById("adventure-demo-video"),b=a.getElementsByTagName("iframe")[0].contentWindow;b.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*");var c=$("#checkboxHide").is(":checked");$.ajax({url:"/account/settings/guide",type:"PUT",data:"hideGuide="+c,success:function(){}}),$(".adventure-guide").hide()}),$(".btn-start-guide").click(function(){event.preventDefault(),$(".js-guide-close")[0].click()})})}();
//# sourceMappingURL=indexClassroomList.min.js.map