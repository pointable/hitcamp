function getCookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(0===e.indexOf(b))return e.substring(b.length,e.length)}return""}function changeUsername(a){var b;document.student&&document.student.name&&(b=document.student.name),a&&(b=a),b&&""!==b||(b=randomNameFromServer?randomNameFromServer:""),bootbox.hideAll(),bootbox.prompt({title:"Enter your name",value:b,callback:function(a){null===a||""===a||a===b?((null===a||""===a)&&(a=randomNameFromServer?randomNameFromServer:""),updateNameUI(a),setCookie("username="+a)):pluginToServer("STUDENT","StudentSetName",{name:a})}})}function updateUsername(a){if(updateNameUI(a.name),a.success){if(document.student.name=a.name,getCookie("username").trim()===a.name)return void setCookie("username="+a.name);setCookie("username="+a.name),Messenger().post({message:"Changed name: "+a.name,type:"success",hideAfter:5,showCloseButton:!0}),usernameSetBefore=!0}else usernameSetBefore||changeUsername(a.name)}function checkLessonReady(){if(window.isTeacher&&document.isActivitiesNull){var a={type:"UrlUpdate",title:"Lesson Picker",resourceURL:"/plugins/lessonPicker/lessonPickerTeacher.html"};setTimeout(function(){jq(document).trigger("MiniApp",{detail:a})},1e3)}}function switchFullScreen(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?exitFullscreen():enterFullscreen()}function enterFullscreen(){var a=document.documentElement;a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}function exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function getUrlVars(a){var b={},c=decodeURIComponent(document.location.href);if(a&&(c=decodeURIComponent(a.location.href)),c.indexOf("?")<0)return b;c.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,c,d){b[c]=d});return b}function updateNameUI(a){jq("#menuName").html(a),jq("#nameHeader").html(a)}function setCookie(a){var b=new Date,c=10;b.setTime(b.getTime()+24*c*60*60*1e3);var d="expires="+b.toGMTString();document.cookie=a+";domain="+window.location.hostname+";path=/;"+d+";"}var imgPreloader=new IMGPreloader,socket,socketQuery;jq(document).ready(function(){function a(a,b,d){var e={type:"PluginToServer",pluginName:a,pluginMessageType:b,data:d};console.log("pluginToServer"+a+": %O",e),e=JSON.stringify(e),c(e)}function b(a,b){var d={type:a,data:b};console.log("appToServer: %O",d),d=JSON.stringify(d),c(d)}function c(a){window.isPreview||(window.isTeacher?o.teacherToServer(a):o.studentToServer(a))}function d(){socket.emit("ping",{t:(new Date).valueOf()})}jq(function(){FastClick.attach(document.body)}),sessionData=JSON.parse(jq("#data-session").html());var e=sessionData.idSession,f=sessionData.path,g=(sessionData.PIN,sessionData.isTeacher),h=sessionData.port,i=sessionData.activities;if(window.isPreview=sessionData.isPreview,window.isLoggedIn=sessionData.isLoggedIn,window.idLesson=sessionData.idLesson,sessionData.isDevelopment&&(window.isDevelopment=sessionData.isDevelopment),i||(document.isActivitiesNull=!0),window.isTeacher=g,window.idSession=e,window.idPath=f,window.appToServer=b,window.pluginToServer=a,window.sendPing=d,window.isPreview);else{var j=g?"idSessionTeacher="+e:"idSession="+e,k=getUrlVars(),l=k.name;if(l?j+="&isTestUser=true":l=getCookie("username").trim(),l&&""!=l&&(j+="&username="+l),h){var m=window.location.protocol+"//socket."+window.location.hostname+":"+h;socket=io.connect(m,{query:j})}else{var m=window.location.origin;socket=io.connect(m,{query:j})}var n,o=new Chat(socket,g);socket.on("connect",function(){document.socketID=socket.io.engine.id,setTimeout(function(){jq("#myModal").modal("hide"),jq(".modal-backdrop").remove()},1e3),setTimeout(function(){socket.emit("ping",{t:(new Date).valueOf()})},500),clearInterval(n),n=setInterval(function(){socket.emit("ping",{t:(new Date).valueOf()})},6e4),checkLessonReady()}),socket.on("disconnect",function(){Messenger().post({message:"Disconnected",type:"error",id:"connection",hideAfter:10,showCloseButton:!0}),clearInterval(n)}),socket.on("pong",function(a){var b=(new Date).valueOf(),c=b-a.timeSentByClient,d=a.timeServer+c/2;difference=d-b,document.timeDifference=difference}),socket.on("nameResult",function(a){var b;b=a.success?"You are now known as "+a.name+".":a.message}),socket.on("joinResult",function(a){if(document.socketID=a.customID,"Lobby"==a.room)if(g){var c={type:"TeacherJoinSession",idSession:e};jq(document).trigger("teacherToServer",{detail:c})}else b("StudentJoinSession",{idSession:e});else if(a.room===e){var c={type:"StudentJoinSessionSuccess",idSession:e};if(jq(document).trigger("serverToStudent",{detail:c}),!g){var d=a.customName;a.isRandom?(randomNameFromServer=d,setTimeout("changeUsername()",300)):(randomNameFromServer=d,updateNameUI(d)),document.student||(document.student={}),document.student.name=randomNameFromServer}var f="Joined Classroom as Student!";g&&(f="Joined Classroom as Teacher!"),Messenger().post({message:f,type:"success",id:"connection",hideAfter:5,showCloseButton:!0})}}),socket.on("serverToStudent",function(a){jq(document).trigger("serverToStudent",{detail:a})}),socket.on("serverToTeacher",function(a){jq(document).trigger("serverToTeacher",{detail:a})}),socket.on("ServerToApp",function(a){if("ServerToPlugin"==a.type){console.log("ServerToPlugin"+a.pluginName+": %O",a),jq(document).trigger("ServerToPlugin"+a.pluginName,{detail:a});var b=jq("#frameMiniApp");if(b.length>0&&b[0].contentWindow.$){var c=b[0].contentWindow.$(b[0].contentWindow.document);c.length>0&&c.trigger("ServerToPlugin"+a.pluginName,{detail:a})}if(("WALL_STUDENT"===a.pluginName||"GROUPER"===a.pluginName)&&(b=jq("#frameDialog"),b.length>0&&b[0].contentWindow.$)){var c=b[0].contentWindow.$(b[0].contentWindow.document);c.length>0&&c.trigger("ServerToPlugin"+a.pluginName,{detail:a})}}else console.log("Server To App: %O",a),jq(document).trigger("ServerToApp",{detail:a})}),jq(document).on("teacherToServer",function(a,b){o.teacherToServer(JSON.stringify(b.detail))}),jq(document).on("studentToServer",function(a,b){o.studentToServer(JSON.stringify(b.detail))})}jq(document).on("ServerToPluginSTUDENT",function(a,b){var c=b.detail;switch(c.pluginMessageType){case"StudentSetNameResponse":updateUsername(c.data)}}),jq("#open-left").click(function(a){a.preventDefault(),"left"===snapper.state().state?snapper.close():snapper.open("left")}),jq(".open-right").click(function(a){a.preventDefault(),"right"===snapper.state().state?snapper.close():snapper.open("right")}),jq("#menuChangeName").click(function(a){a.preventDefault(),usernameSetBefore=!1,changeUsername()}),jq("body").keydown(function(a){switch(a.keyCode){case 37:case 33:var b=$(".js-question-previous")[0];b&&$(b).is(":visible")&&b.click();break;case 39:case 34:var b=$(".js-question-next")[0];b&&$(b).is(":visible")&&b.click()}}),jq(".js-fullscreen").click(function(a){a.preventDefault(),switchFullScreen(),snapper.close()}),jq(".js-nav-adventure").click(function(){jq("li").each(function(){jq(this).removeClass("nav-bar-active")}),jq(".js-nav-adventure").parent().addClass("nav-bar-active")}),jq(".js-nav-campfire").click(function(){jq("li").each(function(){jq(this).removeClass("nav-bar-active")}),jq(".js-nav-campfire").parent().addClass("nav-bar-active")}),jq(".js-nav-teststudents").click(function(){jq("li").each(function(){jq(this).removeClass("nav-bar-active")}),jq(".js-nav-teststudents").parent().addClass("nav-bar-active")}),jq(".js-nav-signout").click(function(){jq("li").each(function(){jq(this).removeClass("nav-bar-active")}),jq(".js-nav-signout").parent().addClass("nav-bar-active")})});var randomNameFromServer,usernameSetBefore=!1;document.student={},function(a,b,c){if(c in b&&b[c]){var d,e=a.location,f=/^(a|html)jq/i;a.addEventListener("click",function(a){for(d=a.target;!f.test(d.nodeName);)d=d.parentNode;"href"in d&&(d.href.indexOf("http")||~d.href.indexOf(e.host))&&(a.preventDefault(),e.href=d.href)},!1)}}(document,window.navigator,"standalone");
//# sourceMappingURL=chat_ui.min.js.map